{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "omsWorkspaceName": {
            "type": "string",
            "metadata": {
                "description": "Input the name of your OMS Workspace"
            }
        }
    },
    "variables": {
        "alerts": [
            
            {
                "search": {
                    "name": "auctioneer.AuctioneerLRPAuctionsFailed.critical",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=auctioneer Name_s=AuctioneerLRPAuctionsFailed"
                },
                "alert": {
                    "displayName": "Auctioneer App Instance (AI) Placement Failures",
                    "description": "The number of Long Running Process (LRP) instances that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerLRPAuctionsFailed",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 5,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "auctioneer.AuctioneerLRPAuctionsFailed.warning",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=auctioneer Name_s=AuctioneerLRPAuctionsFailed"
                },
                "alert": {
                    "displayName": "Auctioneer App Instance (AI) Placement Failures",
                    "description": "The number of Long Running Process (LRP) instances that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerLRPAuctionsFailed",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 2.5,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "auctioneer.AuctioneerFetchStatesDuration.critical",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=auctioneer Name_s=AuctioneerFetchStatesDuration Value_d>=5000000000"
                },
                "alert": {
                    "displayName": "Auctioneer Time to Fetch Cell State",
                    "description": "Time in ns that the auctioneer took to fetch state from all the Diego cells when running its auction. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerFetchStatesDuration",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "auctioneer.AuctioneerFetchStatesDuration.warning",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=auctioneer Name_s=AuctioneerFetchStatesDuration Value_d>=2000000000"
                },
                "alert": {
                    "displayName": "Auctioneer Time to Fetch Cell State",
                    "description": "Time in ns that the auctioneer took to fetch state from all the Diego cells when running its auction. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerFetchStatesDuration",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "auctioneer.AuctioneerLRPAuctionsStarted.critical",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=auctioneer Name_s=AuctioneerLRPAuctionsStarted | measure sum(Delta_d) by Environment_s | where AggregatedValue>=20"
                },
                "alert": {
                    "displayName": "Auctioneer App Instance Starts",
                    "description": "The number of LRP instances that the auctioneer successfully placed on Diego cells. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerLRPAuctionsStarted",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "auctioneer.AuctioneerLRPAuctionsStarted.warning",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=auctioneer Name_s=AuctioneerLRPAuctionsStarted | measure sum(Delta_d) by Environment_s | where AggregatedValue>=10"
                },
                "alert": {
                    "displayName": "Auctioneer App Instance Starts",
                    "description": "The number of LRP instances that the auctioneer successfully placed on Diego cells. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerLRPAuctionsStarted",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "auctioneer.AuctioneerTaskAuctionsFailed.critical",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=auctioneer Name_s=AuctioneerTaskAuctionsFailed | measure sum(Delta_d) by Environment_s | where AggregatedValue>=5"
                },
                "alert": {
                    "displayName": "Auctioneer Task Placement Failures",
                    "description": "The number of Tasks that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerTaskAuctionsFailed",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "auctioneer.AuctioneerTaskAuctionsFailed.warning",
                    "category": "CF - DiegoAuctioneer - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=auctioneer Name_s=AuctioneerTaskAuctionsFailed | measure sum(Delta_d) by Environment_s | where AggregatedValue>=2.5"
                },
                "alert": {
                    "displayName": "Auctioneer Task Placement Failures",
                    "description": "The number of Tasks that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#AuctioneerTaskAuctionsFailed",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "bbs.ConvergenceLRPDuration.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=ConvergenceLRPDuration Value_d>=20000000000"
                },
                "alert": {
                    "displayName": "BBS Time to Run LRP Convergence",
                    "description": "Time in ns that the BBS took to run its LRP convergence pass. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#ConvergenceLRPDuration",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "bbs.ConvergenceLRPDuration.warning",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=ConvergenceLRPDuration Value_d>=10000000000"
                },
                "alert": {
                    "displayName": "BBS Time to Run LRP Convergence",
                    "description": "Time in ns that the BBS took to run its LRP convergence pass. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#ConvergenceLRPDuration",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "bbs.RequestLatency.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=RequestLatency Value_d>=10000000000"
                },
                "alert": {
                    "displayName": "BBS Time to Handle Requests",
                    "description": "Time in ns that the BBS took to handle requests, aggregated across all its API endpoints. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#RequestLatency",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "bbs.RequestLatency.warning",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=RequestLatency Value_d>=5000000000"
                },
                "alert": {
                    "displayName": "BBS Time to Handle Requests",
                    "description": "Time in ns that the BBS took to handle requests, aggregated across all its API endpoints. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#RequestLatency",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "bbs.Domain.cf-apps.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=\"Domain.cf-apps\" | measure avg(Value_d) by Environment_s | where AggregatedValue<1"
                },
                "alert": {
                    "displayName": "Cloud Controller and Diego in Sync",
                    "description": "Indicates if the cf-apps Domain is up-to-date, meaning that CF App requests from Cloud Controller are synchronized to bbs.LRPsDesired (Diego-desired AIs) for execution. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#cc-diego-sync",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "bbs.LRPsExtra.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=LRPsExtra | measure avg(Value_d) by Environment_s | where AggregatedValue>=10"
                },
                "alert": {
                    "displayName": "More App Instances Than Expected",
                    "description": "Total number of LRP instances that are no longer desired but still have a BBS record. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsExtra is the total number of LRP instances that are no longer desired but still have a BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#LRPsExtra",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "bbs.LRPsExtra.warning",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=LRPsExtra | measure avg(Value_d) by Environment_s | where AggregatedValue>=5"
                },
                "alert": {
                    "displayName": "More App Instances Than Expected",
                    "description": "Total number of LRP instances that are no longer desired but still have a BBS record. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsExtra is the total number of LRP instances that are no longer desired but still have a BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#LRPsExtra",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "bbs.LRPsMissing.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=LRPsMissing | measure avg(Value_d) by Environment_s | where AggregatedValue>=10"
                },
                "alert": {
                    "displayName": "Fewer App Instances Than Expected",
                    "description": "Total number of LRP instances that are desired but have no record in the BBS. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsMissing is the total number of LRP instances that are desired but have no BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#LRPsMissing",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "bbs.LRPsMissing.warning",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=LRPsMissing | measure avg(Value_d) by Environment_s | where AggregatedValue>=5"
                },
                "alert": {
                    "displayName": "Fewer App Instances Than Expected",
                    "description": "Total number of LRP instances that are desired but have no record in the BBS. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsMissing is the total number of LRP instances that are desired but have no BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#LRPsMissing",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "bbs.CrashedActualLRPs.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=CrashedActualLRPs Value_d>2"
                },
                "alert": {
                    "displayName": "Crashed App Instances",
                    "description": "Total number of LRP instances that have crashed. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#bbs.CrashedActualLRPs",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "bbs.CrashedActualLRPs.warning",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bbs Name_s=CrashedActualLRPs Value_d>0"
                },
                "alert": {
                    "displayName": "Crashed App Instances",
                    "description": "Total number of LRP instances that have crashed. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#bbs.CrashedActualLRPs",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "_comment": "Here is a work around cause we cannot calculate desired 1hr delta with current OMS log query language",
                "search": {
                    "name": "cloud_controller.OUT | bbs.LRPsRunning.critical",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_LogMessage_CL Job_s=cloud_controller MessageType_s=OUT"
                },
                "alert": {
                    "displayName": "Running App Instances, Rate of Change",
                    "description": "Rate of change in app instances being started or stopped on the platform. We use changes on GoRouter to detect this metric. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#1hraverageofbbs.LRPsRunning",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 20,
                    "schedule": {
                        "interval": 30,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "_comment": "Here is a work around cause we cannot calculate desired 1hr delta with current OMS log query language",                
                "search": {
                    "name": "cloud_controller.OUT | bbs.LRPsRunning.warning",
                    "category": "CF - DiegoBBS - KPI",
                    "query": "Type=CF_LogMessage_CL Job_s=cloud_controller MessageType_s=OUT"
                },
                "alert": {
                    "displayName": "Running App Instances, Rate of Change",
                    "description": "Rate of change in app instances being started or stopped on the platform. We use changes on GoRouter to detect this metric. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#1hraverageofbbs.LRPsRunning",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 10,
                    "schedule": {
                        "interval": 30,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "rep.CapacityRemainingMemory.critical",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=CapacityRemainingMemory Value_d<=32678"
                },
                "alert": {
                    "displayName": "Overall Remaining Memory Available",
                    "description": "Remaining amount of memory in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#rep.CapacityRemainingMemory2",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "rep.CapacityRemainingMemory.warning",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=CapacityRemainingMemory Value_d<=65536"
                },
                "alert": {
                    "displayName": "Overall Remaining Memory Available",
                    "description": "Remaining amount of memory in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#rep.CapacityRemainingMemory2",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "rep.CapacityRemainingDisk.critical",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=CapacityRemainingDisk Value_d<=3584"
                },
                "alert": {
                    "displayName": "Remaining Disk Available",
                    "description": "Remaining amount of disk in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#CapacityRemainingDisk",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "rep.CapacityRemainingDisk.warning",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=CapacityRemainingDisk Value_d<=8192"
                },
                "alert": {
                    "displayName": "Remaining Disk Available",
                    "description": "Remaining amount of disk in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#CapacityRemainingDisk",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "rep.RepBulkSyncDuration.critical",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=RepBulkSyncDuration Value_d>=10000000000"
                },
                "alert": {
                    "displayName": "Cell Rep Time to Sync",
                    "description": "Time in ns that the Diego Cell Rep took to sync the ActualLRPs that it claimed with its actual garden containers. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#RepBulkSyncDuration",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "rep.RepBulkSyncDuration.warning",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=RepBulkSyncDuration Value_d>=5000000000"
                },
                "alert": {
                    "displayName": "Cell Rep Time to Sync",
                    "description": "Time in ns that the Diego Cell Rep took to sync the ActualLRPs that it claimed with its actual garden containers. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#RepBulkSyncDuration",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "rep.UnhealthyCell.critical",
                    "category": "CF - DiegoCell - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=rep Name_s=UnhealthyCell Value_d=1"
                },
                "alert": {
                    "displayName": "Unhealthy Cells",
                    "description": "The Diego cell periodically checks its health against the garden backend. For Diego cells, 0 means healthy, and 1 means unhealthy. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#UnhealthyCell",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 1,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "locket.ActiveLocks.critical",
                    "category": "CF - DiegoLocket - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=locket Name_s=ActiveLocks Value_d!=4"
                },
                "alert": {
                    "displayName": "Active Locks",
                    "description": "Total count of how many locks the system components are holding. As of PCF v1.11, the BBS, Auctioneer, TPS Watcher, and Routing API components have migrated to Locket from Consul lock. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#ActiveLocks",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "locket.ActivePresences.critical",
                    "category": "CF - DiegoLocket - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=locket Name_s=ActivePresences Value_d>25"
                },
                "alert": {
                    "displayName": "Active Presences",
                    "description": "Total count of active presences. Presences are defined as the registration records that the cells maintain to advertise themselves to the platform. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#ActivePresences",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "locket.ActivePresences.warning",
                    "category": "CF - DiegoLocket - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=locket Name_s=ActivePresences Value_d>10"
                },
                "alert": {
                    "displayName": "Active Presences",
                    "description": "Total count of active presences. Presences are defined as the registration records that the cells maintain to advertise themselves to the platform. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#ActivePresences",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            
            
            {
                "search": {
                    "name": "route_emitter.RouteEmitterSyncDuration.critical",
                    "category": "CF - RouteEmitter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=route_emitter Name_s=RouteEmitterSyncDuration | measure max(Value_d) by Job_s | where AggregatedValue>10000000000"
                },
                "alert": {
                    "displayName": "Route Emitter Time to Sync",
                    "description": "Time in ns that the active route-emitter took to perform its synchronization pass. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#RouteEmitterSyncDuration",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "route_emitter.RouteEmitterSyncDuration.warning",
                    "category": "CF - RouteEmitter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=route_emitter Name_s=RouteEmitterSyncDuration | measure max(Value_d) by Job_s | where AggregatedValue>5000000000"
                },
                "alert": {
                    "displayName": "Route Emitter Time to Sync",
                    "description": "Time in ns that the active route-emitter took to perform its synchronization pass. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#RouteEmitterSyncDuration",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "gorouter.total_requests.critical",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=gorouter Name_s=total_requests | measure sum(Delta_d) by SourceInstance_s | where AggregatedValue>100000"
                },
                "alert": {
                    "displayName": "Router Throughput",
                    "description": "The lifetime number of requests completed by the GoRouter VM. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#total_requests",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "gorouter.total_requests.warning",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=gorouter Name_s=total_requests | measure sum(Delta_d) by SourceInstance_s | where AggregatedValue>30000"
                },
                "alert": {
                    "displayName": "Router Throughput",
                    "description": "The lifetime number of requests completed by the GoRouter VM. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#total_requests",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "gorouter.latency.critical",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=gorouter Name_s=latency | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>10000"
                },
                "alert": {
                    "displayName": "Router Handling Latency",
                    "description": "The time in milliseconds that the GoRouter takes to handle requests to its app endpoints. This is the average round trip response time to an app, which includes router handling. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#latency",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "gorouter.latency.warning",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=gorouter Name_s=latency | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>5000"
                },
                "alert": {
                    "displayName": "Router Handling Latency",
                    "description": "The time in milliseconds that the GoRouter takes to handle requests to its app endpoints. This is the average round trip response time to an app, which includes router handling. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#latency",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "gorouter.ms_since_last_registry_update.critical",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=gorouter Name_s=ms_since_last_registry_update Value_d>=30000"
                },
                "alert": {
                    "displayName": "Time Since Last Route Register Received",
                    "description": "Time in milliseconds since the last route register was received. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#mssincelastregistryupdate",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "gorouter.bad_gateways.critical",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=gorouter Name_s=bad_gateways"
                },
                "alert": {
                    "displayName": "Router Error: 502 Bad Gateway",
                    "description": "The lifetime number of bad gateways, or 502 responses, from GoRouter itself. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#bad_gateways",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 5,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "gorouter.bad_gateways.warning",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=gorouter Name_s=bad_gateways"
                },
                "alert": {
                    "displayName": "Router Error: 502 Bad Gateway",
                    "description": "The lifetime number of bad gateways, or 502 responses, from GoRouter itself. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#bad_gateways",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            
            {
                "search": {
                    "name": "gorouter.responses.5xx.critical",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=gorouter Name_s=\"responses.5xx\" Delta_d>2"
                },
                "alert": {
                    "displayName": "Router Error: Server Error",
                    "description": "The lifetime number of requests completed by the GoRouter VM for HTTP status family 5xx, server errors. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#responses.5xx",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "gorouter.responses.5xx.warning",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=gorouter Name_s=\"responses.5xx\" Delta_d>0"
                },
                "alert": {
                    "displayName": "Router Error: Server Error",
                    "description": "The lifetime number of requests completed by the GoRouter VM for HTTP status family 5xx, server errors. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#responses.5xx",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "_comment": "Here is a work around cause we cannot calculate desired per second delta with current OMS log query language",
                "search": {
                    "name": "gorouter.total_routes.critical",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=gorouter Name_s=total_routes | measure avg(Value_d) by Environment_s | where AggregatedValue>100"
                },
                "alert": {
                    "displayName": "Number of GoRouter Routes Registered",
                    "description": "The current total number of routes registered with the GoRouter. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#total_routes",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "_comment": "Here is a work around cause we cannot calculate desired per second delta with current OMS log query language",
                "search": {
                    "name": "gorouter.total_routes.warning",
                    "category": "CF - GoRouter - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=gorouter Name_s=total_routes | measure avg(Value_d) by Environment_s | where AggregatedValue>50"
                },
                "alert": {
                    "displayName": "Number of GoRouter Routes Registered",
                    "description": "The current total number of routes registered with the GoRouter. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#total_routes",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "DopplerServer.listeners.totalReceivedMessageCount.critical",
                    "category": "CF - Firehose - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=DopplerServer Name_s=\"listeners.totalReceivedMessageCount\" | measure sum(Delta_d) by SourceInstance_s | where AggregatedValue>300000"
                },
                "alert": {
                    "displayName": "Firehose Throughput",
                    "description": "The total number of messages received across all Doppler listeners: UDP, TCP, TLS, and GRPC. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#listeners.receivedEnvelopes",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "DopplerServer.listeners.totalReceivedMessageCount.warning",
                    "category": "CF - Firehose - KPI",
                    "query": "Type=CF_CounterEvent_CL Origin_s=DopplerServer Name_s=\"listeners.totalReceivedMessageCount\" | measure sum(Delta_d) by SourceInstance_s | where AggregatedValue>150000"
                },
                "alert": {
                    "displayName": "Firehose Throughput",
                    "description": "The total number of messages received across all Doppler listeners: UDP, TCP, TLS, and GRPC. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#listeners.receivedEnvelopes",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "DopplerServer.doppler.shedEnvelopes.critical",
                    "category": "CF - Firehose - KPI",
                    "query": "Origin_s=DopplerServer Name_s=\"doppler.shedEnvelopes\" Delta_d>=10"
                },
                "alert": {
                    "displayName": "Firehose Dropped Messages",
                    "description": "The lifetime total number of messages intentionally dropped by Doppler due to back pressure. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#deriveddopplerserver.doppler",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "DopplerServer.doppler.shedEnvelopes.warning",
                    "category": "CF - Firehose - KPI",
                    "query": "Origin_s=DopplerServer Name_s=\"doppler.shedEnvelopes\" Delta_d>=5"
                },
                "alert": {
                    "displayName": "Firehose Dropped Messages",
                    "description": "The lifetime total number of messages intentionally dropped by Doppler due to back pressure. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#deriveddopplerserver.doppler",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "system.healthy.critical",
                    "category": "CF - BOSH - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.healthy\" Value_d<1"
                },
                "alert": {
                    "displayName": "VM Health",
                    "description": "The lifetime total number of messages intentionally dropped by Doppler due to back pressure. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#healthy",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "system.mem.percent.critical",
                    "category": "CF - BOSH - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.system.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=90"
                },
                "alert": {
                    "displayName": "VM Memory Used",
                    "description": "System Memory — Percentage of memory used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#mem.percent",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 10
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "system.mem.percent.warning",
                    "category": "CF - BOSH - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.system.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=80"
                },
                "alert": {
                    "displayName": "VM Memory Used",
                    "description": "System Memory — Percentage of memory used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#mem.percent",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 10
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "system.disk.system.percent.critical",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.system.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=90"
                },
                "alert": {
                    "displayName": "VM Disk Used",
                    "description": "System disk — Percentage of the system disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#disk.system.percent",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "system.disk.system.percent.warning",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.system.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=80"
                },
                "alert": {
                    "displayName": "VM Disk Used",
                    "description": "System disk — Percentage of the system disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#disk.system.percent",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "system.disk.ephemeral.percent.critical",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.ephemeral.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=90"
                },
                "alert": {
                    "displayName": "VM Ephemeral Disk Used",
                    "description": "Ephemeral disk — Percentage of the ephemeral disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#disk.ephemeral.percent",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "system.disk.ephemeral.percent.warning",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.ephemeral.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=80"
                },
                "alert": {
                    "displayName": "VM Ephemeral Disk Used",
                    "description": "Ephemeral disk — Percentage of the ephemeral disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#disk.ephemeral.percent",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "system.disk.persistent.percent.critical",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.persistent.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=90"
                },
                "alert": {
                    "displayName": "VM Persistent Disk Used",
                    "description": "Persistent disk — Percentage of persistent disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#disk.persistent.percent",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "system.disk.persistent.percent.warning",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.disk.persistent.percent\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=80"
                },
                "alert": {
                    "displayName": "VM Persistent Disk Used",
                    "description": "Persistent disk — Percentage of persistent disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#disk.persistent.percent",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "system.cpu.user.critical",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.cpu.user\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=95"
                },
                "alert": {
                    "displayName": "VM CPU Utilization",
                    "description": "CPU utilization — The percentage of CPU spent in user processes. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#cpu.user",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "system.cpu.user.warning",
                    "category": "CF - System - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=bosh-hm-forwarder Name_s=\"system.cpu.user\" | measure avg(Value_d) by SourceInstance_s | where AggregatedValue>=85"
                },
                "alert": {
                    "displayName": "VM CPU Utilization",
                    "description": "CPU utilization — The percentage of CPU spent in user processes. For details, please check https://docs.pivotal.io/pivotalcf/1-11/monitoring/kpi.html#cpu.user",
                    "severity": "Warning",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "Consul is Down",
                    "category": "CF - Consul - KPI",
                    "query": "Type=CF_ValueMetric_CL Origin_s=route_emitter Name_s=ConsulDownMode Value_d>0"
                },
                "alert": {
                    "displayName": "Consul is Down",
                    "description": "Consul is Down",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "Problem in Logging Process",
                    "category": "CF - Loggregator - KPI",
                    "query": "Type=CF_LogMessage_CL SourceType_s=LGR MessageType_s=ERR"
                },
                "alert": {
                    "displayName": "Problem in Logging Process",
                    "description": "Loggregator emits LGR to indicate problems with the logging process",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "Slow Consumer Alert",
                    "category": "CF - Loggregator - KPI",
                    "query": "Type=CF_ValueMetric_CL Name_s=slowConsumerAlert"
                },
                "alert": {
                    "displayName": "Slow Consumer Alert",
                    "description": "When the nozzle receives slow consumer alert from Loggregator, it sends slowConsumerAlert ValueMetric to OMS",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "Lost Events from Nozzle",
                    "category": "CF - OMS Nozzle - KPI",
                    "query": "Type=CF_CounterEvent_CL Job_s=nozzle Name_s=eventsLost Delta_d>0"
                },
                "alert": {
                    "displayName": "Lost Events from Nozzle",
                    "description": "Lost Events from Nozzle",
                    "severity": "Critical",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            }
        ]
    },
    "resources": [
        {
            "name": "[concat(parameters('omsWorkspaceName'), '/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name))]",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
            "apiVersion": "2015-11-01-preview",
            "copy": {
                "name": "searchCopy",
                "count": "[length(variables('alerts'))]"
            },
            "tags": {},
            "properties": {
                "etag": "*",
                "query": "[variables('alerts')[copyIndex()].search.query]",
                "displayName": "[variables('alerts')[copyIndex()].search.name]",
                "category": "[variables('alerts')[copyIndex()].search.category]"
            }
        },
        {
            "name": "[concat(parameters('omsWorkspaceName'), '/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name), '/', 'schedule-', uniqueString(resourceGroup().id, deployment().name, parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name))]",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches/schedules",
            "apiVersion": "2015-11-01-preview",
            "copy": {
                "name": "scheduleCopy",
                "count": "[length(variables('alerts'))]"
            },
            "tags": {},
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'), '/savedSearches/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name))]"
            ],
            "properties": {
                "etag": "*",
                "interval": "[variables('alerts')[copyIndex()].alert.schedule.interval]",
                "queryTimeSpan": "[variables('alerts')[copyIndex()].alert.schedule.timeSpan]",
                "enabled": true
            }
        },
        {
            "name": "[concat(parameters('omsWorkspaceName'), '/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name), '/', 'schedule-', uniqueString(resourceGroup().id, deployment().name, parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name), '/', 'alert-', uniqueString(resourceGroup().id, deployment().name, parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name))]",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches/schedules/actions",
            "apiVersion": "2015-11-01-preview",
            "copy": {
                "name": "alertCopy",
                "count": "[length(variables('alerts'))]"
            },
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'), '/savedSearches/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name))]",
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'), '/savedSearches/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name), '/schedules/','schedule-',uniqueString(resourceGroup().id, deployment().name,parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name))]"
            ],
            "tags": {},
            "properties": {
                "etag": "*",
                "Type": "Alert",
                "Name": "[variables('alerts')[copyIndex()].alert.displayName]",
                "Description": "[variables('alerts')[copyIndex()].alert.description]",
                "Severity": "[variables('alerts')[copyIndex()].alert.severity]",
                "Threshold": {
                    "Operator": "[variables('alerts')[copyIndex()].alert.thresholdOperator]",
                    "Value": "[variables('alerts')[copyIndex()].alert.thresholdValue]"
                },
                "Throttling": {
                    "DurationInMinutes": "[variables('alerts')[copyIndex()].alert.throttleMinutes]"
                }
            }
        }        
    ]
}