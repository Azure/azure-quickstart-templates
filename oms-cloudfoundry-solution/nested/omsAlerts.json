{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "omsWorkspaceName": {
            "type": "string",
            "metadata": {
                "description": "Input the name of your OMS Workspace"
            }
        },
        "actionGroupName": {
            "type": "string",
            "metadata": {
                "description": "The name of the action group for alert actions"
            }
        }
    },
    "variables": {
        "alerts": [
            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerLRPAuctionsFailed.critical",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerLRPAuctionsFailed\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | summarize avg(sum_Delta_d) by Environment_s | where avg_sum_Delta_d >= 1"
                },
                "alert": {
                    "displayName": "CF-Auctioneer App Instance (AI) Placement Failures",
                    "description": "The number of Long Running Process (LRP) instances that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerLRPAuctionsFailed",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 5,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerLRPAuctionsFailed.warning",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerLRPAuctionsFailed\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | summarize avg(sum_Delta_d) by Environment_s | where avg_sum_Delta_d >= 0.5"
                },
                "alert": {
                    "displayName": "CF-Auctioneer App Instance (AI) Placement Failures",
                    "description": "The number of Long Running Process (LRP) instances that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerLRPAuctionsFailed",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 2.5,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerFetchStatesDuration.critical",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerFetchStatesDuration\" | where Value_d >= 5000000000"
                },
                "alert": {
                    "displayName": "CF-Auctioneer Time to Fetch Cell State",
                    "description": "Time in ns that the auctioneer took to fetch state from all the Diego cells when running its auction. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerFetchStatesDuration",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerFetchStatesDuration.warning",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerFetchStatesDuration\" | where Value_d >= 2000000000"
                },
                "alert": {
                    "displayName": "CF-Auctioneer Time to Fetch Cell State",
                    "description": "Time in ns that the auctioneer took to fetch state from all the Diego cells when running its auction. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerFetchStatesDuration",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerLRPAuctionsStarted.critical",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerLRPAuctionsStarted\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | summarize avg(sum_Delta_d) by Environment_s | where avg_sum_Delta_d > 20"
                },
                "alert": {
                    "displayName": "CF-Auctioneer App Instance Starts",
                    "description": "The number of LRP instances that the auctioneer successfully placed on Diego cells. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerLRPAuctionsStarted",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerLRPAuctionsStarted.warning",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerLRPAuctionsStarted\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | summarize avg(sum_Delta_d) by Environment_s | where avg_sum_Delta_d > 10"
                },
                "alert": {
                    "displayName": "CF-Auctioneer App Instance Starts",
                    "description": "The number of LRP instances that the auctioneer successfully placed on Diego cells. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerLRPAuctionsStarted",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerTaskAuctionsFailed.critical",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerTaskAuctionsFailed\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | summarize avg(sum_Delta_d) by Environment_s | where avg_sum_Delta_d >= 1"
                },
                "alert": {
                    "displayName": "CF-Auctioneer Task Placement Failures",
                    "description": "The number of Tasks that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerTaskAuctionsFailed",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.auctioneer.AuctioneerTaskAuctionsFailed.warning",
                    "category": "CF-DiegoAuctioneer-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"auctioneer\" and Name_s == \"AuctioneerTaskAuctionsFailed\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | summarize avg(sum_Delta_d) by Environment_s | where avg_sum_Delta_d >= 0.5"
                },
                "alert": {
                    "displayName": "CF-Auctioneer Task Placement Failures",
                    "description": "The number of Tasks that the auctioneer failed to place on Diego cells. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#AuctioneerTaskAuctionsFailed",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "cf.bbs.ConvergenceLRPDuration.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"ConvergenceLRPDuration\" | where Value_d >= 20000000000"
                },
                "alert": {
                    "displayName": "CF-BBS Time to Run LRP Convergence",
                    "description": "Time in ns that the BBS took to run its LRP convergence pass. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#ConvergenceLRPDuration",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.bbs.ConvergenceLRPDuration.warning",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"ConvergenceLRPDuration\" | where Value_d >= 10000000000"
                },
                "alert": {
                    "displayName": "CF-BBS Time to Run LRP Convergence",
                    "description": "Time in ns that the BBS took to run its LRP convergence pass. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#ConvergenceLRPDuration",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.bbs.RequestLatency.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"RequestLatency\" | summarize avg(Value_d) by Environment_s | where avg_Value_d >= 10000000000"
                },
                "alert": {
                    "displayName": "CF-BBS Time to Handle Requests",
                    "description": "Time in ns that the BBS took to handle requests, aggregated across all its API endpoints. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#RequestLatency",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.bbs.RequestLatency.warning",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"RequestLatency\" | summarize avg(Value_d) by Environment_s | where avg_Value_d >= 5000000000"
                },
                "alert": {
                    "displayName": "CF-BBS Time to Handle Requests",
                    "description": "Time in ns that the BBS took to handle requests, aggregated across all its API endpoints. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#RequestLatency",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.bbs.Domain.cf-apps.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"Domain.cf-apps\" | summarize avg(Value_d) by Environment_s | where avg_Value_d < 1"
                },
                "alert": {
                    "displayName": "CF-Cloud Controller and Diego in Sync",
                    "description": "Indicates if the cf-apps Domain is up-to-date, meaning that CF App requests from Cloud Controller are synchronized to bbs.LRPsDesired (Diego-desired AIs) for execution. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#cc-diego-sync",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.bbs.LRPsExtra.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsExtra\" | summarize avg(Value_d) by Environment_s | where avg_Value_d >= 10"
                },
                "alert": {
                    "displayName": "CF-More App Instances Than Expected",
                    "description": "Total number of LRP instances that are no longer desired but still have a BBS record. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsExtra is the total number of LRP instances that are no longer desired but still have a BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#LRPsExtra",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.bbs.LRPsExtra.warning",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsExtra\" | summarize avg(Value_d) by Environment_s | where avg_Value_d >= 5"
                },
                "alert": {
                    "displayName": "CF-More App Instances Than Expected",
                    "description": "Total number of LRP instances that are no longer desired but still have a BBS record. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsExtra is the total number of LRP instances that are no longer desired but still have a BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#LRPsExtra",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.bbs.LRPsMissing.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsMissing\" | summarize avg(Value_d) by Environment_s | where avg_Value_d >= 10"
                },
                "alert": {
                    "displayName": "CF-Fewer App Instances Than Expected",
                    "description": "Total number of LRP instances that are desired but have no record in the BBS. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsMissing is the total number of LRP instances that are desired but have no BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#LRPsMissing",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.bbs.LRPsMissing.warning",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsMissing\" | summarize avg(Value_d) by Environment_s | where avg_Value_d >= 5"
                },
                "alert": {
                    "displayName": "CF-Fewer App Instances Than Expected",
                    "description": "Total number of LRP instances that are desired but have no record in the BBS. When Diego wants to add more apps, the BBS sends a request to the auctioneer to spin up additional LRPs. LRPsMissing is the total number of LRP instances that are desired but have no BBS record. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#LRPsMissing",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.bbs.CrashedActualLRPs.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"CrashedActualLRPs\" | where Value_d > 2"
                },
                "alert": {
                    "displayName": "CF-Crashed App Instances",
                    "description": "Total number of LRP instances that have crashed. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#bbs.CrashedActualLRPs",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.bbs.CrashedActualLRPs.warning",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"CrashedActualLRPs\" | where Value_d > 0"
                },
                "alert": {
                    "displayName": "CF-Crashed App Instances",
                    "description": "Total number of LRP instances that have crashed. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#bbs.CrashedActualLRPs",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.bbs.LRPsRunning.critical",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "let T1 = CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsRunning\" and EventTime_t > ago(1h) | summarize CurrentHourAverage = avg(Value_d) by Environment_s;\nlet T2 = CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsRunning\" and EventTime_t > ago(2h) and EventTime_t < ago(1h) | summarize PreviousHourAverage = avg(Value_d) by Environment_s;\n T1 | join (T2) on Environment_s | where abs(CurrentHourAverage-PreviousHourAverage) > 20"
                },
                "alert": {
                    "displayName": "CF-Running App Instances, Rate of Change",
                    "description": "Rate of change in app instances being started or stopped on the platform. We use changes on GoRouter to detect this metric. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#1hraverageofbbs.LRPsRunning",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 30,
                        "timeSpan": 120
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.bbs.LRPsRunning.warning",
                    "category": "CF-DiegoBBS-KPI",
                    "query": "let T1 = CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsRunning\" and EventTime_t > ago(1h) | summarize CurrentHourAverage = avg(Value_d) by Environment_s;\nlet T2 = CF_ValueMetric_CL | where Origin_s == \"bbs\" and Name_s == \"LRPsRunning\" and EventTime_t > ago(2h) and EventTime_t < ago(1h) | summarize PreviousHourAverage = avg(Value_d) by Environment_s;\n T1 | join (T2) on Environment_s | where abs(CurrentHourAverage-PreviousHourAverage) > 10"
                },
                "alert": {
                    "displayName": "CF-Running App Instances, Rate of Change",
                    "description": "Rate of change in app instances being started or stopped on the platform. We use changes on GoRouter to detect this metric. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#1hraverageofbbs.LRPsRunning",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 30,
                        "timeSpan": 120
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "cf.rep.CapacityRemainingMemory.critical",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"CapacityRemainingMemory\" and Value_d <= 32678"
                },
                "alert": {
                    "displayName": "CF-Overall Remaining Memory Available",
                    "description": "Remaining amount of memory in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#rep.CapacityRemainingMemory2",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.rep.CapacityRemainingMemory.warning",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"CapacityRemainingMemory\" and Value_d <= 65536"
                },
                "alert": {
                    "displayName": "CF-Overall Remaining Memory Available",
                    "description": "Remaining amount of memory in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#rep.CapacityRemainingMemory2",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.rep.CapacityRemainingDisk.critical",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"CapacityRemainingDisk\" and Value_d <= 3584"
                },
                "alert": {
                    "displayName": "CF-Remaining Disk Available",
                    "description": "Remaining amount of disk in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#CapacityRemainingDisk",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.rep.CapacityRemainingDisk.warning",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"CapacityRemainingDisk\" and Value_d <= 8192"
                },
                "alert": {
                    "displayName": "CF-Remaining Disk Available",
                    "description": "Remaining amount of disk in MiB available for this Diego cell to allocate to containers. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#CapacityRemainingDisk",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.rep.RepBulkSyncDuration.critical",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"RepBulkSyncDuration\" and Value_d >= 10000000000"
                },
                "alert": {
                    "displayName": "CF-Cell Rep Time to Sync",
                    "description": "Time in ns that the Diego Cell Rep took to sync the ActualLRPs that it claimed with its actual garden containers. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#RepBulkSyncDuration",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.rep.RepBulkSyncDuration.warning",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"RepBulkSyncDuration\" and Value_d >= 5000000000"
                },
                "alert": {
                    "displayName": "CF-Cell Rep Time to Sync",
                    "description": "Time in ns that the Diego Cell Rep took to sync the ActualLRPs that it claimed with its actual garden containers. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#RepBulkSyncDuration",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.rep.UnhealthyCell.critical",
                    "category": "CF-DiegoCell-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"rep\" and Name_s == \"UnhealthyCell\" and Value_d != 0 | summarize count() by Environment_s"
                },
                "alert": {
                    "displayName": "CF-Unhealthy Cells",
                    "description": "The Diego cell periodically checks its health against the garden backend. For Diego cells, 0 means healthy, and 1 means unhealthy. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#UnhealthyCell",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 1,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "cf.locket.ActiveLocks.critical",
                    "category": "CF-DiegoLocket-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"locket\" and Name_s == \"ActiveLocks\" | summarize max(Value_d) by Environment_s | where max_Value_d != 4"
                },
                "alert": {
                    "displayName": "CF-Active Locks",
                    "description": "Total count of how many locks the system components are holding. As of PCF v1.11, the BBS, Auctioneer, TPS Watcher, and Routing API components have migrated to Locket from Consul lock. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#ActiveLocks",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.locket.ActivePresences.critical",
                    "category": "CF-DiegoLocket-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"locket\" and Name_s == \"ActivePresences\" | where Value_d > 25"
                },
                "alert": {
                    "displayName": "CF-Active Presences",
                    "description": "Total count of active presences. Presences are defined as the registration records that the cells maintain to advertise themselves to the platform. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#ActivePresences",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.locket.ActivePresences.warning",
                    "category": "CF-DiegoLocket-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"locket\" and Name_s == \"ActivePresences\" | where Value_d > 10"
                },
                "alert": {
                    "displayName": "CF-Active Presences",
                    "description": "Total count of active presences. Presences are defined as the registration records that the cells maintain to advertise themselves to the platform. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#ActivePresences",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            
            
            {
                "search": {
                    "name": "cf.route_emitter.RouteEmitterSyncDuration.critical",
                    "category": "CF-RouteEmitter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"route_emitter\" and Name_s == \"RouteEmitterSyncDuration\" | summarize AggregatedValue = max(Value_d) by Job_s | where AggregatedValue > 10000000000"
                },
                "alert": {
                    "displayName": "CF-Route Emitter Time to Sync",
                    "description": "Time in ns that the active route-emitter took to perform its synchronization pass. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#RouteEmitterSyncDuration",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.route_emitter.RouteEmitterSyncDuration.warning",
                    "category": "CF-RouteEmitter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"route_emitter\" and Name_s == \"RouteEmitterSyncDuration\" | summarize AggregatedValue = max(Value_d) by Job_s | where AggregatedValue > 5000000000"
                },
                "alert": {
                    "displayName": "CF-Route Emitter Time to Sync",
                    "description": "Time in ns that the active route-emitter took to perform its synchronization pass. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#RouteEmitterSyncDuration",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 15
                    },
                    "throttleMinutes": 60
                }
            },


            {
                "search": {
                    "name": "cf.mysql.availability.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/available\" and Value_d < 1"
                },
                "alert": {
                    "displayName": "CF-MySQL Server Availability",
                    "description": "The MySQL Server is currently responding to requests, which indicates that the server is running. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-mysql-server-availability",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.mysql.galera.wsrep_ready.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/galera/wsrep_ready\" | summarize avg(Value_d) by Environment_s, SourceInstance_s | where avg_Value_d == 0"
                },
                "alert": {
                    "displayName": "CF-Galera Cluster Node Readiness",
                    "description": "Shows whether each cluster node can accept queries. Returns only 0 or 1. When this metric is 0, almost all queries to that node fail with the error:ERROR 1047 (08501) Unknown Command. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-galera-cluster-node-readiness",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.mysql.galera.wsrep_ready.warning",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/galera/wsrep_ready\" | summarize avg(Value_d) by Environment_s, SourceInstance_s | where avg_Value_d < 1"
                },
                "alert": {
                    "displayName": "CF-Galera Cluster Node Readiness",
                    "description": "Shows whether each cluster node can accept queries. Returns only 0 or 1. When this metric is 0, almost all queries to that node fail with the error:ERROR 1047 (08501) Unknown Command. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-galera-cluster-node-readiness",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "_comment": "Not exactly the same as instruction, as instructed (Average of the values of each node / cluster size) should always be 1",
                "search": {
                    "name": "cf.mysql.galera.wsrep_cluster_size.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/galera/wsrep_cluster_size\" | summarize avg(Value_d) by Environment_s, SourceInstance_s | where avg_Value_d < 1"
                },
                "alert": {
                    "displayName": "CF-Galera Cluster Size",
                    "description": "The number of cluster nodes with which each node is communicating normally. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-galera-cluster-size",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "_comment": "Not exactly the same as instruction, as instructed (Average of the values of each node / cluster size) should always be 1",
                "search": {
                    "name": "cf.mysql.galera.wsrep_cluster_size.warning",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/galera/wsrep_cluster_size\" | summarize avg(Value_d) by Environment_s, SourceInstance_s | where avg_Value_d < 3"
                },
                "alert": {
                    "displayName": "CF-Galera Cluster Size",
                    "description": "The number of cluster nodes with which each node is communicating normally. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-galera-cluster-size",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.mysql.galera.wsrep_cluster_status.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/galera/wsrep_cluster_status\" | summarize argmax(EventTime_t, Value_d) by Environment_s, SourceInstance_s | summarize sum(max_EventTime_t_Value_d) by Environment_s | where sum_max_EventTime_t_Value_d < 1"
                },
                "alert": {
                    "displayName": "CF-Galera Cluster Status",
                    "description": "Shows the primary status of the cluster component that the node is in. Values are 1 for Primary, 0 for Non-primary, -1 for Disconnected. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-galera-cluster-status",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.mysql.galera.wsrep_cluster_status.warning",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/galera/wsrep_cluster_status\" | summarize argmax(EventTime_t, Value_d) by Environment_s, SourceInstance_s | summarize sum(max_EventTime_t_Value_d) by Environment_s | where sum_max_EventTime_t_Value_d < 3"
                },
                "alert": {
                    "displayName": "CF-Galera Cluster Status",
                    "description": "Shows the primary status of the cluster component that the node is in. Values are 1 for Primary, 0 for Non-primary, -1 for Disconnected. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-galera-cluster-status",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "_comment": "Use 5-minute timeSpan due to OMS minimum timespan limitation",
                "search": {
                    "name": "cf.mysql.net.connections.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/net/connections\" | summarize avg(Value_d), max(Value_d) by Environment_s | project Environment_s, avg_Value_d, max_Value_d, avg_ratio = avg_Value_d / max_Value_d | where avg_ratio > 0.9"
                },
                "alert": {
                    "displayName": "CF-Connections per Second",
                    "description": "Connections per second made to the server. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-connections-per-second",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "_comment": "Use 5-minute timeSpan due to OMS minimum timespan limitation",
                "search": {
                    "name": "cf.mysql.net.connections.warning",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/net/connections\" | summarize avg(Value_d), max(Value_d) by Environment_s | project Environment_s, avg_Value_d, max_Value_d, avg_ratio = avg_Value_d / max_Value_d | where avg_ratio > 0.8"
                },
                "alert": {
                    "displayName": "CF-Connections per Second",
                    "description": "Connections per second made to the server. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-connections-per-second",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.mysql.performance.questions.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/performance/questions\" | summarize avg(Value_d) by Environment_s, bin(EventTime_t, 120s) | where avg_Value_d == 0"
                },
                "alert": {
                    "displayName": "CF-Query Rate",
                    "description": "The rate of statements execute by the server, shown as queries per second. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-query-rate",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 6
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.mysql.performance.questions.warning",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/performance/questions\" | summarize avg(Value_d) by Environment_s, bin(EventTime_t, 90s) | where avg_Value_d == 0"
                },
                "alert": {
                    "displayName": "CF-Query Rate",
                    "description": "The rate of statements execute by the server, shown as queries per second. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-query-rate",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 6
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.mysql.performance.busy_time.critical",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/performance/busy_time\" | summarize avg(Value_d) by Environment_s, SourceInstance_s, bin(EventTime_t, 120s) | where avg_Value_d > 90"
                },
                "alert": {
                    "displayName": "CF-MySQL CPU Busy Time",
                    "description": "Percentage of CPU time spent by MySQL on user activity, executing user code, as opposed to kernel activity processing system calls. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-mysql-cpu-busy-time",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 6
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.mysql.performance.busy_time.warning",
                    "category": "CF-MySQL-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"mysql\" and Name_s == \"/mysql/performance/busy_time\" | summarize avg(Value_d) by Environment_s, SourceInstance_s, bin(EventTime_t, 120s) | where avg_Value_d > 80"
                },
                "alert": {
                    "displayName": "CF-MySQL CPU Busy Time",
                    "description": "Percentage of CPU time spent by MySQL on user activity, executing user code, as opposed to kernel activity processing system calls. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#-mysql-cpu-busy-time",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 6
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.file_descriptors.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"file_descriptors\" | summarize max(Value_d) by Environment_s, SourceInstance_s | where max_value_d > 60000"
                },
                "alert": {
                    "displayName": "CF-Router File Descriptors",
                    "description": "The number of file descriptors currently used by the Gorouter job. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#router-file-descriptors",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.file_descriptors.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"file_descriptors\" | summarize max(Value_d) by Environment_s, SourceInstance_s | where max_value_d > 50000"
                },
                "alert": {
                    "displayName": "CF-Router File Descriptors",
                    "description": "The number of file descriptors currently used by the Gorouter job. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#router-file-descriptors",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.backend_exhausted_conns.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"backend_exhausted_conns\" | summarize sum(Delta_d) by Environment_s, SourceInstance_s, bin(EventTime_t, 1m) | where sum_Delta_d > 10"
                },
                "alert": {
                    "displayName": "CF-Router Exhausted Connections",
                    "description": "The lifetime number of requests that have been rejected by the Gorouter VM due to the Max Connections Per Backend limit being reached across all tried backends. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#router-exhausted-connections",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.backend_exhausted_conns.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"backend_exhausted_conns\" | summarize sum(Delta_d) by Environment_s, SourceInstance_s, bin(EventTime_t, 1m) | where sum_Delta_d > 0"
                },
                "alert": {
                    "displayName": "CF-Router Exhausted Connections",
                    "description": "The lifetime number of requests that have been rejected by the Gorouter VM due to the Max Connections Per Backend limit being reached across all tried backends. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#router-exhausted-connections",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.total_requests.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"total_requests\" | summarize sum(Delta_d) by SourceInstance_s | where sum_Delta_d > 100000"
                },
                "alert": {
                    "displayName": "CF-Router Throughput",
                    "description": "The lifetime number of requests completed by the GoRouter VM. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#total_requests",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.total_requests.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"total_requests\" | summarize sum(Delta_d) by SourceInstance_s | where sum_Delta_d > 50000"
                },
                "alert": {
                    "displayName": "CF-Router Throughput",
                    "description": "The lifetime number of requests completed by the GoRouter VM. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#total_requests",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.latency.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"latency\" | summarize avg(Value_d) by SourceInstance_s | where avg_Value_d > 5000"
                },
                "alert": {
                    "displayName": "CF-Router Handling Latency",
                    "description": "The time in milliseconds that the GoRouter takes to handle requests to its app endpoints. This is the average round trip response time to an app, which includes router handling. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#latency",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.latency.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"latency\" | summarize avg(Value_d) by SourceInstance_s | where avg_Value_d > 3000"
                },
                "alert": {
                    "displayName": "CF-Router Handling Latency",
                    "description": "The time in milliseconds that the GoRouter takes to handle requests to its app endpoints. This is the average round trip response time to an app, which includes router handling. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#latency",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.ms_since_last_registry_update.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"ms_since_last_registry_update\" and Value_d >= 30000"
                },
                "alert": {
                    "displayName": "CF-Time Since Last Route Register Received",
                    "description": "Time in milliseconds since the last route register was received. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#mssincelastregistryupdate",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.bad_gateways.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"bad_gateways\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | where sum_Delta_d > 15"
                },
                "alert": {
                    "displayName": "CF-Router Error: 502 Bad Gateway",
                    "description": "The lifetime number of bad gateways, or 502 responses, from GoRouter itself. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#bad_gateways",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.bad_gateways.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"bad_gateways\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | where sum_Delta_d > 0"
                },
                "alert": {
                    "displayName": "CF-Router Error: 502 Bad Gateway",
                    "description": "The lifetime number of bad gateways, or 502 responses, from GoRouter itself. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#bad_gateways",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            
            {
                "search": {
                    "name": "cf.gorouter.responses.5xx.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"responses.5xx\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | where sum_Delta_d > 15"
                },
                "alert": {
                    "displayName": "CF-Router Error: Server Error",
                    "description": "The lifetime number of requests completed by the GoRouter VM for HTTP status family 5xx, server errors. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#responses.5xx",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.responses.5xx.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"responses.5xx\" | summarize sum(Delta_d) by Environment_s, bin(EventTime_t, 1m) | where sum_Delta_d > 0"
                },
                "alert": {
                    "displayName": "CF-Router Error: Server Error",
                    "description": "The lifetime number of requests completed by the GoRouter VM for HTTP status family 5xx, server errors. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#responses.5xx",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.total_routes.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "let T1 = CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"total_routes\" | summarize TotalRoutes = avg(Value_d) by Environment_s, bin(EventTime_t, 5m);\nlet T2 = T1 | project Environment_s, EventTime_t = EventTime_t-5m, TotalRoutesPrevious = TotalRoutes;\nT1 | join T2 on Environment_s, EventTime_t | project Environment_s, EventTime_t, TotalRoutes, TotalRoutesPrevious, TotalRoutesDelta = TotalRoutesPrevious - TotalRoutes | where TotalRoutesDelta > 20"
                },
                "alert": {
                    "displayName": "CF-Number of GoRouter Routes Registered",
                    "description": "The current total number of routes registered with the GoRouter. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#total_routes",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 10
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.total_routes.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "let T1 = CF_ValueMetric_CL | where Origin_s == \"gorouter\" and Name_s == \"total_routes\" | summarize TotalRoutes = avg(Value_d) by Environment_s, bin(EventTime_t, 5m);\nlet T2 = T1 | project Environment_s, EventTime_t = EventTime_t-5m, TotalRoutesPrevious = TotalRoutes;\nT1 | join T2 on Environment_s, EventTime_t | project Environment_s, EventTime_t, TotalRoutes, TotalRoutesPrevious, TotalRoutesDelta = TotalRoutesPrevious - TotalRoutes | where TotalRoutesDelta > 10"
                },
                "alert": {
                    "displayName": "CF-Number of GoRouter Routes Registered",
                    "description": "The current total number of routes registered with the GoRouter. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#total_routes",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 10
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.gorouter.registry_message.route-emitter.critical",
                    "category": "CF-GoRouter-KPI",
                    "query": "let T1 = CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"registry_message.route-emitter\" | summarize RegistryMessage = sum(Delta_d) by Environment_s;\nlet T2 = CF_CounterEvent_CL | where Origin_s == \"route_emitter\" and Name_s == \"MessagesEmitted\" | summarize MessagesEmitted = sum(Delta_d) by Environment_s;\nT1 | join T2 on Environment_s | project Environment_s, RegistryMessage, MessagesEmitted, MessageLost = RegistryMessage - MessagesEmitted | where MessageLost > 20"
                },
                "alert": {
                    "displayName": "CF-Number of Route Registration Messages Sent and Received",
                    "description": "The difference between the aggregate number of route registration messages published by all the Route Emitters and the number of messages received by each Gorouter instance. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#number-of-route-registration-messages-sent-and-received",
                    "severity": "Critical",
                    "enabled": "false",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.gorouter.registry_message.route-emitter.warning",
                    "category": "CF-GoRouter-KPI",
                    "query": "let T1 = CF_CounterEvent_CL | where Origin_s == \"gorouter\" and Name_s == \"registry_message.route-emitter\" | summarize RegistryMessage = sum(Delta_d) by Environment_s;\nlet T2 = CF_CounterEvent_CL | where Origin_s == \"route_emitter\" and Name_s == \"MessagesEmitted\" | summarize MessagesEmitted = sum(Delta_d) by Environment_s;\nT1 | join T2 on Environment_s | project Environment_s, RegistryMessage, MessagesEmitted, MessageLost = RegistryMessage - MessagesEmitted | where MessageLost > 0"
                },
                "alert": {
                    "displayName": "CF-Number of Route Registration Messages Sent and Received",
                    "description": "The difference between the aggregate number of route registration messages published by all the Route Emitters and the number of messages received by each Gorouter instance. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#number-of-route-registration-messages-sent-and-received",
                    "severity": "Warning",
                    "enabled": "false",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "cf.DopplerServer.listeners.totalReceivedMessageCount.critical",
                    "category": "CF-Firehose-KPI",
                    "query": "CF_CounterEvent_CL | where (Origin_s == \"DopplerServer\" and Name_s == \"listeners.totalReceivedMessageCount\") or (Origin_s == \"loggregator.doppler\" and Name_s == \"ingress\") | summarize AveragePerMinute = sum(Delta_d) by Environment_s, bin(EventTime_t, 1min) | summarize MaximumPer5Minute = max(AveragePerMinute) by Environment_s | where MaximumPer5Minute > 20000"
                },
                "alert": {
                    "displayName": "CF-Firehose Throughput",
                    "description": "The total number of messages received across all Doppler listeners: UDP, TCP, TLS, and GRPC. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#listeners.receivedEnvelopes",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.DopplerServer.listeners.totalReceivedMessageCount.warning",
                    "category": "CF-Firehose-KPI",
                    "query": "CF_CounterEvent_CL | where (Origin_s == \"DopplerServer\" and Name_s == \"listeners.totalReceivedMessageCount\") or (Origin_s == \"loggregator.doppler\" and Name_s == \"ingress\") | summarize AveragePerMinute = sum(Delta_d) by Environment_s, bin(EventTime_t, 1min) | summarize MaximumPer5Minute = max(AveragePerMinute) by Environment_s | where MaximumPer5Minute > 15000"
                },
                "alert": {
                    "displayName": "CF-Firehose Throughput",
                    "description": "The total number of messages received across all Doppler listeners: UDP, TCP, TLS, and GRPC. <NOTICE>This alert should have threshold settings based on scale and usage of your own CF deployment, please tuning its threshold in OMS settings if the default value is not suitable.</NOTICE> For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#listeners.receivedEnvelopes",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.DopplerServer.doppler.shedEnvelopes.critical",
                    "category": "CF-Firehose-KPI",
                    "query": "CF_CounterEvent_CL | where (Origin_s == \"DopplerServer\" and Name_s == \"doppler.shedEnvelopes\") or (Origin_s == \"loggregator.doppler\" and Name_s == \"dropped\") | summarize AveragePerMinute = sum(Delta_d) by Environment_s, bin(EventTime_t, 1min) | summarize MaximumPer5Minute = max(AveragePerMinute) by Environment_s | where MaximumPer5Minute > 5"
                },
                "alert": {
                    "displayName": "CF-Firehose Dropped Messages",
                    "description": "The lifetime total number of messages intentionally dropped by Doppler due to back pressure. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#deriveddopplerserver.doppler",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.DopplerServer.doppler.shedEnvelopes.warning",
                    "category": "CF-Firehose-KPI",
                    "query": "CF_CounterEvent_CL | where (Origin_s == \"DopplerServer\" and Name_s == \"doppler.shedEnvelopes\") or (Origin_s == \"loggregator.doppler\" and Name_s == \"dropped\") | summarize AveragePerMinute = sum(Delta_d) by Environment_s, bin(EventTime_t, 1min) | summarize MaximumPer5Minute = max(AveragePerMinute) by Environment_s | where MaximumPer5Minute > 0"
                },
                "alert": {
                    "displayName": "CF-Firehose Dropped Messages",
                    "description": "The lifetime total number of messages intentionally dropped by Doppler due to back pressure. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#deriveddopplerserver.doppler",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "cf.system.healthy.critical",
                    "category": "CF-BOSH-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.healthy\" and Value_d < 1"
                },
                "alert": {
                    "displayName": "CF-VM Health",
                    "description": "The lifetime total number of messages intentionally dropped by Doppler due to back pressure. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#healthy",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.system.mem.percent.critical",
                    "category": "CF-BOSH-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.mem.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 90"
                },
                "alert": {
                    "displayName": "CF-VM Memory Used",
                    "description": "System Memory — Percentage of memory used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#mem.percent",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 10
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.system.mem.percent.warning",
                    "category": "CF-BOSH-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.mem.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 80"
                },
                "alert": {
                    "displayName": "CF-VM Memory Used",
                    "description": "System Memory — Percentage of memory used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#mem.percent",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 10
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.system.disk.system.percent.critical",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.disk.system.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 90"
                },
                "alert": {
                    "displayName": "CF-VM Disk Used",
                    "description": "System disk — Percentage of the system disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#disk.system.percent",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.system.disk.system.percent.warning",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.disk.system.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 80"
                },
                "alert": {
                    "displayName": "CF-VM Disk Used",
                    "description": "System disk — Percentage of the system disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#disk.system.percent",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.system.disk.ephemeral.percent.critical",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.disk.ephemeral.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 90"
                },
                "alert": {
                    "displayName": "CF-VM Ephemeral Disk Used",
                    "description": "Ephemeral disk — Percentage of the ephemeral disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#disk.ephemeral.percent",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.system.disk.ephemeral.percent.warning",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.disk.ephemeral.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 80"
                },
                "alert": {
                    "displayName": "CF-VM Ephemeral Disk Used",
                    "description": "Ephemeral disk — Percentage of the ephemeral disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#disk.ephemeral.percent",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.system.disk.persistent.percent.critical",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.disk.persistent.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 90"
                },
                "alert": {
                    "displayName": "CF-VM Persistent Disk Used",
                    "description": "Persistent disk — Percentage of persistent disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#disk.persistent.percent",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.system.disk.persistent.percent.warning",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.disk.persistent.percent\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 80"
                },
                "alert": {
                    "displayName": "CF-VM Persistent Disk Used",
                    "description": "Persistent disk — Percentage of persistent disk used on the VM. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#disk.persistent.percent",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 30
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.system.cpu.user.critical",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.cpu.user\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 95"
                },
                "alert": {
                    "displayName": "CF-VM CPU Utilization",
                    "description": "CPU utilization — The percentage of CPU spent in user processes. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#cpu.user",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },
            {
                "search": {
                    "name": "cf.system.cpu.user.warning",
                    "category": "CF-System-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"bosh-hm-forwarder\" or Origin_s == \"bosh-system-metrics-forwarder\" | where Name_s == \"system.cpu.user\" | summarize AggregatedValue = avg(Value_d) by SourceInstance_s | where AggregatedValue >= 85"
                },
                "alert": {
                    "displayName": "CF-VM CPU Utilization",
                    "description": "CPU utilization — The percentage of CPU spent in user processes. For details, please check https://docs.pivotal.io/pivotalcf/1-12/monitoring/kpi.html#cpu.user",
                    "severity": "Warning",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 5,
                        "timeSpan": 5
                    },
                    "throttleMinutes": 60
                }
            },

            
            {
                "search": {
                    "name": "cf.Consul is Down",
                    "category": "CF-Consul-KPI",
                    "query": "CF_ValueMetric_CL | where Origin_s == \"route_emitter\" and Name_s == \"ConsulDownMode\" and Value_d > 0"
                },
                "alert": {
                    "displayName": "CF-Consul is Down",
                    "description": "Consul is Down",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.Problem in Logging Process",
                    "category": "CF-Loggregator-KPI",
                    "query": "CF_LogMessage_CL | where SourceType_s == \"LGR\" and MessageType_s == \"ERR\""
                },
                "alert": {
                    "displayName": "CF-Problem in Logging Process",
                    "description": "Loggregator emits LGR to indicate problems with the logging process",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.Slow Consumer Alert",
                    "category": "CF-Loggregator-KPI",
                    "query": "CF_ValueMetric_CL | where Name_s == \"slowConsumerAlert\""
                },
                "alert": {
                    "displayName": "CF-Slow Consumer Alert",
                    "description": "When the nozzle receives slow consumer alert from Loggregator, it sends slowConsumerAlert ValueMetric to OMS",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            },

            {
                "search": {
                    "name": "cf.Lost Events from Nozzle",
                    "category": "CF-OMS Nozzle-KPI",
                    "query": "CF_CounterEvent_CL | where Job_s == \"nozzle\" and Name_s == \"eventsLost\" and Delta_d > 0"
                },
                "alert": {
                    "displayName": "CF-Lost Events from Nozzle",
                    "description": "Lost Events from Nozzle",
                    "severity": "Critical",
                    "enabled": "true",
                    "thresholdOperator": "gt",
                    "thresholdValue": 0,
                    "schedule": {
                        "interval": 15,
                        "timeSpan": 60
                    },
                    "throttleMinutes": 60
                }
            }
        ]
    },
    "resources": [
        {
            "name": "[concat(parameters('omsWorkspaceName'), '/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name))]",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
            "apiVersion": "2017-03-15-preview",
            "copy": {
                "name": "cf.alert.searches",
                "mode": "Parallel",
                "count": "[length(variables('alerts'))]"
            },
            "tags": {},
            "properties": {
                "etag": "*",
                "query": "[variables('alerts')[copyIndex()].search.query]",
                "displayName": "[concat(variables('alerts')[copyIndex()].search.name)]",
                "category": "[variables('alerts')[copyIndex()].search.category]"
            }
        },
        {
            "name": "[concat(parameters('omsWorkspaceName'), '/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name), '/', 'schedule-', uniqueString(resourceGroup().id, deployment().name, parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name))]",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches/schedules",
            "apiVersion": "2017-03-15-preview",
            "copy": {
                "name": "cf.alert.schedules",
                "mode": "Parallel",
                "count": "[length(variables('alerts'))]"
            },
            "tags": {},
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'), '/savedSearches/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name))]"
            ],
            "properties": {
                "etag": "*",
                "interval": "[variables('alerts')[copyIndex()].alert.schedule.interval]",
                "queryTimeSpan": "[variables('alerts')[copyIndex()].alert.schedule.timeSpan]",
                "enabled": "[variables('alerts')[copyIndex()].alert.enabled]"
            }
        },
        {
            "name": "[concat(parameters('omsWorkspaceName'), '/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name), '/', 'schedule-', uniqueString(resourceGroup().id, deployment().name, parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name), '/', 'alert-', uniqueString(resourceGroup().id, deployment().name, parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name))]",
            "type": "Microsoft.OperationalInsights/workspaces/savedSearches/schedules/actions",
            "apiVersion": "2017-03-15-preview",
            "copy": {
                "name": "cf.alert.alerts",
                "mode": "Parallel",
                "count": "[length(variables('alerts'))]"
            },
            "dependsOn": [
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'), '/savedSearches/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name))]",
                "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsWorkspaceName'), '/savedSearches/', toLower(variables('alerts')[copyIndex()].search.category), '|', toLower(variables('alerts')[copyIndex()].search.name), '/schedules/','schedule-',uniqueString(resourceGroup().id, deployment().name,parameters('omsWorkspaceName'), '/', variables('alerts')[copyIndex()].search.category, '|', variables('alerts')[copyIndex()].search.name))]"
            ],
            "tags": {
                "Source": "QuickstartTemplates"
            },
            "properties": {
                "etag": "*",
                "Type": "Alert",
                "Name": "[variables('alerts')[copyIndex()].alert.displayName]",
                "Description": "[variables('alerts')[copyIndex()].alert.description]",
                "Severity": "[toLower(variables('alerts')[copyIndex()].alert.severity)]",
                "Threshold": {
                    "Operator": "[variables('alerts')[copyIndex()].alert.thresholdOperator]",
                    "Value": "[variables('alerts')[copyIndex()].alert.thresholdValue]"
                },
                "Throttling": {
                    "DurationInMinutes": "[variables('alerts')[copyIndex()].alert.throttleMinutes]"
                },
                "AzNsNotification": {
                    "GroupIds": ["[concat(resourceGroup().id, '/providers/microsoft.insights/actiongroups/', parameters('actionGroupName'))]"],
                    "CustomEmailSubject": "[concat('[', toUpper(variables('alerts')[copyIndex()].alert.severity), '] ', variables('alerts')[copyIndex()].alert.displayName)]"
                }
            }
        }
    ]
}