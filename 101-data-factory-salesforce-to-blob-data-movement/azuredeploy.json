{
        "contentVersion": "1.0.0.0",
        "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
        "parameters": 
		{
            "dataFactoryName": { "type": "string", "metadata": {"description":  "Name of the Azure Data Factory"} },
            "storageAccountName": { "type": "string" , "metadata": {"description":  "Name of the Azure Storage"} },
            "storageAccountKey": { "type": "securestring" , "metadata": {"description":  "Key associated with the corresponding Azure Storage"} },
            "SfUserName": { "type": "string" , "metadata": {"description":  "User Name associated with Salesforce account"} },
            "SfPassword": { "type": "securestring" , "metadata": {"description":  "Password associated with the corresponding Salesforce account"} },
            "SfSecurityToken": { "type": "securestring" , "metadata": {"description":  "Password associated with the corresponding Salesforce account"} },
			"SfTable": { "type": "string" , "metadata": {"description":  "Salesforce Object from where to copy the data from"} },            
        },
        "variables": {
            "apiVersion": "2015-10-01",
            "SfLinkedServiceName": "SflLinkedService",
            "storageLinkedServiceName": "StorageLinkedService",
			"SfDataset": "SfDataset",
			"StorageDataset": "StorageContainerDataset", 
			"PipelineName": "SftoBlobsCopyPipeline"
        },
        "resources": 
		[
			{			
				"name": "[parameters('dataFactoryName')]",			
				"apiVersion": "[variables('apiVersion')]",
				"type": "Microsoft.DataFactory/datafactories",
				"location": "west us",
				"resources": 
				[
					{
						"dependsOn": [ "[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'))]" ],
						"type": "Microsoft.DataFactory/datafactories/linkedservices",
						"name": "[concat(parameters('dataFactoryName'), '/', variables('SfLinkedServiceName'))]",
						"apiVersion": "[variables('apiVersion')]",
						"properties": 
						{
							"type": "Salesforce",
							"description": "SalesForce Linked Service",
							"typeProperties": 
							{
									"username": "[parameters('SfUserName')]",
									"password": "[parameters('SfPassword')]",
									"securityToken": "[parameters('SfSecurityToken')]"
							}
						}
					},
					{
						"dependsOn": [ "[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'))]" ],
						"type": "Microsoft.DataFactory/datafactories/linkedservices",
						"name": "[concat(parameters('dataFactoryName'), '/', variables('storageLinkedServiceName'))]",
						"apiVersion": "[variables('apiVersion')]",
						"properties": 
						{
							"type": "AzureStorage",
							"description": "Azure Blobs Storage Linked Service",
							"typeProperties": 
							{								
								"connectionString": "[concat('DefaultEndpointsProtocol=https;AccountName=',parameters('storageAccountName'),';AccountKey=',parameters('storageAccountKey'))]"
							}
						}
					},
					{
						"dependsOn": 
						[
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'))]",
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'), '/linkedServices/', variables('SfLinkedServiceName'))]"
						],
						"type": "Microsoft.DataFactory/datafactories/datasets",
						"name": "[concat(parameters('dataFactoryName'), '/', variables('SfDataset'))]",
						"apiVersion": "[variables('apiVersion')]",
						"properties": 
						{
							"type": "RelationalTable",
							"linkedServiceName": "[variables('SfLinkedServiceName')]",                 
							"typeProperties": 
							{
								"tableName": "[parameters('SfTable')]" 
							},
							"availability": {
								"frequency": "Day",
								"interval": 1
							},
							"external": true
						}
					},           
					{
						"dependsOn": 
						[
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'))]",
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]"
						],
						"type": "Microsoft.DataFactory/datafactories/datasets",
						"name": "[concat(parameters('dataFactoryName'), '/', variables('StorageDataset'))]",
						"apiVersion": "[variables('apiVersion')]",
						"properties": {
							"type": "AzureBlob",
							"linkedServiceName": "[variables('storageLinkedServiceName')]",                
							"typeProperties": {
								"folderPath": "datafromsftable/{Year}/{Month}/{Day}/Data.csv",                       
								"partitionedBy": 
								[
									{ "name": "Year", "value": { "type": "DateTime", "date": "SliceStart", "format": "yyyy" } },
									{ "name": "Month", "value": { "type": "DateTime", "date": "SliceStart", "format": "%M" } },
									{ "name": "Day", "value": { "type": "DateTime", "date": "SliceStart", "format": "%d" } }
								],
								"format": {
									"type": "TextFormat"
								}
							},
							"availability": {
								"frequency": "Day",
								"interval": 1
							},
							"external": false
						}
					},          
					{
						"dependsOn": 
						[
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'))]",
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'), '/linkedServices/', variables('SfLinkedServiceName'))]",
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'), '/linkedServices/', variables('storageLinkedServiceName'))]",
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'), '/datasets/', variables('SfDataset'))]",
							"[concat('Microsoft.DataFactory/dataFactories/', parameters('dataFactoryName'), '/datasets/', variables('StorageDataset'))]"                    
						],
						"type": "Microsoft.DataFactory/datafactories/datapipelines",
						"name": "[concat(parameters('dataFactoryName'), '/', variables('PipelineName'))]",
						"apiVersion": "[variables('apiVersion')]",
						"properties": 
						{
							"description": "Pipeline to copy data from SF Object to Azure Blobs",
							"activities": 
							[                     
								{
									"name": "SftoBlobsCopyActivity",
									"description": "Copies data from SF Table to Azure Blobs",
									"type": "Copy",
									"inputs": [{ "name": "[variables('SfDataset')]" }],
									"outputs": [{ "name": "[variables('StorageDataset')]" }],
									"typeProperties": 
									{	
										"source": {"type": "RelationalSource"},
										"sink": {"type": "BlobSink"}
									},
									"Policy": 
									{
										"retry": 3,
										"timeout": "00:30:00"
									}
								}
							],
							"start": "2016-10-01T00:00:00Z",
							"end": "2016-10-01T00:00:00Z"
						}
					}
				]
			}	        
        ]
    }