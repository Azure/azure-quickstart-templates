{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {"type": "string"},
    "vmName": { "type": "string" },
    "dataDiskCount": { "type": "int" },
    "dataDiskSizeGB": { "type": "int" }
  },
  "variables": {
    "disksAPI": "2017-03-30",
    "dataDisks": [
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-1'))]"
        },
        "lun": 0,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-2'))]"
        },
        "lun": 1,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-3'))]"
        },
        "lun": 2,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-4'))]"
        },
        "lun": 3,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-5'))]"
        },
        "lun": 4,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-6'))]"
        },
        "lun": 5,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-7'))]"
        },
        "lun": 6,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-8'))]"
        },
        "lun": 7,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-9'))]"
        },
        "lun": 8,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-10'))]"
        },
        "lun": 9,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-11'))]"
        },
        "lun": 10,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-12'))]"
        },
        "lun": 11,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-13'))]"
        },
        "lun": 12,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-14'))]"
        },
        "lun": 13,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-15'))]"
        },
        "lun": 14,
        "caching": "None",
        "createOption": "Attach"
      },
      {
        "managedDisk": {
          "id": "[resourceId('Microsoft.Compute/disks',concat(parameters('vmName'),'-datadisk-16'))]"
        },
        "lun": 15,
        "caching": "None",
        "createOption": "Attach"
      }
    ]
  },
  "resources": [
    {
      "type": "Microsoft.Compute/disks",
      "apiVersion": "[variables('disksAPI')]",
      "location": "[parameters('location')]",
      "tags": {},
      "copy": {
        "count": "[parameters('dataDiskCount')]",
        "name": "managedDataDiskCopy"
      },
      "name": "[concat(parameters('vmName'),'-datadisk-',copyIndex(1))]",
      "properties": {
        "diskSizeGB": "[parameters('dataDiskSizeGB')]",
        "creationData": {
          "createOption": "Empty"
        }
      }
    }
  ],
  "outputs": {
    "dataDisks": {
      "type": "array",
      "value": "[take(variables('dataDisks'),parameters('dataDiskCount'))]"
    }
  }
}
