{
   "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "AlertName":{
         "type":"String"
      },
      "ApplicationGatewayResourceID":{
         "type":"String",
         "metadata":{
            "description":"Application Gateway ResourceID example /subscriptions/subs-id/resourceGroups/rg-name/providers/Microsoft.Network/applicationGateways/agw-name"
         }
      },
      "ActionGroupID":{
         "type":"String",
         "metadata":{
            "description":"Action GroupID example /subscriptions/subs-id/resourceGroups/rg-name/providers/microsoft.insights/actiongroups/action-group-name"
         }
      }
   },
   "variables":{
      
   },
   "resources":[
      {
         "type":"microsoft.insights/metricAlerts",
         "apiVersion":"2018-03-01",
         "name":"[parameters('AlertName')]",
         "location":"global",
         "properties":{
            "severity":2,
            "enabled":true,
            "scopes":[
               "[parameters('ApplicationGatewayResourceID')]"
            ],
            "evaluationFrequency":"PT5M",
            "windowSize":"PT5M",
            "criteria":{
               "allOf":[
                  {
                     "alertSensitivity":"High",
                     "failingPeriods":{
                        "numberOfEvaluationPeriods":4,
                        "minFailingPeriodsToAlert":4
                     },
                     "name":"Metric1",
                     "metricNamespace":"Microsoft.Network/applicationGateways",
                     "metricName":"UnhealthyHostCount",
                     "operator":"GreaterThan",
                     "timeAggregation":"Average",
                     "criterionType":"DynamicThresholdCriterion"
                  }
               ],
               "odata.type":"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria"
            },
            "autoMitigate":true,
            "targetResourceType":"Microsoft.Network/applicationGateways",
            "actions":[
               {
                  "actionGroupId":"[parameters('ActionGroupID')]",
                  "webHookProperties":{
                     
                  }
               }
            ]
         }
      }
   ]
}
