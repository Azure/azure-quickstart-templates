{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "policyName": {
            "type": "string"
        },
        "location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]"
        },
        "mappingName": {
            "type": "string"
        }, 
        "policyId": {
            "type": "string"
        },
        "kvUri": {
            "type": "string"
        },
        "kvId": {
            "type": "string"
        },
        "saId": {
            "type": "string"
        },
        "saSas": {
            "type": "string"
        },
        "sbSecret": {
            "type": "string"
        },
        "sbSecretValue": {
            "type": "string"
        },
         "migrationItemName": {
            "type": "string"
        },
        "mappingName": {
            "type": "string"
        },
        "policyId": {
            "type": "string"
        },
        "vmWareMachineId": {
            "type": "string"
        },
        "targetResourceGroupId": {
            "type": "string"
        },
        "targetNetworkId": {
            "type": "string"
        },
        "targetSubnetName": {
            "type": "string"
        },
        "licenseType": {
            "type": "string"
        },
        "diskId": {
            "type": "string"
        },
        "lsaAccountId": {
            "type": "string"
        },
        "sasName": {
            "type": "string"
        },
        "diskType": {
            "type": "string"
        },
        "dataMoverAccountId": {
            "type": "string"
        },
        "snapRunAsAccountId": {
            "type": "string"
        },
        "targetBootDiagnosticsStorageAccountId": {
            "type": "string"
        }
    },
    "variables": {  },
    "functions": [  ],
    "resources": [
         {
            "type": "Microsoft.RecoveryServices/vaults/replicationPolicies",
            "apiVersion": "2018-01-10",
            "name": "[parameters('policyName')]",
            "dependsOn": [],
            "properties": {
                "providerSpecificInput": {
                    "instanceType": "VMwareCbt",
                    "appConsistentFrequencyInMinutes": 240,
                    "crashConsistentFrequencyInMinutes": 60,
                    "recoveryPointHistoryInMinutes": 4320
                }
            }
        },
        {
            "type": "Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationProtectionContainerMappings",
            "apiVersion": "2018-01-10",
            "name": "[parameters('mappingName')]",
            "dependsOn": [
                "[parameters('policyId')]"
            ],
            "properties": {
                "providerSpecificInput": {
                    "instanceType": "VMwareCbt",
                    "keyVaultUri": "[parameters('kvUri')]",
                    "keyVaultId": "[parameters('kvId')]",
                    "storageAccountId": "[parameters('saId')]",
                    "storageAccountSasSecretName": "[parameters('saSas')]",
                    "serviceBusConnectionStringSecretName": "ServiceBusConnectionString",
                    "targetLocation": "[parameters('location')]"
                },
                "policyId": "[parameters('policyId')]",
                "targetProtectionContainerId": "Microsoft Azure"
            }
        },
        {
            "type": "Microsoft.KeyVault/vaults/secrets",
            "apiVersion": "2016-10-01",
            "name": "[parameters('sbSecret')]",
            "location": "[parameters('location')]",
            "dependsOn": [],
            "kind": "KeyVault",
            "properties": {
                "contentType": "",
                "value": "[parameters('sbSecretValue')]"
            }
        },
             {
            "type": "Microsoft.RecoveryServices/vaults/replicationFabrics/replicationProtectionContainers/replicationMigrationItems",
            "apiVersion": "2018-01-10",
            "name": "[parameters('migrationItemName')]",
            "dependsOn": [
                "[parameters('mappingName')]"
            ],
            "properties": {
                "policyId": "[parameters('policyId')]",
                "providerSpecificDetails": {
                    "instanceType": "VMwareCbt",
                    "vmwareMachineId": "[parameters('vmwareMachineId')]",
                    "targetResourceGroupId": "[parameters('targetResourceGroupId')]",
                    "targetNetworkId": "[parameters('targetNetworkId')]",
                    "targetSubnetName": "[parameters('targetSubnetName')]",
                    "licenseType": "[parameters('licenseType')]",
                    "disksToInclude": [
                        {
                            "diskId": "[parameters('diskId')]",
                            "isOSDisk": "true",
                            "logStorageAccountId": "[parameters('lsaAccountId')]",
                            "logStorageAccountSasSecretName": "[parameters('sasName')]",
                            "diskType": "[parameters('diskType')]"
                        }
                    ],
                    "dataMoverRunAsAccountId": "[parameters('dataMoverAccountId')]",
                    "snapshotRunAsAccountId": "[parameters('snapRunAsAccountId')]",
                    "targetBootDiagnosticsStorageAccountId": "[parameters('targetBootDiagnosticsStorageAccountId')]",
                    "performAutoResync": "true",
                    "targetVmName": "prsadhu-TestVM"
                }
            }
        }
    ]
  }