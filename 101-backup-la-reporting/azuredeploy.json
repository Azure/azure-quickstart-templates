{
    "$schema":"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion":"1.0.0.0",
    "parameters":{
      "workspaceLocation": {
         "type": "string",
         "metadata": {
           "description": "Specify the workspace region"
         }
       },
      
       "workspaceName":{
          "type":"string",
          "metadata":{
             "description":"Specify the workspace name"
          }
       },
       "_artifactsLocation":{
          "type":"string",
          "defaultValue":"https://raw.githubusercontent.com/Azure/azure-quickstart-templates/master/101-backup-la-reporting/",
          "metadata":{
             "description":"The base URI where artifacts required by this template are located"
          }
       },
       "_artifactsLocationSasToken":{
          "type":"securestring",
          "defaultValue":"",
          "metadata":{
             "description":"The sasToken required to access _artifactsLocation.  When the template is deployed using the accompanying scripts, a sasToken will be automatically generated"
          }
       }
    },
    "variables":{
       "nestedTemplates":{
          "backup_jobs_non_log":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/backup_jobs_non_log.json', parameters('_artifactsLocationSasToken'))]",
          "backup_jobs_log":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/backup_jobs_log.json', parameters('_artifactsLocationSasToken'))]",
          "restore_jobs":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/restore_jobs.json', parameters('_artifactsLocationSasToken'))]",
          "azure_alerts":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/azure_alerts.json', parameters('_artifactsLocationSasToken'))]",
          "on_prem_alerts":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/on_prem_alerts.json', parameters('_artifactsLocationSasToken'))]",
          "backup_items":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/backup_items.json', parameters('_artifactsLocationSasToken'))]",
          "cloud_storage":"[concat(parameters('_artifactsLocation'), 'nestedtemplates/cloud_storage.json', parameters('_artifactsLocationSasToken'))]"
       },
       "omsSolutions":{
          "customSolution":{
             "name":"Azure Backup Monitoring Solution",
             "view1":"backup_jobs_non_log",
             "view2":"backup_jobs_log",
             "view3":"restore_jobs",
             "view4":"azure_alerts",
             "view5":"on_prem_alerts",
             "view6":"backup_items",
             "view7":"cloud_storage",
             "solutionName":"[concat('AzureBackup', '[', parameters('workspaceName'), ']')]",
             "publisher":"Microsoft",
             "displayName":"Azure Backup Monitoring and Reporting Solution",
             "description":"Analyze your Backup Vaults",
             "author":"Microsoft"
          }
       }
    },

          "resources":[
             {
                "apiVersion":"2019-05-01",
                "name": "backup_jobs_non_log",
                "type":"Microsoft.Resources/deployments",
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').backup_jobs_non_log]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                   
                  
                }
             },
             {
                "apiVersion":"2019-05-01",
                "name":"backup_jobs_log",
                "type":"Microsoft.Resources/deployments",
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').backup_jobs_log]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                  
                }
               },
             {
                "apiVersion":"2019-05-01",
                "name":"restore_jobs",
                "type":"Microsoft.Resources/deployments",
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').restore_jobs]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                   
                }
             },
             {
                "apiVersion":"2019-05-01",
                "name":"azure_alerts",
                "type":"Microsoft.Resources/deployments",
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').azure_alerts]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                   
                }
             },
             {
                "apiVersion":"2019-05-01",
                "name":"on_prem_alerts",
                "type":"Microsoft.Resources/deployments",
               
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').on_prem_alerts]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                }
             },
             {
                "apiVersion":"2019-05-01",
                "name":"backup_items",
                "type":"Microsoft.Resources/deployments",
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').backup_items]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                }
             },
             {
                "apiVersion":"2019-05-01",
                "name":"cloud_storage",
                "type":"Microsoft.Resources/deployments",
                
                "properties":{
                   "mode":"Incremental",
                   "templateLink":{
                      "uri":"[variables('nestedTemplates').cloud_storage]",
                      "contentVersion":"1.0.0.0"
                   },
                   "parameters":{
                     "workspaceLocation":{"value": "[parameters('workspaceLocation')]"} ,
                     "workspaceName":{"value": "[parameters('workspaceName')]"} 
                  
                  }
                }
             }
             
          ]
        
    
 }