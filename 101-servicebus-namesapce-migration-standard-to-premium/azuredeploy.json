{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "serviceBusNamespaceNameStandrad": {
      "type": "string",
      "metadata": {
        "description": "Name of Service Bus namespace"
      }
    },
    "serviceBusNamespaceNamePremium": {
      "type": "string",
      "metadata": {
        "description": "Name of Service Bus namespace"
      }
    },
    "postMigrationName": {
      "type": "string",
      "metadata": {
        "description": "Name to access Standard Namespace after migration"
      }
    }
  },
  "variables": {
    "defaultSASKeyName": "RootManageSharedAccessKey",
    "defaultAuthRuleResourceId": "[resourceId('Microsoft.ServiceBus/namespaces/authorizationRules', parameters('serviceBusNamespaceNameStandrad'), variables('defaultSASKeyName'))]",
	"premiumNamespaceResourceId": "[resourceId('Microsoft.ServiceBus/namespaces', parameters('serviceBusNamespaceNamePremium'))]",
	"StandardNamespaceResourceId": "[resourceId('Microsoft.ServiceBus/namespaces', parameters('serviceBusNamespaceNameStandrad'))]"
  },
  "resources": [
	  {
		  "apiVersion": "2017-04-01",
		  "name": "[parameters('serviceBusNamespaceNamePremium')]",
		  "type": "Microsoft.ServiceBus/Namespaces",
		  "location": "[resourceGroup().location]",
		  "sku": {
			"name": "Premium",
			"tier": "Premium",
			"capacity": 4
		  },
		  "tags": {
			"tag1": "value1",
			"tag2": "value2"
		  }
		},
	  {
	  "condition": false,
      "apiVersion": "2017-04-01",
      "type": "Microsoft.ServiceBus/Namespaces",
      "dependsOn": [ "[concat('Microsoft.ServiceBus/namespaces/', parameters('serviceBusNamespaceNamePremium'))]" ],
      "name": "[parameters('serviceBusNamespaceNameStandrad')]",
      "location": "[resourceGroup().location]",
      "sku": {
        "name": "Standard",
        "tier": "Standard"
      },
      "tags": {
        "tag1": "value1",
        "tag2": "value2"
      },
		  "resources": [
			{
			  "apiVersion": "2017-04-01",
			  "name": "$default",
			  "type": "migrationconfigurations",
			  "dependsOn": [ "[concat('Microsoft.ServiceBus/namespaces/', parameters('serviceBusNamespaceNameStandrad'))]" ],
			  "properties": {
				"postMigrationName":"[parameters('postMigrationName')]",
				"targetNamespace": "[resourceId('Microsoft.ServiceBus/Namespaces', parameters('serviceBusNamespaceNamePremium'))]"
			  }
			}
		  ]
	  }	         
      ],
  "outputs": {
    "NamespaceDefaultConnectionString": {
      "type": "string",
      "value": "[listkeys(variables('defaultAuthRuleResourceId'), '2017-04-01').primaryConnectionString]"
    },
    "DefaultSharedAccessPolicyPrimaryKey": {
      "type": "string",
      "value": "[listkeys(variables('defaultAuthRuleResourceId'), '2017-04-01').primaryKey]"
    }
  }
}
