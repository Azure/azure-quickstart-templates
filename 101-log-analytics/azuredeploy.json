{
	"$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": {
				"description": "Name of the Azure Log Analytics workspace."
			}
		},
		"sku": {
			"type": "string",
			"defaultValue": "free",
			"allowedValues": [
				"free",
				"standard",
				"premium"
			],
			"metadata": {
				"description": "SKU for the Azure Log Analytics workspace."
			}
		},
		"workspaceLocation": {
			"type": "string",
			"defaultValue": "eastus",
			"allowedValues": [
				"eastus",
				"westcentralus",
				"westeurope",
				"southeastasia",
				"australiasoutheast"
			],
			"metadata": {
				"description": "SKU for the Azure Log Analytics workspace."
			}
		}
	},
	"variables": {
		"apiVersions": {
			"workspaces": "2017-03-03-preview",
			"datasources": "2015-11-01-preview"
		}
	},
	"resources": [{
		"type": "Microsoft.OperationalInsights/workspaces",
		"name": "[parameters('workspaceName')]",
		"apiVersion": "[variables('apiVersions').workspaces]",
		"location": "[parameters('workspaceLocation')]",
		"properties": {
			"sku": {
				"name": "[parameters('sku')]"
			}
  		}
	},
	{
		"type": "Microsoft.OperationalInsights/workspaces/datasources",
		"name": "[concat(parameters('workspaceName'),'/DataSource_WindowsPerformanceCounter_00001')]",
		"apiVersion": "[variables('apiVersions').datasources]",
		"location": "[parameters('workspaceLocation')]",
		"kind": "WindowsPerformanceCounter",
		"properties": {
			"objectName": "Processor Information",
    		"instanceName": "*",
    		"intervalSeconds": 10,
    		"counterName": "% Idle Time",
    		"collectorType": "Default"
  		},
		"dependsOn": [
        	"[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
      	]
	},
	{
		"type": "Microsoft.OperationalInsights/workspaces/datasources",
		"name": "[concat(parameters('workspaceName'),'/DataSource_WindowsEvent_00001')]",
		"apiVersion": "[variables('apiVersions').datasources]",
		"location": "[parameters('workspaceLocation')]",
		"kind": "WindowsEvent",
		"properties": {
			"eventLogName":"Application",
			"eventTypes":[{
				"eventType":"Error"
			},{
				"eventType":"Warning"
			},{
				"eventType":"Information"
			}]
  		},
		"dependsOn": [
        	"[concat('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]"
      	]
	}],
	"outputs": {
    	"customerId": {
        	"value": "[reference(resourceId('Microsoft.OperationalInsights/workspaces',parameters('workspaceName')), variables('apiVersions').workspaces).customerId]",
        	"type": "string"
    	},
    	"portalUrl": {
        	"value": "[reference(resourceId('Microsoft.OperationalInsights/workspaces',parameters('workspaceName')), variables('apiVersions').workspaces).portalUrl]",
        	"type": "string"
    	}
	}
}