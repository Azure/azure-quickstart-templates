{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspaceName": {
            "type": "string",
            "metadata": {
                "description": "Specifies the name of the Azure Machine Learning workspace where job will be created"
            }
        },
        "computeName": {
            "type": "string",
            "metadata": {
                "description": "Specifies the name of the Azure Machine Learning compute instance/cluster on which job will be run"
            }
        },
        "experimentName": {
            "type": "string",
            "metadata": {
                "description": "Specifies the name of the Azure Machine Learning experiment under which job will be created"
            }
        },
        "jobName": {
            "type": "string",
            "metadata": {
                "description": "Specifies the name of the Azure Machine Learning job to be created"
            }
        },
        "limitSettings": {
            "type": "object",
            "defaultValue": {
                "maxTrials": 5,
                "maxConcurrentTrials": 1,
                "maxCoresPerTrial": -1,
                "enableEarlyTermination": true,
                "timeout": "PT10H",
                "trialTimeout": "PT20M"
            },
            "metadata": {
                "description": "Specifies job execution contraints"
            }
        },
        "trainingSettings": {
            "type": "object",
            "defaultValue": {
                "blockedTrainingAlgorithms": ["LogisticRegression"],
                "enableModelExplainability": true,
                "enableOnnxCompatibleModels": false,
                "enableStackEnsemble": true,
                "enableVoteEnsemble": true,
                "ensembleModelDownloadTimeout": "PT5M",
                "enableDnnTraining": false
            },
            "metadata": {
                "description": "Specifies training related configuration"
            }
        }
    },
    "variables": {
        "compute": "[resourceId('Microsoft.MachineLearningServices/workspaces/computes', parameters('workspaceName'), parameters('computeName'))]"
    },
    "resources": [
        {
            "type": "Microsoft.MachineLearningServices/workspaces/jobs",
            "name": "[concat(parameters('workspaceName'), '/', parameters('jobName'))]",
            "apiVersion": "2022-06-01-preview",
            "properties": {
                "jobType": "AutoML",
                "tags": {
                    "ref": "https://github.com/Azure/azureml-examples/blob/main/sdk/jobs/automl-standalone-jobs/automl-classification-task-bankmarketing"
                },
                "experimentName": "[parameters('experimentName')]",
                "computeId": "[variables('compute')]",
                "taskDetails": {
                    "logVerbosity": "Info",
                    "taskType": "Classification",
                    "primaryMetric": "Accuracy",
                    "targetColumnName": "y",
                    "trainingData": {
                        "uri": "https://raw.githubusercontent.com/Azure/azureml-examples/main/sdk/jobs/automl-standalone-jobs/automl-classification-task-bankmarketing/data/training-mltable-folder/",
                        "jobInputType": "MLTable"
                    },
                    "nCrossValidations": {
                        "mode": "custom",
                        "value": 5
                    },
                    "featurizationSettings": {
                        "mode": "auto"
                    },
                    "limitSettings": "[parameters('limitSettings')]",
                    "trainingSettings": "[parameters('trainingSettings')]"
                }
            }
        }
    ],
    "outputs": {
        "Studio Endpoint URL": {
            "type": "string",
            "value": "[reference(resourceId('Microsoft.MachineLearningServices/workspaces/jobs', parameters('workspaceName'), parameters('jobName'))).services.Studio.endpoint]"
        }
    }
}
