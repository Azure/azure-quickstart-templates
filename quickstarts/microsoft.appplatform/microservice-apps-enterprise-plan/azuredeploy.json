{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.21.1.54444",
      "templateHash": "1247956791666183539"
    }
  },
  "parameters": {
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Location for all resources."
      }
    },
    "_artifactsLocation": {
      "type": "string",
      "defaultValue": "[deployment().properties.templateLink.uri]",
      "metadata": {
        "description": "Specifies the base URI where artifacts required by this template are located including a trailing '/'. When the template is deployed using the accompanying scripts, a private location in the subscription will be used and this value will be automatically generated."
      }
    },
    "_artifactsLocationSasToken": {
      "type": "securestring",
      "defaultValue": "",
      "metadata": {
        "description": "The sasToken required to access _artifactsLocation. When the template is deployed using the accompanying scripts, a sasToken will be automatically generated."
      }
    }
  },
  "variables": {
    "_fxv_0": {
      "analysisServicesServers": "as",
      "apiManagementService": "apim-",
      "appConfigurationConfigurationStores": "appcs-",
      "appManagedEnvironments": "cae-",
      "appContainerApps": "ca-",
      "authorizationPolicyDefinitions": "policy-",
      "automationAutomationAccounts": "aa-",
      "blueprintBlueprints": "bp-",
      "blueprintBlueprintsArtifacts": "bpa-",
      "cacheRedis": "redis-",
      "cdnProfiles": "cdnp-",
      "cdnProfilesEndpoints": "cdne-",
      "cognitiveServicesAccounts": "cog-",
      "cognitiveServicesFormRecognizer": "cog-fr-",
      "cognitiveServicesTextAnalytics": "cog-ta-",
      "computeAvailabilitySets": "avail-",
      "computeCloudServices": "cld-",
      "computeDiskEncryptionSets": "des",
      "computeDisks": "disk",
      "computeDisksOs": "osdisk",
      "computeGalleries": "gal",
      "computeSnapshots": "snap-",
      "computeVirtualMachines": "vm",
      "computeVirtualMachineScaleSets": "vmss-",
      "containerInstanceContainerGroups": "ci",
      "containerRegistryRegistries": "cr",
      "containerServiceManagedClusters": "aks-",
      "databricksWorkspaces": "dbw-",
      "dataFactoryFactories": "adf-",
      "dataLakeAnalyticsAccounts": "dla",
      "dataLakeStoreAccounts": "dls",
      "dataMigrationServices": "dms-",
      "dBforMySQLServers": "mysql-",
      "dBforPostgreSQLServers": "psql-",
      "devicesIotHubs": "iot-",
      "devicesProvisioningServices": "provs-",
      "devicesProvisioningServicesCertificates": "pcert-",
      "documentDBDatabaseAccounts": "cosmos-",
      "eventGridDomains": "evgd-",
      "eventGridDomainsTopics": "evgt-",
      "eventGridEventSubscriptions": "evgs-",
      "eventHubNamespaces": "evhns-",
      "eventHubNamespacesEventHubs": "evh-",
      "hdInsightClustersHadoop": "hadoop-",
      "hdInsightClustersHbase": "hbase-",
      "hdInsightClustersKafka": "kafka-",
      "hdInsightClustersMl": "mls-",
      "hdInsightClustersSpark": "spark-",
      "hdInsightClustersStorm": "storm-",
      "hybridComputeMachines": "arcs-",
      "insightsActionGroups": "ag-",
      "insightsComponents": "appi-",
      "keyVaultVaults": "kv-",
      "kubernetesConnectedClusters": "arck",
      "kustoClusters": "dec",
      "kustoClustersDatabases": "dedb",
      "logicIntegrationAccounts": "ia-",
      "logicWorkflows": "logic-",
      "machineLearningServicesWorkspaces": "mlw-",
      "managedIdentityUserAssignedIdentities": "id-",
      "managementManagementGroups": "mg-",
      "migrateAssessmentProjects": "migr-",
      "networkApplicationGateways": "agw-",
      "networkApplicationSecurityGroups": "asg-",
      "networkAzureFirewalls": "afw-",
      "networkBastionHosts": "bas-",
      "networkConnections": "con-",
      "networkDnsZones": "dnsz-",
      "networkExpressRouteCircuits": "erc-",
      "networkFirewallPolicies": "afwp-",
      "networkFirewallPoliciesWebApplication": "waf",
      "networkFirewallPoliciesRuleGroups": "wafrg",
      "networkFrontDoors": "fd-",
      "networkFrontdoorWebApplicationFirewallPolicies": "fdfp-",
      "networkLoadBalancersExternal": "lbe-",
      "networkLoadBalancersInternal": "lbi-",
      "networkLoadBalancersInboundNatRules": "rule-",
      "networkLocalNetworkGateways": "lgw-",
      "networkNatGateways": "ng-",
      "networkNetworkInterfaces": "nic-",
      "networkNetworkSecurityGroups": "nsg-",
      "networkNetworkSecurityGroupsSecurityRules": "nsgsr-",
      "networkNetworkWatchers": "nw-",
      "networkPrivateDnsZones": "pdnsz-",
      "networkPrivateLinkServices": "pl-",
      "networkPublicIPAddresses": "pip-",
      "networkPublicIPPrefixes": "ippre-",
      "networkRouteFilters": "rf-",
      "networkRouteTables": "rt-",
      "networkRouteTablesRoutes": "udr-",
      "networkTrafficManagerProfiles": "traf-",
      "networkVirtualNetworkGateways": "vgw-",
      "networkVirtualNetworks": "vnet-",
      "networkVirtualNetworksSubnets": "snet-",
      "networkVirtualNetworksVirtualNetworkPeerings": "peer-",
      "networkVirtualWans": "vwan-",
      "networkVpnGateways": "vpng-",
      "networkVpnGatewaysVpnConnections": "vcn-",
      "networkVpnGatewaysVpnSites": "vst-",
      "notificationHubsNamespaces": "ntfns-",
      "notificationHubsNamespacesNotificationHubs": "ntf-",
      "operationalInsightsWorkspaces": "log-",
      "portalDashboards": "dash-",
      "powerBIDedicatedCapacities": "pbi-",
      "purviewAccounts": "pview-",
      "postgresServer": "pg-",
      "recoveryServicesVaults": "rsv-",
      "resourcesResourceGroups": "rg-",
      "searchSearchServices": "srch-",
      "serviceBusNamespaces": "sb-",
      "serviceBusNamespacesQueues": "sbq-",
      "serviceBusNamespacesTopics": "sbt-",
      "serviceEndPointPolicies": "se-",
      "serviceFabricClusters": "sf-",
      "signalRServiceSignalR": "sigr",
      "springApps": "asa-",
      "sqlManagedInstances": "sqlmi-",
      "sqlServers": "sql-",
      "sqlServersDataWarehouse": "sqldw-",
      "sqlServersDatabases": "sqldb-",
      "sqlServersDatabasesStretch": "sqlstrdb-",
      "storageStorageAccounts": "st",
      "storageStorageAccountsVm": "stvm",
      "storSimpleManagers": "ssimp",
      "streamAnalyticsCluster": "asa-",
      "synapseWorkspaces": "syn",
      "synapseWorkspacesAnalyticsWorkspaces": "synw",
      "synapseWorkspacesSqlPoolsDedicated": "syndp",
      "synapseWorkspacesSqlPoolsSpark": "synsp",
      "timeSeriesInsightsEnvironments": "tsi-",
      "webServerFarms": "plan-",
      "webSitesAppService": "app-",
      "webSitesAppServiceEnvironment": "ase-",
      "webSitesFunctions": "func-",
      "webStaticSites": "stapp-"
    },
    "abbrs": "[variables('_fxv_0')]",
    "resourceToken": "[toLower(uniqueString(subscription().id, resourceGroup().name, parameters('location')))]",
    "asaInstanceName": "[format('{0}{1}', variables('abbrs').springApps, variables('resourceToken'))]",
    "adminServerAppName": "admin-server",
    "customersServiceAppName": "customers-service",
    "vetsServiceAppName": "vets-service",
    "visitsServiceAppName": "visits-service",
    "apiGatewayAppName": "api-gateway",
    "logAnalyticsName": "[format('{0}{1}', variables('abbrs').operationalInsightsWorkspaces, variables('resourceToken'))]",
    "applicationInsightsName": "[format('{0}{1}', variables('abbrs').insightsComponents, variables('resourceToken'))]",
    "applicationInsightsDashboardName": "[format('{0}{1}', variables('abbrs').portalDashboards, variables('resourceToken'))]",
    "userAssignedManagedIdentityName": "[format('{0}{1}', variables('abbrs').managedIdentityUserAssignedIdentities, variables('resourceToken'))]",
    "const_ownerRole": "[format('/subscriptions/{0}/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635', subscription().subscriptionId)]",
    "const_uploadScriptName": "deploy-jar-to-asa.sh",
    "const_checkScriptName": "check-provision-state.ps1",
    "const_checkingBuilderStateDeploymentName": "checking-build-service-builder-state",
    "ref_identityId": "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('userAssignedManagedIdentityName'))]",
    "name_deploymentScriptName": "asa-enterprise-deployment-script",
    "name_roleAssignmentName": "[guid(format('{0}{1}Role assignment in group{2}', resourceGroup().name, variables('ref_identityId'), resourceGroup().name))]",
    "tags": {
      "spring-cloud-azure": "true",
      "deploy-to-azure-button": "true"
    }
  },
  "resources": [
    {
      "type": "Microsoft.AppPlatform/Spring",
      "apiVersion": "2023-05-01-preview",
      "name": "[variables('asaInstanceName')]",
      "location": "[parameters('location')]",
      "tags": "[variables('tags')]",
      "sku": {
        "name": "E0",
        "tier": "Enterprise"
      }
    },
    {
      "type": "Microsoft.AppPlatform/Spring/buildServices",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "properties": {
        "resourceRequests": {
          "cpu": "1000m",
          "memory": "2000Mi"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), variables('adminServerAppName'))]",
      "location": "[parameters('location')]",
      "properties": {
        "public": true,
        "httpsOnly": false,
        "temporaryDisk": {
          "sizeInGB": 5,
          "mountPath": "/tmp"
        },
        "persistentDisk": {
          "sizeInGB": 0,
          "mountPath": "/persistent"
        },
        "enableEndToEndTLS": false,
        "ingressSettings": {
          "readTimeoutInSeconds": 300,
          "sendTimeoutInSeconds": 60,
          "sessionCookieMaxAge": 0,
          "sessionAffinity": "None",
          "backendProtocol": "Default"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), variables('customersServiceAppName'))]",
      "location": "[parameters('location')]",
      "properties": {
        "httpsOnly": false,
        "temporaryDisk": {
          "sizeInGB": 5,
          "mountPath": "/tmp"
        },
        "persistentDisk": {
          "sizeInGB": 0,
          "mountPath": "/persistent"
        },
        "enableEndToEndTLS": false,
        "ingressSettings": {
          "readTimeoutInSeconds": 300,
          "sendTimeoutInSeconds": 60,
          "sessionCookieMaxAge": 0,
          "sessionAffinity": "None",
          "backendProtocol": "Default"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), variables('vetsServiceAppName'))]",
      "location": "[parameters('location')]",
      "properties": {
        "httpsOnly": false,
        "temporaryDisk": {
          "sizeInGB": 5,
          "mountPath": "/tmp"
        },
        "persistentDisk": {
          "sizeInGB": 0,
          "mountPath": "/persistent"
        },
        "enableEndToEndTLS": false,
        "ingressSettings": {
          "readTimeoutInSeconds": 300,
          "sendTimeoutInSeconds": 60,
          "sessionCookieMaxAge": 0,
          "sessionAffinity": "None",
          "backendProtocol": "Default"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), variables('visitsServiceAppName'))]",
      "location": "[parameters('location')]",
      "properties": {
        "httpsOnly": false,
        "temporaryDisk": {
          "sizeInGB": 5,
          "mountPath": "/tmp"
        },
        "persistentDisk": {
          "sizeInGB": 0,
          "mountPath": "/persistent"
        },
        "enableEndToEndTLS": false,
        "ingressSettings": {
          "readTimeoutInSeconds": 300,
          "sendTimeoutInSeconds": 60,
          "sessionCookieMaxAge": 0,
          "sessionAffinity": "None",
          "backendProtocol": "Default"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), variables('apiGatewayAppName'))]",
      "location": "[parameters('location')]",
      "properties": {
        "public": true,
        "httpsOnly": false,
        "temporaryDisk": {
          "sizeInGB": 5,
          "mountPath": "/tmp"
        },
        "persistentDisk": {
          "sizeInGB": 0,
          "mountPath": "/persistent"
        },
        "enableEndToEndTLS": false,
        "ingressSettings": {
          "readTimeoutInSeconds": 300,
          "sendTimeoutInSeconds": 60,
          "sessionCookieMaxAge": 0,
          "sessionAffinity": "None",
          "backendProtocol": "Default"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps/deployments",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}/{2}', variables('asaInstanceName'), variables('adminServerAppName'), 'default')]",
      "properties": {
        "active": true,
        "deploymentSettings": {
          "resourceRequests": {
            "cpu": "1",
            "memory": "2Gi"
          }
        },
        "source": {
          "type": "BuildResult",
          "buildResultId": "<default>"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('adminServerAppName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps/deployments",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}/{2}', variables('asaInstanceName'), variables('customersServiceAppName'), 'default')]",
      "properties": {
        "active": true,
        "deploymentSettings": {
          "resourceRequests": {
            "cpu": "1",
            "memory": "2Gi"
          }
        },
        "source": {
          "type": "BuildResult",
          "buildResultId": "<default>"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('customersServiceAppName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps/deployments",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}/{2}', variables('asaInstanceName'), variables('vetsServiceAppName'), 'default')]",
      "properties": {
        "active": true,
        "deploymentSettings": {
          "resourceRequests": {
            "cpu": "1",
            "memory": "2Gi"
          }
        },
        "source": {
          "type": "BuildResult",
          "buildResultId": "<default>"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('vetsServiceAppName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps/deployments",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}/{2}', variables('asaInstanceName'), variables('visitsServiceAppName'), 'default')]",
      "properties": {
        "active": true,
        "deploymentSettings": {
          "resourceRequests": {
            "cpu": "1",
            "memory": "2Gi"
          }
        },
        "source": {
          "type": "BuildResult",
          "buildResultId": "<default>"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('visitsServiceAppName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apps/deployments",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}/{2}', variables('asaInstanceName'), variables('apiGatewayAppName'), 'default')]",
      "properties": {
        "active": true,
        "deploymentSettings": {
          "resourceRequests": {
            "cpu": "1",
            "memory": "2Gi"
          }
        },
        "source": {
          "type": "BuildResult",
          "buildResultId": "<default>"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('apiGatewayAppName'))]"
      ]
    },
    {
      "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
      "apiVersion": "2023-01-31",
      "name": "[variables('userAssignedManagedIdentityName')]",
      "location": "[parameters('location')]",
      "tags": "[variables('tags')]"
    },
    {
      "type": "Microsoft.Authorization/roleAssignments",
      "apiVersion": "2022-04-01",
      "name": "[variables('name_roleAssignmentName')]",
      "properties": {
        "roleDefinitionId": "[variables('const_ownerRole')]",
        "principalId": "[reference(variables('ref_identityId')).principalId]",
        "principalType": "ServicePrincipal",
        "scope": "[resourceGroup().id]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]",
        "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('userAssignedManagedIdentityName'))]"
      ]
    },
    {
      "type": "Microsoft.Resources/deploymentScripts",
      "apiVersion": "2020-10-01",
      "name": "[variables('const_checkingBuilderStateDeploymentName')]",
      "location": "[parameters('location')]",
      "kind": "AzurePowerShell",
      "identity": {
        "type": "UserAssigned",
        "userAssignedIdentities": {
          "[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('userAssignedManagedIdentityName')))]": {}
        }
      },
      "properties": {
        "azPowerShellVersion": "9.7",
        "primaryScriptUri": "[uri(parameters('_artifactsLocation'), format('scripts/{0}{1}', variables('const_checkScriptName'), parameters('_artifactsLocationSasToken')))]",
        "environmentVariables": [
          {
            "name": "SUBSCRIPTION_ID",
            "value": "[subscription().subscriptionId]"
          },
          {
            "name": "RESOURCE_GROUP",
            "value": "[resourceGroup().name]"
          },
          {
            "name": "ASA_SERVICE_NAME",
            "value": "[variables('asaInstanceName')]"
          }
        ],
        "cleanupPreference": "OnSuccess",
        "retentionInterval": "P1D"
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/apps/deployments', variables('asaInstanceName'), variables('adminServerAppName'), 'default')]",
        "[resourceId('Microsoft.AppPlatform/Spring/apps/deployments', variables('asaInstanceName'), variables('apiGatewayAppName'), 'default')]",
        "[resourceId('Microsoft.AppPlatform/Spring/apps/deployments', variables('asaInstanceName'), variables('customersServiceAppName'), 'default')]",
        "[resourceId('Microsoft.AppPlatform/Spring/apps/deployments', variables('asaInstanceName'), variables('vetsServiceAppName'), 'default')]",
        "[resourceId('Microsoft.AppPlatform/Spring/apps/deployments', variables('asaInstanceName'), variables('visitsServiceAppName'), 'default')]",
        "[resourceId('Microsoft.Authorization/roleAssignments', variables('name_roleAssignmentName'))]",
        "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('userAssignedManagedIdentityName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/buildServices/builders/buildpackBindings",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/default/default/default', variables('asaInstanceName'))]",
      "properties": {
        "bindingType": "ApplicationInsights",
        "launchProperties": {
          "properties": {
            "sampling_percentage": "10",
            "connection_string": "[reference(resourceId('Microsoft.Insights/components', variables('applicationInsightsName')), '2020-02-02').ConnectionString]"
          }
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.Insights/components', variables('applicationInsightsName'))]",
        "[resourceId('Microsoft.Resources/deploymentScripts', variables('const_checkingBuilderStateDeploymentName'))]"
      ]
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces",
      "apiVersion": "2022-10-01",
      "name": "[variables('logAnalyticsName')]",
      "location": "[parameters('location')]",
      "tags": "[variables('tags')]",
      "properties": {
        "retentionInDays": 30,
        "sku": {
          "name": "PerGB2018"
        }
      }
    },
    {
      "type": "Microsoft.Insights/components",
      "apiVersion": "2020-02-02",
      "name": "[variables('applicationInsightsName')]",
      "location": "[parameters('location')]",
      "tags": "[variables('tags')]",
      "kind": "java",
      "properties": {
        "Application_Type": "web",
        "Flow_Type": "Bluefield",
        "Request_Source": "CustomDeployment",
        "RetentionInDays": 90,
        "WorkspaceResourceId": "[resourceId('Microsoft.OperationalInsights/workspaces', variables('logAnalyticsName'))]",
        "IngestionMode": "Disabled",
        "publicNetworkAccessForIngestion": "Enabled",
        "publicNetworkAccessForQuery": "Enabled"
      },
      "dependsOn": [
        "[resourceId('Microsoft.OperationalInsights/workspaces', variables('logAnalyticsName'))]"
      ]
    },
    {
      "type": "Microsoft.Portal/dashboards",
      "apiVersion": "2020-09-01-preview",
      "name": "[variables('applicationInsightsDashboardName')]",
      "location": "[parameters('location')]",
      "tags": "[variables('tags')]",
      "properties": {
        "lenses": [
          {
            "order": 0,
            "parts": [
              {
                "position": {
                  "x": 0,
                  "y": 0,
                  "colSpan": 2,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "id",
                      "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                    },
                    {
                      "name": "Version",
                      "value": "1.0"
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/AspNetOverviewPinnedPart",
                  "asset": {
                    "idInputName": "id",
                    "type": "ApplicationInsights"
                  },
                  "defaultMenuItemId": "overview"
                }
              },
              {
                "position": {
                  "x": 2,
                  "y": 0,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "Version",
                      "value": "1.0"
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/ProactiveDetectionAsyncPart",
                  "asset": {
                    "idInputName": "ComponentId",
                    "type": "ApplicationInsights"
                  },
                  "defaultMenuItemId": "ProactiveDetection"
                }
              },
              {
                "position": {
                  "x": 3,
                  "y": 0,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "ResourceId",
                      "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/QuickPulseButtonSmallPart",
                  "asset": {
                    "idInputName": "ComponentId",
                    "type": "ApplicationInsights"
                  }
                }
              },
              {
                "position": {
                  "x": 4,
                  "y": 0,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "TimeContext",
                      "value": {
                        "durationMs": 86400000,
                        "createdTime": "2018-05-04T01:20:33.345Z",
                        "isInitialTime": true,
                        "grain": 1,
                        "useDashboardTimeRange": false
                      }
                    },
                    {
                      "name": "Version",
                      "value": "1.0"
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/AvailabilityNavButtonPart",
                  "asset": {
                    "idInputName": "ComponentId",
                    "type": "ApplicationInsights"
                  }
                }
              },
              {
                "position": {
                  "x": 5,
                  "y": 0,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "TimeContext",
                      "value": {
                        "durationMs": 86400000,
                        "createdTime": "2018-05-08T18:47:35.237Z",
                        "isInitialTime": true,
                        "grain": 1,
                        "useDashboardTimeRange": false
                      }
                    },
                    {
                      "name": "ConfigurationId",
                      "value": "78ce933e-e864-4b05-a27b-71fd55a6afad"
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/AppMapButtonPart",
                  "asset": {
                    "idInputName": "ComponentId",
                    "type": "ApplicationInsights"
                  }
                }
              },
              {
                "position": {
                  "x": 0,
                  "y": 1,
                  "colSpan": 3,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [],
                  "type": "Extension/HubsExtension/PartType/MarkdownPart",
                  "settings": {
                    "content": {
                      "settings": {
                        "content": "# Usage"
                      }
                    }
                  }
                }
              },
              {
                "position": {
                  "x": 3,
                  "y": 1,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "TimeContext",
                      "value": {
                        "durationMs": 86400000,
                        "createdTime": "2018-05-04T01:22:35.782Z",
                        "isInitialTime": true,
                        "grain": 1,
                        "useDashboardTimeRange": false
                      }
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/UsageUsersOverviewPart",
                  "asset": {
                    "idInputName": "ComponentId",
                    "type": "ApplicationInsights"
                  }
                }
              },
              {
                "position": {
                  "x": 4,
                  "y": 1,
                  "colSpan": 3,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [],
                  "type": "Extension/HubsExtension/PartType/MarkdownPart",
                  "settings": {
                    "content": {
                      "settings": {
                        "content": "# Reliability"
                      }
                    }
                  }
                }
              },
              {
                "position": {
                  "x": 7,
                  "y": 1,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ResourceId",
                      "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                    },
                    {
                      "name": "DataModel",
                      "value": {
                        "version": "1.0.0",
                        "timeContext": {
                          "durationMs": 86400000,
                          "createdTime": "2018-05-04T23:42:40.072Z",
                          "isInitialTime": false,
                          "grain": 1,
                          "useDashboardTimeRange": false
                        }
                      },
                      "isOptional": true
                    },
                    {
                      "name": "ConfigurationId",
                      "value": "8a02f7bf-ac0f-40e1-afe9-f0e72cfee77f",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/CuratedBladeFailuresPinnedPart",
                  "isAdapter": true,
                  "asset": {
                    "idInputName": "ResourceId",
                    "type": "ApplicationInsights"
                  },
                  "defaultMenuItemId": "failures"
                }
              },
              {
                "position": {
                  "x": 8,
                  "y": 1,
                  "colSpan": 3,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [],
                  "type": "Extension/HubsExtension/PartType/MarkdownPart",
                  "settings": {
                    "content": {
                      "settings": {
                        "content": "# Responsiveness\r\n"
                      }
                    }
                  }
                }
              },
              {
                "position": {
                  "x": 11,
                  "y": 1,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ResourceId",
                      "value": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                    },
                    {
                      "name": "DataModel",
                      "value": {
                        "version": "1.0.0",
                        "timeContext": {
                          "durationMs": 86400000,
                          "createdTime": "2018-05-04T23:43:37.804Z",
                          "isInitialTime": false,
                          "grain": 1,
                          "useDashboardTimeRange": false
                        }
                      },
                      "isOptional": true
                    },
                    {
                      "name": "ConfigurationId",
                      "value": "2a8ede4f-2bee-4b9c-aed9-2db0e8a01865",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/CuratedBladePerformancePinnedPart",
                  "isAdapter": true,
                  "asset": {
                    "idInputName": "ResourceId",
                    "type": "ApplicationInsights"
                  },
                  "defaultMenuItemId": "performance"
                }
              },
              {
                "position": {
                  "x": 12,
                  "y": 1,
                  "colSpan": 3,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [],
                  "type": "Extension/HubsExtension/PartType/MarkdownPart",
                  "settings": {
                    "content": {
                      "settings": {
                        "content": "# Browser"
                      }
                    }
                  }
                }
              },
              {
                "position": {
                  "x": 15,
                  "y": 1,
                  "colSpan": 1,
                  "rowSpan": 1
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "ComponentId",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "MetricsExplorerJsonDefinitionId",
                      "value": "BrowserPerformanceTimelineMetrics"
                    },
                    {
                      "name": "TimeContext",
                      "value": {
                        "durationMs": 86400000,
                        "createdTime": "2018-05-08T12:16:27.534Z",
                        "isInitialTime": false,
                        "grain": 1,
                        "useDashboardTimeRange": false
                      }
                    },
                    {
                      "name": "CurrentFilter",
                      "value": {
                        "eventTypes": [
                          4,
                          1,
                          3,
                          5,
                          2,
                          6,
                          13
                        ],
                        "isPermissive": false
                      }
                    },
                    {
                      "name": "id",
                      "value": {
                        "Name": "[variables('applicationInsightsDashboardName')]",
                        "SubscriptionId": "[subscription().subscriptionId]",
                        "ResourceGroup": "[resourceGroup().name]"
                      }
                    },
                    {
                      "name": "Version",
                      "value": "1.0"
                    }
                  ],
                  "type": "Extension/AppInsightsExtension/PartType/MetricsExplorerBladePinnedPart",
                  "asset": {
                    "idInputName": "ComponentId",
                    "type": "ApplicationInsights"
                  },
                  "defaultMenuItemId": "browser"
                }
              },
              {
                "position": {
                  "x": 0,
                  "y": 2,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "sessions/count",
                              "aggregationType": 5,
                              "namespace": "microsoft.insights/components/kusto",
                              "metricVisualization": {
                                "displayName": "Sessions",
                                "color": "#47BDF5"
                              }
                            },
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "users/count",
                              "aggregationType": 5,
                              "namespace": "microsoft.insights/components/kusto",
                              "metricVisualization": {
                                "displayName": "Users",
                                "color": "#7E58FF"
                              }
                            }
                          ],
                          "title": "Unique sessions and users",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          },
                          "openBladeOnClick": {
                            "openBlade": true,
                            "destinationBlade": {
                              "extensionName": "HubsExtension",
                              "bladeName": "ResourceMenuBlade",
                              "parameters": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]",
                                "menuid": "segmentationUsers"
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 4,
                  "y": 2,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "requests/failed",
                              "aggregationType": 7,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Failed requests",
                                "color": "#EC008C"
                              }
                            }
                          ],
                          "title": "Failed requests",
                          "visualization": {
                            "chartType": 3,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          },
                          "openBladeOnClick": {
                            "openBlade": true,
                            "destinationBlade": {
                              "extensionName": "HubsExtension",
                              "bladeName": "ResourceMenuBlade",
                              "parameters": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]",
                                "menuid": "failures"
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 8,
                  "y": 2,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "requests/duration",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Server response time",
                                "color": "#00BCF2"
                              }
                            }
                          ],
                          "title": "Server response time",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          },
                          "openBladeOnClick": {
                            "openBlade": true,
                            "destinationBlade": {
                              "extensionName": "HubsExtension",
                              "bladeName": "ResourceMenuBlade",
                              "parameters": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]",
                                "menuid": "performance"
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 12,
                  "y": 2,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "browserTimings/networkDuration",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Page load network connect time",
                                "color": "#7E58FF"
                              }
                            },
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "browserTimings/processingDuration",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Client processing time",
                                "color": "#44F1C8"
                              }
                            },
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "browserTimings/sendDuration",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Send request time",
                                "color": "#EB9371"
                              }
                            },
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "browserTimings/receiveDuration",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Receiving response time",
                                "color": "#0672F1"
                              }
                            }
                          ],
                          "title": "Average page load time breakdown",
                          "visualization": {
                            "chartType": 3,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 0,
                  "y": 5,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "availabilityResults/availabilityPercentage",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Availability",
                                "color": "#47BDF5"
                              }
                            }
                          ],
                          "title": "Average availability",
                          "visualization": {
                            "chartType": 3,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          },
                          "openBladeOnClick": {
                            "openBlade": true,
                            "destinationBlade": {
                              "extensionName": "HubsExtension",
                              "bladeName": "ResourceMenuBlade",
                              "parameters": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]",
                                "menuid": "availability"
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 4,
                  "y": 5,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "exceptions/server",
                              "aggregationType": 7,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Server exceptions",
                                "color": "#47BDF5"
                              }
                            },
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "dependencies/failed",
                              "aggregationType": 7,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Dependency failures",
                                "color": "#7E58FF"
                              }
                            }
                          ],
                          "title": "Server exceptions and Dependency failures",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 8,
                  "y": 5,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "performanceCounters/processorCpuPercentage",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Processor time",
                                "color": "#47BDF5"
                              }
                            },
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "performanceCounters/processCpuPercentage",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Process CPU",
                                "color": "#7E58FF"
                              }
                            }
                          ],
                          "title": "Average processor and process CPU utilization",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 12,
                  "y": 5,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "exceptions/browser",
                              "aggregationType": 7,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Browser exceptions",
                                "color": "#47BDF5"
                              }
                            }
                          ],
                          "title": "Browser exceptions",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 0,
                  "y": 8,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "availabilityResults/count",
                              "aggregationType": 7,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Availability test results count",
                                "color": "#47BDF5"
                              }
                            }
                          ],
                          "title": "Availability test results count",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 4,
                  "y": 8,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "performanceCounters/processIOBytesPerSecond",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Process IO rate",
                                "color": "#47BDF5"
                              }
                            }
                          ],
                          "title": "Average process I/O rate",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              },
              {
                "position": {
                  "x": 8,
                  "y": 8,
                  "colSpan": 4,
                  "rowSpan": 3
                },
                "metadata": {
                  "inputs": [
                    {
                      "name": "options",
                      "value": {
                        "chart": {
                          "metrics": [
                            {
                              "resourceMetadata": {
                                "id": "[format('/subscriptions/{0}/resourceGroups/{1}/providers/Microsoft.Insights/components/{2}', subscription().subscriptionId, resourceGroup().name, variables('applicationInsightsDashboardName'))]"
                              },
                              "name": "performanceCounters/memoryAvailableBytes",
                              "aggregationType": 4,
                              "namespace": "microsoft.insights/components",
                              "metricVisualization": {
                                "displayName": "Available memory",
                                "color": "#47BDF5"
                              }
                            }
                          ],
                          "title": "Average available memory",
                          "visualization": {
                            "chartType": 2,
                            "legendVisualization": {
                              "isVisible": true,
                              "position": 2,
                              "hideSubtitle": false
                            },
                            "axisVisualization": {
                              "x": {
                                "isVisible": true,
                                "axisType": 2
                              },
                              "y": {
                                "isVisible": true,
                                "axisType": 1
                              }
                            }
                          }
                        }
                      }
                    },
                    {
                      "name": "sharedTimeRange",
                      "isOptional": true
                    }
                  ],
                  "type": "Extension/HubsExtension/PartType/MonitorChartPart",
                  "settings": {}
                }
              }
            ]
          }
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.Insights/components', variables('applicationInsightsName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/monitoringSettings",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "properties": {
        "traceEnabled": true,
        "appInsightsInstrumentationKey": "[reference(resourceId('Microsoft.Insights/components', variables('applicationInsightsName')), '2020-02-02').InstrumentationKey]"
      },
      "dependsOn": [
        "[resourceId('Microsoft.Insights/components', variables('applicationInsightsName'))]",
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.Insights/diagnosticSettings",
      "apiVersion": "2021-05-01-preview",
      "scope": "[format('Microsoft.AppPlatform/Spring/{0}', variables('asaInstanceName'))]",
      "name": "monitoring",
      "properties": {
        "workspaceId": "[resourceId('Microsoft.OperationalInsights/workspaces', variables('logAnalyticsName'))]",
        "logs": [
          {
            "category": "ApplicationConsole",
            "enabled": true,
            "retentionPolicy": {
              "days": 30,
              "enabled": false
            }
          }
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]",
        "[resourceId('Microsoft.OperationalInsights/workspaces', variables('logAnalyticsName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/applicationAccelerators",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/applicationLiveViews",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/configurationServices",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "properties": {
        "settings": {
          "gitProperty": {
            "repositories": [
              {
                "name": "default",
                "patterns": [
                  "application",
                  "api-gateway",
                  "admin-server",
                  "customers-service",
                  "vets-service",
                  "visits-service"
                ],
                "label": "master",
                "uri": "https://github.com/Azure-Samples/spring-petclinic-microservices-config.git"
              }
            ]
          }
        },
        "generation": "Gen1"
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/DevToolPortals",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "properties": {
        "public": false,
        "features": {
          "applicationAccelerator": {
            "state": "Enabled"
          },
          "applicationLiveView": {
            "state": "Enabled"
          }
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/gateways",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "sku": {
        "name": "E0",
        "tier": "Enterprise",
        "capacity": 2
      },
      "properties": {
        "public": false,
        "httpsOnly": false,
        "resourceRequests": {
          "cpu": "1",
          "memory": "2Gi"
        },
        "clientAuth": {
          "certificateVerification": "Disabled"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/serviceRegistries",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/apiPortals",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}', variables('asaInstanceName'), 'default')]",
      "sku": {
        "name": "E0",
        "tier": "Enterprise",
        "capacity": 1
      },
      "properties": {
        "public": false,
        "httpsOnly": false,
        "gatewayIds": [
          "[resourceId('Microsoft.AppPlatform/Spring/gateways', variables('asaInstanceName'), 'default')]"
        ]
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring', variables('asaInstanceName'))]",
        "[resourceId('Microsoft.AppPlatform/Spring/gateways', variables('asaInstanceName'), 'default')]"
      ]
    },
    {
      "type": "Microsoft.AppPlatform/Spring/buildServices/agentPools",
      "apiVersion": "2023-05-01-preview",
      "name": "[format('{0}/{1}/{2}', variables('asaInstanceName'), 'default', 'default')]",
      "properties": {
        "poolSize": {
          "name": "S1"
        }
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/buildServices', variables('asaInstanceName'), 'default')]"
      ]
    },
    {
      "type": "Microsoft.Resources/deploymentScripts",
      "apiVersion": "2020-10-01",
      "name": "[variables('name_deploymentScriptName')]",
      "location": "[parameters('location')]",
      "kind": "AzureCLI",
      "identity": {
        "type": "UserAssigned",
        "userAssignedIdentities": {
          "[format('{0}', resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('userAssignedManagedIdentityName')))]": {}
        }
      },
      "properties": {
        "azCliVersion": "2.41.0",
        "primaryScriptUri": "[uri(parameters('_artifactsLocation'), format('scripts/{0}{1}', variables('const_uploadScriptName'), parameters('_artifactsLocationSasToken')))]",
        "environmentVariables": [
          {
            "name": "SUBSCRIPTION_ID",
            "value": "[subscription().subscriptionId]"
          },
          {
            "name": "RESOURCE_GROUP",
            "value": "[resourceGroup().name]"
          },
          {
            "name": "ASA_SERVICE_NAME",
            "value": "[variables('asaInstanceName')]"
          }
        ],
        "cleanupPreference": "OnSuccess",
        "retentionInterval": "P1D"
      },
      "dependsOn": [
        "[resourceId('Microsoft.AppPlatform/Spring/buildServices/builders/buildpackBindings', split(format('{0}/default/default/default', variables('asaInstanceName')), '/')[0], split(format('{0}/default/default/default', variables('asaInstanceName')), '/')[1], split(format('{0}/default/default/default', variables('asaInstanceName')), '/')[2], split(format('{0}/default/default/default', variables('asaInstanceName')), '/')[3])]",
        "[resourceId('Microsoft.Authorization/roleAssignments', variables('name_roleAssignmentName'))]",
        "[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('userAssignedManagedIdentityName'))]"
      ]
    }
  ],
  "outputs": {
    "API_Gateway_URL": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('apiGatewayAppName')), '2023-05-01-preview').url]"
    },
    "Admin_Server_URL": {
      "type": "string",
      "value": "[reference(resourceId('Microsoft.AppPlatform/Spring/apps', variables('asaInstanceName'), variables('adminServerAppName')), '2023-05-01-preview').url]"
    }
  }
}