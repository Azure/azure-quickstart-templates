{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.22.6.54827",
      "templateHash": "8992268210775298779"
    }
  },
  "parameters": {
    "displayName": {
      "type": "string",
      "defaultValue": "Cost optimization",
      "metadata": {
        "description": "Optional. Display name for the workbook used in the Gallery. Must be unique in the resource group."
      }
    },
    "location": {
      "type": "string",
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Optional. Location of the resources. Default: Same as deployment. See https://aka.ms/azureregions."
      }
    },
    "description": {
      "type": "string",
      "defaultValue": "Reports to help you optimize your cost.",
      "metadata": {
        "description": "Optional. Workbook description."
      }
    },
    "tags": {
      "type": "object",
      "defaultValue": {},
      "metadata": {
        "description": "Optional. Tags for all resources."
      }
    },
    "enableDefaultTelemetry": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Optional. Enable telemetry to track anonymous module usage trends, monitor for bugs, and improve future releases."
      }
    }
  },
  "variables": {
    "$fxv#0": {
      "version": "Notebook/1.0",
      "items": [
        {
          "type": 11,
          "content": {
            "version": "LinkItem/1.0",
            "style": "tabs",
            "links": [
              {
                "id": "ca40468d-4518-43bf-ac6e-0a11d7331e12",
                "cellValue": "SelectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Overview",
                "subTarget": "Welcome",
                "style": "link"
              },
              {
                "id": "f280fc2a-f42a-42a4-ad4b-be37ab3e8b48",
                "cellValue": "SelectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Rate optimization",
                "subTarget": "RateOptimization",
                "style": "link"
              },
              {
                "id": "26b3c7ef-1a00-4a3f-a773-677f00db9343",
                "cellValue": "SelectedTab",
                "linkTarget": "parameter",
                "linkLabel": "Usage optimization",
                "subTarget": "UsageOptimization",
                "style": "link"
              }
            ]
          },
          "name": "links - MainTabs"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "tabs",
                  "links": [
                    {
                      "id": "28fdc6e9-2946-4016-8e75-b812ff8f853d",
                      "cellValue": "SelectedRateOptimizationTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Compute",
                      "subTarget": "Compute",
                      "style": "link"
                    },
                    {
                      "id": "4e0a0d2d-1d61-4d04-a35d-93e38d1bac29",
                      "cellValue": "SelectedRateOptimizationTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Storage",
                      "subTarget": "Storage",
                      "style": "link"
                    },
                    {
                      "id": "22d04714-50f4-4d72-baec-e8ccddddc7f3",
                      "cellValue": "SelectedRateOptimizationTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Networking",
                      "subTarget": "Networking",
                      "style": "link"
                    }
                  ]
                },
                "name": "links - UsageOptimization tabs"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "51aa3a9b-14e0-4c22-a60d-abdbf8813f00",
                      "version": "KqlParameterItem/1.0",
                      "name": "Subscription",
                      "type": 6,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "includeAll": true,
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "defaultValue": "value::all",
                      "label": " Subscription",
                      "value": [
                        "value::all"
                      ]
                    },
                    {
                      "id": "f342a111-002a-47fd-807f-0d4ccac0618a",
                      "version": "KqlParameterItem/1.0",
                      "name": "ResourceGroup",
                      "label": "Resource Group",
                      "type": 2,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "resources\r\n| distinct resourceGroup",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "defaultValue": "value::all",
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                      "id": "2336f06b-ddaa-4a9e-b72f-a2bec1ea84a9",
                      "version": "KqlParameterItem/1.0",
                      "name": "SingleSubHidden",
                      "type": 1,
                      "isRequired": true,
                      "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "isHiddenWhenLocked": true,
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "label": "Hidden Subscription"
                    },
                    {
                      "id": "d6776ffe-e4f6-4c08-8f9e-a2fe2b3b6634",
                      "version": "KqlParameterItem/1.0",
                      "name": "TagName",
                      "type": 2,
                      "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": []
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": null,
                      "label": "Tag Name"
                    },
                    {
                      "id": "f73dc4a1-ef8b-45c5-a30b-a11bb077a3cc",
                      "version": "KqlParameterItem/1.0",
                      "name": "TagValue",
                      "type": 2,
                      "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": []
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": null,
                      "label": "Tag Value"
                    }
                  ],
                  "style": "pills",
                  "queryType": 0,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "customWidth": "75",
                "conditionalVisibility": {
                  "parameterName": "SelectedTab",
                  "comparison": "isEqualTo",
                  "value": "UsageOptimization"
                },
                "name": "parameters - Filters"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "template",
                  "loadFromTemplateId": "",
                  "items": [
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "7a720abf-5b4a-4fb1-adaf-2383e70f625d",
                            "version": "KqlParameterItem/1.0",
                            "name": "Subscription",
                            "type": 6,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "includeAll": true,
                              "showDefault": false
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::all",
                            "label": " Subscription"
                          },
                          {
                            "id": "a29babbc-5092-46c5-b03b-932c90aa61c9",
                            "version": "KqlParameterItem/1.0",
                            "name": "ResourceGroup",
                            "label": "Resource Group",
                            "type": 2,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "query": "resources\r\n| distinct resourceGroup",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "showDefault": false
                            },
                            "defaultValue": "value::all",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources"
                          },
                          {
                            "id": "4b9c84b6-14ab-4663-b8b7-8bf0c351bbb5",
                            "version": "KqlParameterItem/1.0",
                            "name": "SingleSubHidden",
                            "type": 1,
                            "isRequired": true,
                            "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Hidden Subscription"
                          },
                          {
                            "id": "6637e003-5323-4c6d-9990-426388c833e9",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagName",
                            "type": 2,
                            "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Name"
                          },
                          {
                            "id": "d390e2b5-aa2f-494b-bbb8-0b18c8de9063",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagValue",
                            "type": 2,
                            "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Value"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "75",
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "CostInformation"
                        },
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "Welcome"
                        }
                      ],
                      "name": "parameters - Filters"
                    },
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "ae7eb928-8873-46f8-a3ff-77f45c207fb3",
                            "version": "KqlParameterItem/1.0",
                            "name": "Location",
                            "type": 2,
                            "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| project name, location\r\n| summarize count () by location\r\n| project location",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::1"
                              ]
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::1",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Resource Location"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "25",
                      "conditionalVisibility": {
                        "parameterName": "SelectedTab",
                        "comparison": "isEqualTo",
                        "value": "AHB"
                      },
                      "name": "parameters - location"
                    },
                    {
                      "type": 11,
                      "content": {
                        "version": "LinkItem/1.0",
                        "style": "tabs",
                        "links": [
                          {
                            "id": "0211f413-9f36-4750-9ef2-d382ba30ba6c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Application Gateway",
                            "subTarget": "appGateway",
                            "preText": "VM",
                            "style": "link"
                          },
                          {
                            "id": "61595d5e-9f25-4919-95a6-1462739f4657",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Load Balancer",
                            "subTarget": "loadBalancer",
                            "style": "link"
                          },
                          {
                            "id": "dbe9a7fb-6ab1-4de1-a98b-4ec8a9af906c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Public IP Address",
                            "subTarget": "publicIP",
                            "style": "link"
                          },
                          {
                            "id": "79e7a97a-1413-41e8-b4c6-ebd1d0a45e2e",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Virtual Network Gateway",
                            "subTarget": "vpnGw",
                            "style": "link"
                          },
                          {
                            "id": "6d563f46-7150-458c-9ee4-0558abe8e29b",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Advisor recommendations",
                            "subTarget": "advisorNetworking",
                            "style": "link"
                          }
                        ]
                      },
                      "name": "links - Networking"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Recommendations for Application Gateways\r\nReview Application Gateways which include backend pools with no targets. Resources listed with 2 red signs are considered idle.",
                                    "style": "upsell"
                                  },
                                  "name": "Recommendations for Application Gateways"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources\r\n| where type =~ 'Microsoft.Network/applicationGateways' and resourceGroup in ({ResourceGroup})\r\n| extend backendPoolsCount = array_length(properties.backendAddressPools),SKUName= tostring(properties.sku.name), SKUTier= tostring(properties.sku.tier),SKUCapacity=properties.sku.capacity,backendPools=properties.backendAddressPools,resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| project id, name, SKUName, SKUTier, SKUCapacity,resourceGroup,subscriptionId\r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Network/applicationGateways' and resourceGroup in ({ResourceGroup})\r\n    | mvexpand backendPools = properties.backendAddressPools\r\n    | extend backendIPCount = array_length(backendPools.properties.backendIPConfigurations)\r\n    | extend backendAddressesCount = array_length(backendPools.properties.backendAddresses)\r\n    | extend backendPoolName  = backendPools.properties.backendAddressPools.name\r\n    | summarize backendIPCount = sum(backendIPCount) ,backendAddressesCount=sum(backendAddressesCount) by id\r\n) on id\r\n| project-away id1\r\n| where  (backendIPCount == 0 or isempty(backendIPCount)) and (backendAddressesCount==0 or isempty(backendAddressesCount))\r\n| order by id asc\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id",
                                    "size": 0,
                                    "title": "Application gateways with empty backend pools",
                                    "noDataMessage": "You don't have any Application Gateways with empty backendpools",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "SKUCapacity",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "backendIPCount",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "0",
                                                "representation": "disabled",
                                                "text": "No Backend IPs"
                                              },
                                              {
                                                "operator": ">",
                                                "thresholdValue": "0",
                                                "representation": "success",
                                                "text": "Backend IP configured"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "backendAddressesCount",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "0",
                                                "representation": "disabled",
                                                "text": "No Backend targets"
                                              },
                                              {
                                                "operator": ">",
                                                "thresholdValue": "0",
                                                "representation": "success",
                                                "text": "Backend targets available"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "id1",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "Recommendation",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "colors",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "No Backend targets",
                                                "representation": "redBright",
                                                "text": "No Backend targets"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "green",
                                                "text": "Backend targets enabled"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "backendPoolIPTarget",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": ">",
                                                "thresholdValue": "0",
                                                "representation": "success",
                                                "text": ""
                                              },
                                              {
                                                "operator": "==",
                                                "thresholdValue": "0",
                                                "representation": "disabled",
                                                "text": ""
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "backendPoolVMTarget",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "is Empty",
                                                "representation": "disabled",
                                                "text": ""
                                              },
                                              {
                                                "operator": ">",
                                                "thresholdValue": "0",
                                                "representation": "success",
                                                "text": ""
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "Recommednation",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "colors",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "No Backend targets",
                                                "representation": "redBright",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "green",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        }
                                      ],
                                      "labelSettings": [
                                        {
                                          "columnId": "id",
                                          "label": "ID"
                                        },
                                        {
                                          "columnId": "name",
                                          "label": "Name"
                                        },
                                        {
                                          "columnId": "SKUName",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "SKUTier",
                                          "label": "SKU Tier"
                                        },
                                        {
                                          "columnId": "SKUCapacity",
                                          "label": "Capacity"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription ID"
                                        },
                                        {
                                          "columnId": "backendIPCount",
                                          "label": "Has backend pool for IPs?"
                                        },
                                        {
                                          "columnId": "backendAddressesCount",
                                          "label": "Has backend pool for VMs?"
                                        },
                                        {
                                          "columnId": "id1",
                                          "label": "ResourceID"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "Get-Idle-AppGW"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "appGateway"
                            },
                            "name": "NetworkingAppGateway"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Recommendations for Load Balancers\r\nReview Load balancers with no backend pools, and remove them if not needed.",
                                    "style": "upsell"
                                  },
                                  "name": "Recommendations for Load Balancers"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| extend resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup), SKUName=tostring(sku.name),SKUTier=tostring(sku.tier),location,backendAddressPools = properties.backendAddressPools\r\n| where type =~ 'microsoft.network/loadbalancers' and array_length(backendAddressPools) == 0 \r\n| order by id asc\r\n| project id,name, SKUName,SKUTier,backendAddressPools, location,resourceGroup, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id",
                                    "size": 0,
                                    "title": "Load Balancers with empty backend pools",
                                    "noDataMessage": "You don't have any Load Balancers with empty backendpools",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "backendAddressPools",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "0",
                                                "representation": "disabled",
                                                "text": "Empty Backend Pool"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": ""
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "id1",
                                          "formatter": 5
                                        }
                                      ],
                                      "labelSettings": [
                                        {
                                          "columnId": "id",
                                          "label": "Resource ID"
                                        },
                                        {
                                          "columnId": "name",
                                          "label": "Name"
                                        },
                                        {
                                          "columnId": "SKUName",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "SKUTier",
                                          "label": "SKU Tier"
                                        },
                                        {
                                          "columnId": "backendAddressPools",
                                          "label": "Has backend pool?"
                                        },
                                        {
                                          "columnId": "location",
                                          "label": "Location"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "id1",
                                          "label": "ResourceID"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "Get-Idle-LB"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "loadBalancer"
                            },
                            "name": "LoadBalancerGroup"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Recommendations for Public IP Addresses\r\nReview unattached Public IP addresses, as they may represent additional cost.\r\n<br>This query will also show Public IPs attached to Idle network cards.\r\n",
                                    "style": "upsell"
                                  },
                                  "name": "Recommendations for PIP"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'Microsoft.Network/publicIPAddresses' and isempty(properties.ipConfiguration) and isempty(properties.natGateway) \r\n| extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, Location=location ,resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| project PublicIpId,IPName, SKUName, resourceGroup, Location, AllocationMethod, subscriptionId\r\n| union (\r\n Resources \r\n | where type =~ 'microsoft.network/networkinterfaces' and isempty(properties.virtualMachine) and isnull(properties.privateEndpoint) and isnotempty(properties.ipConfigurations) \r\n | extend IPconfig = properties.ipConfigurations \r\n | mv-expand IPconfig \r\n | extend PublicIpId= tostring(IPconfig.properties.publicIPAddress.id)\r\n | project PublicIpId\r\n | join ( \r\n    resources \r\n    | where type =~ 'Microsoft.Network/publicIPAddresses'\r\n    | extend PublicIpId=id, IPName=name, AllocationMethod=tostring(properties.publicIPAllocationMethod), SKUName=sku.name, resourceGroup, Location=location \r\n ) on PublicIpId\r\n | project PublicIpId,IPName, SKUName, resourceGroup, Location, AllocationMethod, subscriptionId\r\n)\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | extend PublicIpId=id\r\n    | distinct PublicIpId\r\n    )\r\n    on PublicIpId\r\n",
                                    "size": 0,
                                    "title": "Unattached Public IPs",
                                    "noDataMessage": "You have no unattached Public IPs",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "PublicIpId1",
                                          "formatter": 5
                                        }
                                      ],
                                      "labelSettings": [
                                        {
                                          "columnId": "PublicIpId",
                                          "label": "ID"
                                        },
                                        {
                                          "columnId": "IPName",
                                          "label": "Name"
                                        },
                                        {
                                          "columnId": "SKUName",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "AllocationMethod",
                                          "label": "Allocation Method"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "PublicIpId1",
                                          "label": "Resource ID"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "Get-Idle-PIP"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "publicIP"
                            },
                            "name": "PIPGroup"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Recommendations for Virtual Network Gateways\r\nReview idle Virtual Network Gateways that have no connections defined, as they may represent additional cost.\r\n",
                                    "style": "upsell"
                                  },
                                  "name": "Recommendations for idle virtualNetworkGateways"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources\r\n| where type == \"microsoft.network/virtualnetworkgateways\"\r\n| extend resourceGroup =strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| project id, GWName=name,resourceGroup,location,subscriptionId\r\n| join kind = leftouter(\r\n    resources\r\n    | where type == \"microsoft.network/connections\"\r\n    | extend id = tostring(properties.virtualNetworkGateway1.id)\r\n    | project id\r\n    | union (\r\n         resources\r\n         | where type == \"microsoft.network/connections\"\r\n         | extend id = tostring(properties.virtualNetworkGateway2.id)\r\n         | project id\r\n    )\r\n) on id\r\n| where isempty(id1)\r\n| project id, GWName,resourceGroup,location,subscriptionId,status=id",
                                    "size": 0,
                                    "title": "Idle Virtual Network Gateways",
                                    "noDataMessage": "No Idle Virtual Network Gateways found",
                                    "noDataMessageStyle": 3,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "status",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "warning",
                                                "text": "Error-Connection not configured"
                                              }
                                            ]
                                          }
                                        }
                                      ],
                                      "filter": true,
                                      "labelSettings": [
                                        {
                                          "columnId": "id",
                                          "label": "Resource ID"
                                        },
                                        {
                                          "columnId": "GWName",
                                          "label": "VPN Gateway Name"
                                        },
                                        {
                                          "columnId": "status",
                                          "label": "Is connected?"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "query - Idle Virtual Network gateways"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "vpnGw"
                            },
                            "name": "VPNGW Group"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "advisorresources\r\n| where type =~ 'microsoft.advisor/recommendations'\r\n| where resourceGroup in ({ResourceGroup})\r\n| where properties.category == 'Cost' and properties.lastUpdated >= ago(1d)\r\n| extend AffectedResource=tostring(properties.resourceMetadata.resourceId), Category=properties.category, SubCategory=properties.impactedField, Impact=properties.impact,resourceGroup,subscriptionId,Recommendation=tostring(properties.shortDescription.problem), id, stableId = name, recommendationTypeId = tostring(properties.recommendationTypeId), maxCpuP95 = properties.extendedProperties.MaxCpuP95\r\n| join kind = leftouter\r\n(advisorresources | where type=~'microsoft.advisor/suppressions'\r\n| extend tokens = split(id, '/')\r\n| extend stableId = iff(array_length(tokens) > 3, tokens[(array_length(tokens)-3)], '')\r\n| extend expirationTimeStamp = todatetime(iff(strcmp(tostring(properties.ttl), '-1') == 0, '9999-12-31', properties.expirationTimeStamp))\r\n| where expirationTimeStamp > now()\r\n| project stableId, expirationTimeStamp)\r\non stableId\r\n| where isempty(expirationTimeStamp)\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId), Category=properties.category, SubCategory=properties.impactedField, Recommendation=tostring(properties.shortDescription.problem), Impact=properties.impact,resourceGroup,subscriptionId, id, stableId = name, recommendationTypeId = tostring(properties.recommendationTypeId), maxCpuP95 = properties.extendedProperties.MaxCpuP95\r\n| join kind = leftouter\r\n(advisorresources | where type =~ 'microsoft.advisor/configurations' | where isempty(resourceGroup) == true\r\n| project subscriptionId, excludeRecomm = properties.exclude, lowCpuThreshold = properties.lowCpuThreshold, AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,Recommendation=tostring(properties.shortDescription.problem))\r\non subscriptionId\r\n| extend isActive1 = iff(isnull(excludeRecomm), true, tobool(excludeRecomm) == false)\r\n| extend isActive2 = iff(recommendationTypeId == 'e10b1381-5f0a-47ff-8c7b-37bd13d7c974', iff((isnotempty(lowCpuThreshold) and isnotempty(maxCpuP95)), toint(maxCpuP95) < toint(lowCpuThreshold), iff((isempty(maxCpuP95) or toint(maxCpuP95) < 5), true, false)), true)\r\n| where isActive1 == true and isActive2 == true\r\n| join kind = leftouter\r\n(advisorresources | where type =~ 'microsoft.advisor/configurations' | where isnotempty(resourceGroup) == true\r\n| project subscriptionId, resourceGroup, excludeProperty = properties.exclude)\r\non subscriptionId, resourceGroup\r\n| extend isActive3 = iff(isnull(excludeProperty), true, tobool(excludeProperty) == false)\r\n| where isActive3 == true\r\n| where Category == 'Cost' \r\n| where SubCategory has \"Network\"\r\n| project-away subscriptionId1, subscriptionId2, AffectedResource1, isActive2, isActive3, Impact1, Recommendation1, resourceGroup1, resourceGroup2",
                                    "size": 0,
                                    "title": "Azure Advisor Cost recommendations",
                                    "noDataMessage": "You are following all of our cost recommendations for Networking",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "id",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "stableId",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "recommendationTypeId",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "maxCpuP95",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "excludeRecomm",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "lowCpuThreshold",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "AdditionaInfo",
                                          "formatter": 5,
                                          "formatOptions": {
                                            "customColumnWidthSetting": "19ch"
                                          }
                                        },
                                        {
                                          "columnMatch": "isActive1",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "excludeProperty",
                                          "formatter": 5
                                        }
                                      ],
                                      "rowLimit": 1000,
                                      "filter": true,
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "Recommendation"
                                        ],
                                        "expandTopLevel": true
                                      },
                                      "labelSettings": [
                                        {
                                          "columnId": "AffectedResource",
                                          "label": "Affected Resource"
                                        },
                                        {
                                          "columnId": "Category",
                                          "label": "Recommendation Category"
                                        },
                                        {
                                          "columnId": "SubCategory",
                                          "label": "Affected Resource Type"
                                        },
                                        {
                                          "columnId": "Recommendation",
                                          "label": "Recommendation"
                                        },
                                        {
                                          "columnId": "Impact",
                                          "label": "Impact"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription ID"
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "isVisible",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "Get-AdvisorRecommendations-Networking"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": " resources\r\n    | where resourceGroup in ({ResourceGroup})\r\n    | where type has \"Microsoft.Network\"\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend AffectedResource=id,ResourceRG=resourceGroup\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    | project id",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "isVisible",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "query - tags - list all network resources"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\",\"mergeType\":\"innerunique\",\"leftTable\":\"Get-AdvisorRecommendations-Networking\",\"rightTable\":\"query - tags - list all network resources\",\"leftColumn\":\"AffectedResource\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[Get-AdvisorRecommendations-Networking].AffectedResource\",\"mergedName\":\"AffectedResource\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].Category\",\"mergedName\":\"Category\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].SubCategory\",\"mergedName\":\"SubCategory\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].Recommendation\",\"mergedName\":\"Recommendation\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].Impact\",\"mergedName\":\"Impact\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d87008d\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].excludeProperty\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].isActive1\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].AdditionaInfo\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].lowCpuThreshold\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].excludeRecomm\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].maxCpuP95\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].recommendationTypeId\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].stableId\"},{\"originalName\":\"[query - tags - list all network resources].id\"},{\"originalName\":\"[Get-AdvisorRecommendations-Networking].id\"}]}",
                                    "size": 0,
                                    "title": "Azure Advisor Cost recommendations",
                                    "noDataMessage": "You are following all of our cost recommendations for Networking",
                                    "noDataMessageStyle": 3,
                                    "queryType": 7
                                  },
                                  "showPin": false,
                                  "name": "query - Merge - Network Advisor recommendations"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "advisorNetworking"
                            },
                            "name": "AdvisorGroupNetworking"
                          }
                        ]
                      },
                      "name": "networking - Subscription"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "SelectedTab",
                    "comparison": "isEqualTo",
                    "value": "UsageOptimization"
                  },
                  {
                    "parameterName": "SelectedRateOptimizationTab",
                    "comparison": "isEqualTo",
                    "value": "Networking"
                  }
                ],
                "name": "NetworkingGroup",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "template",
                  "title": "Storage cost optimization recommendations",
                  "loadFromTemplateId": "",
                  "items": [
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "37ceb1c3-3930-4689-a90b-22f26e42bd81",
                            "version": "KqlParameterItem/1.0",
                            "name": "Subscription",
                            "type": 6,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "includeAll": true,
                              "showDefault": false
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::all",
                            "label": " Subscription"
                          },
                          {
                            "id": "08f5fe68-c2e3-4882-9300-b3e33f572dfe",
                            "version": "KqlParameterItem/1.0",
                            "name": "ResourceGroup",
                            "label": "Resource Group",
                            "type": 2,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "query": "resources\r\n| distinct resourceGroup",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "showDefault": false
                            },
                            "defaultValue": "value::all",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources"
                          },
                          {
                            "id": "4fea3013-df84-4930-a453-8a6bd0375130",
                            "version": "KqlParameterItem/1.0",
                            "name": "SingleSubHidden",
                            "type": 1,
                            "isRequired": true,
                            "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Hidden Subscription"
                          },
                          {
                            "id": "8412f39d-ee67-4979-b887-47463b8848c2",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagName",
                            "type": 2,
                            "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Name"
                          },
                          {
                            "id": "50c68f38-13a0-4aff-a259-4426c83b7cc0",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagValue",
                            "type": 2,
                            "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Value"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "75",
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "CostInformation"
                        },
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "Welcome"
                        }
                      ],
                      "name": "parameters - Filters"
                    },
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "eae8a0d2-14e6-4cd1-a2d2-fd6b207cf517",
                            "version": "KqlParameterItem/1.0",
                            "name": "Location",
                            "type": 2,
                            "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| project name, location\r\n| summarize count () by location\r\n| project location",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::1"
                              ]
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::1",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Resource Location"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "25",
                      "conditionalVisibility": {
                        "parameterName": "SelectedTab",
                        "comparison": "isEqualTo",
                        "value": "AHB"
                      },
                      "name": "parameters - location"
                    },
                    {
                      "type": 11,
                      "content": {
                        "version": "LinkItem/1.0",
                        "style": "tabs",
                        "links": [
                          {
                            "id": "0211f413-9f36-4750-9ef2-d382ba30ba6c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Storage Accounts",
                            "subTarget": "Storage",
                            "preText": "VM",
                            "style": "link"
                          },
                          {
                            "id": "dbe9a7fb-6ab1-4de1-a98b-4ec8a9af906c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Managed Disks",
                            "subTarget": "Disks",
                            "style": "link"
                          },
                          {
                            "id": "6d563f46-7150-458c-9ee4-0558abe8e29b",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Advisor recommendations",
                            "subTarget": "advisorStorage",
                            "style": "link"
                          }
                        ]
                      },
                      "name": "links - Storage"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "# Storage accounts\r\nGeneral-purpose v2 storage accounts support the latest Azure Storage features and incorporate all of the functionality of general-purpose v1 and Blob storage accounts. General-purpose v2 accounts are recommended for most storage scenarios.\r\n\r\n1. General-purpose v2 accounts deliver the lowest per-gigabyte capacity prices for Azure Storage, as well as industry-competitive transaction prices.\r\n2. General-purpose v2 accounts support default account access tiers of hot or cool and blob level tiering between hot, cool, or archive.\r\n3. General-purpose v2 accounts allows you to also use lifecycle management to optimize your storage cost",
                              "style": "upsell"
                            },
                            "name": "Storage accounts"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources \r\n| where type =~ 'Microsoft.Storage/StorageAccounts' and kind !='StorageV2' and kind !='FileStorage'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend StorageAccountName=name, SAKind=kind,AccessTier=tostring(properties.accessTier),SKUName=sku.name, SKUTier=sku.tier, Location=location\r\n| order by id asc\r\n| project id,StorageAccountName, SKUName, SKUTier, SAKind,AccessTier, resourceGroup, Location, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id",
                              "size": 0,
                              "title": "Storage accounts which are not v2",
                              "noDataMessage": "All storage accounts are General-purpose v2",
                              "noDataMessageStyle": 3,
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "subscriptionId",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "id1",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "storageaccount",
                                    "formatter": 13,
                                    "formatOptions": {
                                      "linkTarget": "Resource",
                                      "subTarget": "insights",
                                      "linkIsContextBlade": true,
                                      "showIcon": true
                                    }
                                  }
                                ],
                                "labelSettings": [
                                  {
                                    "columnId": "id",
                                    "label": "Resource ID"
                                  },
                                  {
                                    "columnId": "StorageAccountName",
                                    "label": "Name"
                                  },
                                  {
                                    "columnId": "SKUName",
                                    "label": "SKU"
                                  },
                                  {
                                    "columnId": "SKUTier",
                                    "label": "SKU Tier"
                                  },
                                  {
                                    "columnId": "SAKind",
                                    "label": "Kind"
                                  },
                                  {
                                    "columnId": "AccessTier",
                                    "label": "Access Tier"
                                  },
                                  {
                                    "columnId": "resourceGroup",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "Location",
                                    "label": "Location"
                                  },
                                  {
                                    "columnId": "subscriptionId",
                                    "label": "Subscription Name"
                                  }
                                ]
                              }
                            },
                            "name": "Get-Storagev1"
                          }
                        ]
                      },
                      "conditionalVisibility": {
                        "parameterName": "SelectedSubTab",
                        "comparison": "isEqualTo",
                        "value": "Storage"
                      },
                      "name": "StorageAccountGroup"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "## Unattached Managed Disks\r\n\r\nReview Managed Disks that are not attached to any Virtual machine\r\n",
                              "style": "upsell"
                            },
                            "name": "text - 3"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources \r\n| where type =~ 'microsoft.compute/disks' and managedBy == \"\"\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend diskState = tostring(properties.diskState)\r\n| where managedBy == \"\" and diskState != 'ActiveSAS'\r\nor diskState == 'Unattached' and diskState != 'ActiveSAS'\r\n| extend DiskId=id, DiskIDfull=id, DiskName=name, SKUName=sku.name, SKUTier=sku.tier, DiskSizeGB=tostring(properties.diskSizeGB), Location=location, TimeCreated=tostring(properties.timeCreated), QuickFix=id\r\n| order by DiskId asc \r\n| project DiskId, DiskIDfull, DiskName, DiskSizeGB, SKUName, SKUTier, resourceGroup, QuickFix, Location, TimeCreated, subscriptionId\r\n",
                              "size": 0,
                              "title": "Unattached disks",
                              "noDataMessage": "There aren't any unattached disks!",
                              "noDataMessageStyle": 3,
                              "exportedParameters": [
                                {
                                  "fieldName": "DiskIDfull",
                                  "parameterName": "DiskID"
                                },
                                {
                                  "fieldName": "DiskName",
                                  "parameterName": "DiskName",
                                  "parameterType": 1
                                },
                                {
                                  "fieldName": "resourceGroup",
                                  "parameterName": "ResourceGroup",
                                  "parameterType": 1
                                }
                              ],
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "visualization": "table",
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "DiskIDfull",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "QuickFix",
                                    "formatter": 7,
                                    "formatOptions": {
                                      "linkTarget": "ArmAction",
                                      "linkLabel": "Remove Idle Disk",
                                      "linkIsContextBlade": true,
                                      "templateRunContext": {
                                        "componentIdSource": "column",
                                        "componentId": "DiskId",
                                        "templateUriSource": "static",
                                        "templateUri": "https://raw.githubusercontent.com/sebassem/MS-learn-Workbooks/main/Deploy-Tag.json",
                                        "templateParameters": [
                                          {
                                            "name": "DiskID",
                                            "source": "static",
                                            "value": "DiskId",
                                            "kind": "stringValue"
                                          }
                                        ],
                                        "titleSource": "static",
                                        "title": "Remove Idle Disk",
                                        "descriptionSource": "static",
                                        "description": "# Description\r\nThis ARM Template will remove the selected disk.\r\n\r\n# Actions:\r\n- Click \"Remove Idle Disk\" to remove the selected item.\r\n- Click View Template to examine the template and parameters used during deployment\r\n\r\n\r\n\r\n",
                                        "runLabelSource": "static",
                                        "runLabel": "Remove Idle Disk"
                                      },
                                      "armActionContext": {
                                        "path": "/{DiskID}?api-version=2021-04-01",
                                        "headers": [],
                                        "params": [
                                          {
                                            "key": "DiskID",
                                            "value": ""
                                          }
                                        ],
                                        "httpMethod": "DELETE",
                                        "title": "Remove Idle Disks",
                                        "description": "# Disk Deletion Warning: {DiskName}\r\n\r\n**Attention!**\r\n\r\nThis action will permanently remove the disk with the name **{DiskName}**. Please ensure that this disk is not currently in use and that you are deleting the correct disk.\r\n\r\n**Resource Details:**\r\n\r\n- Disk Name: {DiskName}\r\n- Resource Group: {ResourceGroup}\r\n\r\n### Required RBAC Permissions\r\n\r\nTo perform this action, you need to have **Contributor** permissions on the Resource Group where the disk is located.\r\n\r\nPlease review the information carefully before proceeding with the deletion.\r\n",
                                        "actionName": "Removing Idle Dsk",
                                        "runLabel": "I understand, remove disk {DiskName}"
                                      }
                                    }
                                  },
                                  {
                                    "columnMatch": "subscriptionId",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  }
                                ],
                                "rowLimit": 1000,
                                "labelSettings": [
                                  {
                                    "columnId": "DiskId",
                                    "label": "Resource ID"
                                  },
                                  {
                                    "columnId": "DiskName",
                                    "label": "Name"
                                  },
                                  {
                                    "columnId": "DiskSizeGB",
                                    "label": "Disk Size (GB)"
                                  },
                                  {
                                    "columnId": "SKUName",
                                    "label": "SKU"
                                  },
                                  {
                                    "columnId": "SKUTier",
                                    "label": "SKU Tier"
                                  },
                                  {
                                    "columnId": "resourceGroup",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "QuickFix",
                                    "label": "Delete disk?"
                                  },
                                  {
                                    "columnId": "Location",
                                    "label": "Location"
                                  },
                                  {
                                    "columnId": "TimeCreated",
                                    "label": "Time Created"
                                  },
                                  {
                                    "columnId": "subscriptionId",
                                    "label": "Subscription Name"
                                  }
                                ]
                              }
                            },
                            "name": "Get-Idle-Disk"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "## Old Managed Disks snapshots\r\n\r\nReview Managed Disks snapshots that are older than 30 days\r\n",
                              "style": "upsell"
                            },
                            "name": "text - 4"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources\r\n| where type == 'microsoft.compute/snapshots'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend TimeCreated = properties.timeCreated\r\n| extend resourceGroup=strcat(\"/subscriptions/\",subscriptionId,\"/resourceGroups/\",resourceGroup)\r\n| where TimeCreated < ago(30d)\r\n| order by id asc \r\n| project id, resourceGroup, location, TimeCreated ,subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id",
                              "size": 0,
                              "title": "Disk Snapshots with + 30 Days",
                              "noDataMessage": "No Snapshots with more than 30 days.",
                              "noDataMessageStyle": 3,
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "resourceGroup",
                                    "formatter": 14,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "TimeCreated",
                                    "formatter": 1
                                  },
                                  {
                                    "columnMatch": "subscriptionId",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "id1",
                                    "formatter": 5
                                  }
                                ],
                                "labelSettings": [
                                  {
                                    "columnId": "id",
                                    "label": "Name"
                                  },
                                  {
                                    "columnId": "resourceGroup",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "location",
                                    "label": "Location"
                                  },
                                  {
                                    "columnId": "TimeCreated",
                                    "label": "Time Created"
                                  },
                                  {
                                    "columnId": "subscriptionId",
                                    "label": "Subscription Name"
                                  }
                                ]
                              }
                            },
                            "name": "Get-Old-Snapshots"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "## Managed Disks snapshots using Premium storage\r\n\r\nTo save 60% of cost, we recommend storing your snapshots in Standard Storage, regardless of the storage type of the parent disk. It is the default option for Managed Disks snapshots. Migrate your snapshot from Premium to Standard Storage.\r\n",
                              "style": "upsell"
                            },
                            "name": "text - 5"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources\r\n| where type == 'microsoft.compute/snapshots'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend StorageSku = tostring(sku.tier), resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup),diskSize=tostring(properties.diskSizeGB)\r\n| where StorageSku == \"Premium\"\r\n| project id,name,StorageSku,diskSize,location,resourceGroup,subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id\r\n",
                              "size": 0,
                              "title": "Snapshots using premium storage",
                              "noDataMessage": "No snapshots are using Premium storage",
                              "noDataMessageStyle": 3,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "resourceGroup",
                                    "formatter": 14,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "subscriptionId",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "id1",
                                    "formatter": 5
                                  }
                                ],
                                "labelSettings": [
                                  {
                                    "columnId": "id",
                                    "label": "Resource Id"
                                  },
                                  {
                                    "columnId": "name",
                                    "label": "Name"
                                  },
                                  {
                                    "columnId": "StorageSku",
                                    "label": "SKU"
                                  },
                                  {
                                    "columnId": "diskSize",
                                    "label": "Disk Size (GB)"
                                  },
                                  {
                                    "columnId": "location",
                                    "label": "Location"
                                  },
                                  {
                                    "columnId": "resourceGroup",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "subscriptionId",
                                    "label": "Subscription Id"
                                  }
                                ]
                              }
                            },
                            "name": "query - Snapshots using premium storage"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "## Orphaned Managed Disks snapshots\r\n\r\nReview snapshots with deleted source disks.\r\n",
                              "style": "upsell"
                            },
                            "name": "text - 6"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources\r\n| where type == 'microsoft.compute/snapshots'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend parentDisk = properties.creationData.sourceResourceId, diskSize=tostring(properties.diskSizeGB),resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| project id,parentDisk,diskSize,location,resourceGroup,subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id\r\n",
                              "size": 0,
                              "title": "All Managed Disks snapshots",
                              "noDataMessage": "No snapshots found",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "gridSettings": {
                                "labelSettings": [
                                  {
                                    "columnId": "id",
                                    "label": "Resource Id"
                                  },
                                  {
                                    "columnId": "parentDisk",
                                    "label": "Parent Disk Resource Id"
                                  },
                                  {
                                    "columnId": "diskSize",
                                    "label": "Disk size (GB)"
                                  },
                                  {
                                    "columnId": "location",
                                    "label": "Location"
                                  },
                                  {
                                    "columnId": "resourceGroup",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "subscriptionId",
                                    "label": "Subscription Id"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "IsVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - Retrieve all snapshots"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources\r\n| where type == 'microsoft.compute/disks'\r\n| project id\r\n",
                              "size": 0,
                              "title": "All managed disks",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "gridSettings": {
                                "labelSettings": [
                                  {
                                    "columnId": "id",
                                    "label": "Resource Id"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "isVisible",
                              "comparison": "isEqualTo",
                              "value": "True"
                            },
                            "name": "query - Retrieve all managed disks"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\",\"mergeType\":\"leftanti\",\"leftTable\":\"query - Retrieve all snapshots\",\"rightTable\":\"query - Retrieve all managed disks\",\"leftColumn\":\"parentDisk\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[query - Retrieve all snapshots].id\",\"mergedName\":\"Resource Id\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"},{\"originalName\":\"[query - Retrieve all snapshots].parentDisk\",\"mergedName\":\"Parent Disk Resource Id\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"},{\"originalName\":\"[query - Retrieve all snapshots].diskSize\",\"mergedName\":\"Disk size (GB)\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"},{\"originalName\":\"[query - Retrieve all snapshots].location\",\"mergedName\":\"Location\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"},{\"originalName\":\"[query - Retrieve all snapshots].resourceGroup\",\"mergedName\":\"Resource Group\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"},{\"originalName\":\"[query - Retrieve all snapshots].subscriptionId\",\"mergedName\":\"Subscription Id\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"},{\"originalName\":\"[query - Retrieve all snapshots].id1\",\"mergedName\":\"id1\",\"fromId\":\"d0a11ffb-579b-4259-827d-7ea62e3021fe\"}]}",
                              "size": 0,
                              "title": "Snapshots with deleted source disk",
                              "noDataMessage": "No orphaned snapshots found",
                              "noDataMessageStyle": 3,
                              "queryType": 7,
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Parent Disk Resource Id",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "Subscription Id",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "id1",
                                    "formatter": 5
                                  }
                                ],
                                "labelSettings": [
                                  {
                                    "columnId": "Resource Id",
                                    "label": "Resource Id"
                                  },
                                  {
                                    "columnId": "Parent Disk Resource Id",
                                    "label": "Parent Disk resource Id"
                                  },
                                  {
                                    "columnId": "Disk size (GB)",
                                    "label": "Disk size (GB)"
                                  },
                                  {
                                    "columnId": "Location",
                                    "label": "Location"
                                  },
                                  {
                                    "columnId": "Resource Group",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "Subscription Id",
                                    "label": "Subscription Id"
                                  }
                                ]
                              }
                            },
                            "showPin": false,
                            "name": "query - orphaned snapshots"
                          }
                        ]
                      },
                      "conditionalVisibility": {
                        "parameterName": "SelectedSubTab",
                        "comparison": "isEqualTo",
                        "value": "Disks"
                      },
                      "name": "Managed Disks Group"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "advisorresources\r\n| where type =~ 'microsoft.advisor/recommendations'\r\n| where resourceGroup in ({ResourceGroup})\r\n| where properties.category == 'Cost' and properties.lastUpdated >= ago(1d)\r\n| extend AffectedResource=tostring(properties.resourceMetadata.resourceId), Category=tostring(properties.category), SubCategory=tostring(properties.impactedField), Impact=tostring(properties.impact),resourceGroup,subscriptionId,Recommendation=tostring(properties.shortDescription.problem), id, stableId = name, recommendationTypeId = tostring(properties.recommendationTypeId), maxCpuP95 = properties.extendedProperties.MaxCpuP95\r\n| where SubCategory has \"Microsoft.Storage\"\r\n| join kind = leftouter\r\n(advisorresources | where type=~'microsoft.advisor/suppressions'\r\n| extend tokens = split(id, '/')\r\n| extend stableId = iff(array_length(tokens) > 3, tokens[(array_length(tokens)-3)], '')\r\n| extend expirationTimeStamp = todatetime(iff(strcmp(tostring(properties.ttl), '-1') == 0, '9999-12-31', properties.expirationTimeStamp))\r\n| where expirationTimeStamp > now()\r\n| project stableId, expirationTimeStamp)\r\non stableId\r\n| where isempty(expirationTimeStamp)\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId), Category=tostring(properties.category), SubCategory=tostring(properties.impactedField), Recommendation=tostring(properties.shortDescription.problem), Impact=tostring(properties.impact),resourceGroup,subscriptionId, id, stableId = name, recommendationTypeId = tostring(properties.recommendationTypeId), maxCpuP95 = properties.extendedProperties.MaxCpuP95\r\n| join kind = leftouter\r\n(advisorresources | where type =~ 'microsoft.advisor/configurations' | where isempty(resourceGroup) == true\r\n| project subscriptionId, excludeRecomm = properties.exclude, lowCpuThreshold = properties.lowCpuThreshold, AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=properties.impact,resourceGroup,AdditionaInfo=properties.extendedProperties,Recommendation=tostring(properties.shortDescription.problem))\r\non subscriptionId\r\n| extend isActive1 = iff(isnull(excludeRecomm), true, tobool(excludeRecomm) == false)\r\n| extend isActive2 = iff(recommendationTypeId == 'e10b1381-5f0a-47ff-8c7b-37bd13d7c974', iff((isnotempty(lowCpuThreshold) and isnotempty(maxCpuP95)), toint(maxCpuP95) < toint(lowCpuThreshold), iff((isempty(maxCpuP95) or toint(maxCpuP95) < 5), true, false)), true)\r\n| where isActive1 == true and isActive2 == true\r\n| join kind = leftouter\r\n(advisorresources | where type =~ 'microsoft.advisor/configurations' | where isnotempty(resourceGroup) == true\r\n| project subscriptionId, resourceGroup, excludeProperty = properties.exclude)\r\non subscriptionId, resourceGroup\r\n| extend isActive3 = iff(isnull(excludeProperty), true, tobool(excludeProperty) == false)\r\n| where isActive3 == true\r\n| project-away subscriptionId1, subscriptionId2, AffectedResource1, isActive2, isActive3, Impact1, Recommendation1, resourceGroup1, resourceGroup2\r\n| where resourceGroup in ({ResourceGroup})",
                              "size": 0,
                              "title": "Azure Advisor Cost recommendations",
                              "noDataMessage": "You are following all of our cost recommendations for Storage",
                              "noDataMessageStyle": 3,
                              "showExportToExcel": true,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Group",
                                    "formatter": 1
                                  },
                                  {
                                    "columnMatch": "subscriptionId",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  },
                                  {
                                    "columnMatch": "id",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "stableId",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "recommendationTypeId",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "maxCpuP95",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "excludeRecomm",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "lowCpuThreshold",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "AdditionaInfo",
                                    "formatter": 5,
                                    "formatOptions": {
                                      "customColumnWidthSetting": "19ch"
                                    }
                                  },
                                  {
                                    "columnMatch": "isActive1",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "excludeProperty",
                                    "formatter": 5
                                  }
                                ],
                                "rowLimit": 1000,
                                "filter": true,
                                "hierarchySettings": {
                                  "treeType": 1,
                                  "groupBy": [
                                    "Recommendation"
                                  ],
                                  "expandTopLevel": true
                                },
                                "labelSettings": [
                                  {
                                    "columnId": "AffectedResource",
                                    "label": "Affected Resource"
                                  },
                                  {
                                    "columnId": "Category",
                                    "label": "Recommendation Category"
                                  },
                                  {
                                    "columnId": "SubCategory",
                                    "label": "Affected Resource Type"
                                  },
                                  {
                                    "columnId": "Recommendation",
                                    "label": "Recommendation"
                                  },
                                  {
                                    "columnId": "Impact",
                                    "label": "Impact"
                                  },
                                  {
                                    "columnId": "resourceGroup",
                                    "label": "Resource Group"
                                  },
                                  {
                                    "columnId": "subscriptionId",
                                    "label": "Subscription ID"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "isVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "Get-AdvisorRecommendations-Storage"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": " resources\r\n    | where resourceGroup in ({ResourceGroup})\r\n    | where type has \"Microsoft.Storage\"\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend AffectedResource=id,ResourceRG=resourceGroup\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    | project id",
                              "size": 0,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "isVisible",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "query - tags - list all storageresources"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"e84cba0d-e501-4f55-a761-9126fb305030\",\"mergeType\":\"innerunique\",\"leftTable\":\"Get-AdvisorRecommendations-Storage\",\"rightTable\":\"query - tags - list all storageresources\",\"leftColumn\":\"AffectedResource\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[Get-AdvisorRecommendations-Storage].AffectedResource\",\"mergedName\":\"Affected Resource\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].Category\",\"mergedName\":\"Recommendation Category\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].SubCategory\",\"mergedName\":\"Affected Resource Type\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].Recommendation\",\"mergedName\":\"Recommendation\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].Impact\",\"mergedName\":\"Impact\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].resourceGroup\",\"mergedName\":\"Resource Group\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].subscriptionId\",\"mergedName\":\"Subscription ID\",\"fromId\":\"e84cba0d-e501-4f55-a761-9126fb305030\"},{\"originalName\":\"[query - tags - list all storageresources].id\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].excludeProperty\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].isActive1\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].AdditionaInfo\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].lowCpuThreshold\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].excludeRecomm\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].recommendationTypeId\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].maxCpuP95\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].stableId\"},{\"originalName\":\"[Get-AdvisorRecommendations-Storage].id\"}]}",
                              "size": 0,
                              "title": "Azure Advisor Cost recommendations",
                              "noDataMessage": "You are following all of our cost recommendations for Storage",
                              "noDataMessageStyle": 3,
                              "queryType": 7,
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Affected Resource Type",
                                    "formatter": 5
                                  },
                                  {
                                    "columnMatch": "Subscription ID",
                                    "formatter": 15,
                                    "formatOptions": {
                                      "linkTarget": null,
                                      "showIcon": true
                                    }
                                  }
                                ],
                                "rowLimit": 1000,
                                "filter": true,
                                "hierarchySettings": {
                                  "treeType": 1,
                                  "groupBy": [
                                    "Recommendation"
                                  ]
                                }
                              }
                            },
                            "showPin": false,
                            "name": "query - Merge - Storage Advisor recommendations"
                          }
                        ]
                      },
                      "conditionalVisibility": {
                        "parameterName": "SelectedSubTab",
                        "comparison": "isEqualTo",
                        "value": "advisorStorage"
                      },
                      "name": "AdvisorGroupStorage"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "SelectedTab",
                    "comparison": "isEqualTo",
                    "value": "UsageOptimization"
                  },
                  {
                    "parameterName": "SelectedRateOptimizationTab",
                    "comparison": "isEqualTo",
                    "value": "Storage"
                  }
                ],
                "name": "StorageGroup",
                "styleSettings": {
                  "showBorder": true
                }
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "template",
                  "loadFromTemplateId": "",
                  "items": [
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "94bd2bd0-5aa8-4df6-8cf7-603407f4e2d8",
                            "version": "KqlParameterItem/1.0",
                            "name": "Subscription",
                            "type": 6,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "includeAll": true,
                              "showDefault": false
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::all",
                            "label": " Subscription",
                            "value": []
                          },
                          {
                            "id": "faa42c49-ab77-42a1-9aaf-d8508b9408af",
                            "version": "KqlParameterItem/1.0",
                            "name": "ResourceGroup",
                            "label": "Resource Group",
                            "type": 2,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "query": "resources\r\n| distinct resourceGroup",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "showDefault": false
                            },
                            "defaultValue": "value::all",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources"
                          },
                          {
                            "id": "99a44dfa-30e2-4b2e-80a8-e05d2daab672",
                            "version": "KqlParameterItem/1.0",
                            "name": "SingleSubHidden",
                            "type": 1,
                            "isRequired": true,
                            "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Hidden Subscription"
                          },
                          {
                            "id": "a02c21a6-cd5e-4e02-bb87-00993a06d8e8",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagName",
                            "type": 2,
                            "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Name"
                          },
                          {
                            "id": "add52b5b-2e8d-45d3-a304-f6d8f4b205f7",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagValue",
                            "type": 2,
                            "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Value"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "75",
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "CostInformation"
                        },
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "Welcome"
                        }
                      ],
                      "name": "parameters - Filters"
                    },
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "1fc44b9a-2dd3-4b1f-bebd-b89d4ba6dfec",
                            "version": "KqlParameterItem/1.0",
                            "name": "Location",
                            "type": 2,
                            "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| project name, location\r\n| summarize count () by location\r\n| project location",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::1"
                              ]
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::1",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Resource Location"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "25",
                      "conditionalVisibility": {
                        "parameterName": "SelectedTab",
                        "comparison": "isEqualTo",
                        "value": "AHB"
                      },
                      "name": "parameters - location"
                    },
                    {
                      "type": 11,
                      "content": {
                        "version": "LinkItem/1.0",
                        "style": "tabs",
                        "links": [
                          {
                            "id": "0211f413-9f36-4750-9ef2-d382ba30ba6c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Virtual machines / VMSS",
                            "subTarget": "VM",
                            "preText": "VM",
                            "style": "link"
                          },
                          {
                            "id": "dbe9a7fb-6ab1-4de1-a98b-4ec8a9af906c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "AKS",
                            "subTarget": "AKS",
                            "style": "link"
                          },
                          {
                            "id": "79e7a97a-1413-41e8-b4c6-ebd1d0a45e2e",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "App Service",
                            "subTarget": "webapp",
                            "style": "link"
                          },
                          {
                            "id": "6d563f46-7150-458c-9ee4-0558abe8e29b",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Advisor recommendations",
                            "subTarget": "advisorCompute",
                            "style": "link"
                          }
                        ]
                      },
                      "name": "links - Compute"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Virtual Machines\r\n## Stopped virtual machines\r\nA virtual machine in a stopped state is still allocated the resources it was assigned, such as CPU and memory, but the VM itself is powered off. This allows for a quick startup when needed, but you are still billed for the allocated resources.",
                                    "style": "upsell"
                                  },
                                  "name": "text - StoppedVM"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM deallocated' and tostring(properties.extended.instanceView.powerState.displayStatus) != 'VM running'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend  PowerState=tostring(properties.extended.instanceView.powerState.displayStatus), VMLocation=location, resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| order by id asc\r\n| project id, PowerState, VMLocation, resourceGroup, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id\r\n    | project-away id1",
                                    "size": 0,
                                    "title": "Virtual Machines in a Stopped State",
                                    "noDataMessage": "You have no VMs in a stopped state",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "name": "Get-StoppedVM"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "## Deallocated virtual machines\r\nA virtual machine in a deallocated state is not only powered off, but the underlying host infrastructure is also released, resulting in no charges for the allocated resources while the VM is in this state. However, some Azure resources such as disks and networking continue to incur charges.",
                                    "style": "upsell"
                                  },
                                  "name": "text - DeallocatedVM"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachines' and tostring(properties.extended.instanceView.powerState.displayStatus) == 'VM deallocated'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend  PowerState=tostring(properties.extended.instanceView.powerState.displayStatus), VMLocation=location, resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| order by id asc\r\n| project id, PowerState, VMLocation, resourceGroup, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id\r\n    | project-away id1",
                                    "size": 0,
                                    "title": "Virtual Machines in a deallocated State",
                                    "noDataMessage": "You have no VMs in a deallocated state",
                                    "noDataMessageStyle": 3,
                                    "showRefreshButton": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        }
                                      ],
                                      "filter": true
                                    }
                                  },
                                  "name": "query - vmDeallocatedState"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Virtual Machine Scale Sets\r\n## Save with Azure Spot VMs on Virtual Machine Scale Sets\r\nUsing Azure Spot Virtual Machines on scale sets allows you to take advantage of our unused capacity at a significant cost savings. At any point in time when Azure needs the capacity back, the Azure infrastructure will evict Azure Spot Virtual Machine instances. Therefore, Azure Spot Virtual Machine instances are great for workloads that can handle interruptions like batch processing jobs, dev/test environments, large compute workloads, and more.\r\n\r\n## Spot Priority Mix\r\nAzure allows you to have the flexibility of running a mix of uninterruptible standard VMs and interruptible Spot VMs for Virtual Machine Scale Set deployments. You're able to deploy this Spot Priority Mix using Flexible orchestration to easily balance between high-capacity availability and lower infrastructure costs according to your workload requirements\r\n",
                                    "style": "upsell"
                                  },
                                  "name": "text - 8"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources \r\n| where type =~ 'microsoft.compute/virtualmachinescalesets'\r\n| where resourceGroup in ({ResourceGroup})\r\n| extend  SpotVMs=tostring(properties.virtualMachineProfile.priority), SpotPriorityMix=tostring(properties.priorityMixPolicy), SKU=tostring(sku.name), resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| project id, SKU, SpotVMs,SpotPriorityMix,subscriptionId,resourceGroup, location\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "SpotVMs",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "Spot",
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "warning",
                                                "text": "Not using Spot VMs"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "SpotPriorityMix",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "is Empty",
                                                "representation": "2",
                                                "text": "Not using Spot Priority Mix"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "resourceGroup",
                                          "formatter": 14,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "id1",
                                          "formatter": 5
                                        }
                                      ],
                                      "labelSettings": [
                                        {
                                          "columnId": "id",
                                          "label": "ID"
                                        },
                                        {
                                          "columnId": "SKU",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "SpotVMs",
                                          "label": "Spot VMs"
                                        },
                                        {
                                          "columnId": "SpotPriorityMix",
                                          "label": "Spot Priority Mix"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "location",
                                          "label": "Location"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "query - 9"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "VM"
                            },
                            "name": "VM/VMSSRecommendations"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Azure Kubernetes Service\r\n- Enable cluster autoscaler to automatically adjust the number of agent nodes in response to resource constraints\r\n\r\n- Consider using Azure Spot VMs for workloads that can handle interruptions, early terminations, or evictions. For example, workloads such as batch processing jobs, development and testing environments, and large compute workloads may be good candidates to be scheduled on a spot node pool.\r\n\r\n- Utilize the Horizontal pod autoscaler to adjust the number of pods in a deployment depending on CPU utilization or other select metrics.\r\n\r\n- Use the Start/Stop feature in Azure Kubernetes Services (AKS).\r\n\r\n",
                                    "style": "upsell"
                                  },
                                  "name": "Azure Kubernetes Service"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "\tresources\r\n    | where resourceGroup in ({ResourceGroup})\r\n\t| where type == \"microsoft.containerservice/managedclusters\"\r\n\t| extend  AKSname=name,location=location,Sku=tostring(sku.name),Tier=tostring(sku.tier),AgentPoolProfiles=properties.agentPoolProfiles\r\n    | project id,AKSname,resourceGroup,subscriptionId,Sku,Tier,AgentPoolProfiles,location\r\n    | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id\r\n\t| mvexpand AgentPoolProfiles\r\n\t| extend ProfileName = tostring(AgentPoolProfiles.name) ,mode=AgentPoolProfiles.mode,AutoScaleEnabled = AgentPoolProfiles.enableAutoScaling ,SpotVM=AgentPoolProfiles.scaleSetPriority,  VMSize=tostring(AgentPoolProfiles.vmSize),minCount=tostring(AgentPoolProfiles.minCount),maxCount=tostring(AgentPoolProfiles.maxCount) , nodeCount=tostring(AgentPoolProfiles.['count'])\r\n    | project id,ProfileName,Sku,Tier,mode,AutoScaleEnabled,SpotVM, VMSize,nodeCount,minCount,maxCount,location,resourceGroup,subscriptionId,AKSname\r\n    \r\n",
                                    "size": 0,
                                    "noDataMessage": "You have no AKS clusters!",
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "AKS Name",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "id",
                                          "formatter": 13,
                                          "formatOptions": {
                                            "linkTarget": "Resource",
                                            "subTarget": "Insights",
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "mode",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "System",
                                                "representation": "Gear",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "==",
                                                "thresholdValue": "User",
                                                "representation": "Person",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "AutoScaleEnabled",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "true",
                                                "representation": "success",
                                                "text": "Enabled"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "disabled",
                                                "text": "Disabled"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "SpotVM",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "is Empty",
                                                "representation": "2",
                                                "text": "{0}{1}Not Spot VM"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "AKSname",
                                          "formatter": 5
                                        }
                                      ],
                                      "filter": true,
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "AKSname"
                                        ],
                                        "expandTopLevel": true
                                      },
                                      "labelSettings": [
                                        {
                                          "columnId": "id",
                                          "label": "ID"
                                        },
                                        {
                                          "columnId": "ProfileName",
                                          "label": "Profile Name"
                                        },
                                        {
                                          "columnId": "Sku",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "Tier",
                                          "label": "SKU Tier"
                                        },
                                        {
                                          "columnId": "mode",
                                          "label": "Mode"
                                        },
                                        {
                                          "columnId": "AutoScaleEnabled",
                                          "label": "Autoscale enabled?"
                                        },
                                        {
                                          "columnId": "SpotVM",
                                          "label": "Spot VM?"
                                        },
                                        {
                                          "columnId": "VMSize",
                                          "label": "VM SKU"
                                        },
                                        {
                                          "columnId": "nodeCount",
                                          "label": "Number of nodes"
                                        },
                                        {
                                          "columnId": "minCount",
                                          "label": "Minimum nodes"
                                        },
                                        {
                                          "columnId": "maxCount",
                                          "label": "Maximum nodes"
                                        },
                                        {
                                          "columnId": "location",
                                          "label": "Location"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "AKSname",
                                          "label": "AKS Name"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "Get-All-AKS"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "AKS"
                            },
                            "name": "AKSGroup"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# Azure App Service\r\n## Save with Premium v3 reserved instances\r\nWhen you commit to an Azure App Service Premium v3 reserved instance you can save money. The reservation discount is applied automatically to the number of running instances that match the reservation scope and attributes - you don't need to assign a reservation to a specific instance to get the discounts.\r\n\r\n## Determine the right reserved instance size before you buy\r\nBefore you buy a reservation, you should determine the size of the Premium v3 reserved instance that you need. The following sections will help you determine the right Premium v3 reserved instance size.\r\n\r\n## Use Autoscale appropriately\r\nAutoscale can be used to provision resources for when they're needed or on demand, which allows you to minimize costs when your environment is idle.\r\n",
                                    "style": "upsell"
                                  },
                                  "name": "Azure App Service"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources\r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'Microsoft.Web/sites'\r\n| extend WebAppRG=resourceGroup, WebAppName=name, AppServicePlan=tostring(properties.serverFarmId), SKU=tostring(properties.sku), Type=kind, Status=tostring(properties.state), WebAppLocation=location, SubscriptionName=subscriptionId\r\n| project id,WebAppName, Type, Status, WebAppLocation, AppServicePlan, WebAppRG,SubscriptionName\r\n| order by id asc\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    )\r\n    on id",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "isVisible",
                                    "comparison": "isEqualTo",
                                    "value": "Never"
                                  },
                                  "name": "query - WebFunctionStatus"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resources\r\n| where resourceGroup in ({ResourceGroup})\r\n| where type == \"microsoft.web/serverfarms\"\r\n| extend  planId=tolower(tostring(id)),skuname = tostring(sku.name) , skutier = tostring(sku.tier), workers=tostring(properties.numberOfWorkers),webRG=resourceGroup,maxworkers=tostring(properties.maximumNumberOfWorkers), SubscriptionName=subscriptionId\r\n| project planId, name, skuname, skutier, workers, maxworkers, webRG, SubscriptionName\r\n| join kind=leftouter (resources | where type ==\"microsoft.insights/autoscalesettings\" | project planId=tolower(tostring(properties.targetResourceUri)), PredictiveAutoscale=properties.predictiveAutoscalePolicy.scaleMode, AutoScaleProfiles=properties.profiles,resourceGroup) on planId",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "isVisible",
                                    "comparison": "isEqualTo",
                                    "value": "Never"
                                  },
                                  "name": "query - AppServiceplandetails"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\",\"mergeType\":\"inner\",\"leftTable\":\"query - AppServiceplandetails\",\"rightTable\":\"query - WebFunctionStatus\",\"leftColumn\":\"planId\",\"rightColumn\":\"AppServicePlan\"}],\"projectRename\":[{\"originalName\":\"[query - AppServiceplandetails].type\",\"mergedName\":\"type\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].tenantId\",\"mergedName\":\"tenantId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].kind\",\"mergedName\":\"kind\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].location\",\"mergedName\":\"location\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].managedBy\",\"mergedName\":\"managedBy\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].sku\",\"mergedName\":\"sku\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].plan\",\"mergedName\":\"plan\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].properties\",\"mergedName\":\"properties\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].tags\",\"mergedName\":\"tags\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].identity\",\"mergedName\":\"identity\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].zones\",\"mergedName\":\"zones\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].extendedLocation\",\"mergedName\":\"extendedLocation\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].planId\",\"mergedName\":\"planId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - WebFunctionStatus].id\",\"mergedName\":\"id\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].name\",\"mergedName\":\"name\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].Status\",\"mergedName\":\"Status\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].Type\",\"mergedName\":\"Type\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].skuname\",\"mergedName\":\"skuname\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].skutier\",\"mergedName\":\"skutier\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].PredictiveAutoscale\",\"mergedName\":\"PredictiveAutoscale\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].AutoScaleProfiles\",\"mergedName\":\"AutoScaleProfiles\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - AppServiceplandetails].workers\",\"mergedName\":\"workers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].maxworkers\",\"mergedName\":\"maxworkers\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].webRG\",\"mergedName\":\"webRG\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].planId1\",\"mergedName\":\"planId1\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - AppServiceplandetails].resourceGroup\",\"mergedName\":\"resourceGroup\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppName\",\"mergedName\":\"WebAppName\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppLocation\",\"mergedName\":\"WebAppLocation\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].AppServicePlan\",\"mergedName\":\"AppServicePlan\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].WebAppRG\",\"mergedName\":\"WebAppRG\",\"fromId\":\"3fddbdd9-c4eb-46ae-b6b0-654c0da7b1a8\"},{\"originalName\":\"[query - WebFunctionStatus].SubscriptionName\"},{\"originalName\":\"[query - WebFunctionStatus].id1\"},{\"originalName\":\"[query - AppServiceplandetails].resourceGroup1\"}]}",
                                    "size": 0,
                                    "title": "Web Apps",
                                    "noDataMessage": "You have no WebApps!",
                                    "showExportToExcel": true,
                                    "queryType": 7,
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Name",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "SubscriptionName",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "name",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "Status",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "Running",
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "==",
                                                "thresholdValue": "Stopped",
                                                "representation": "disabled",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "success",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          }
                                        },
                                        {
                                          "columnMatch": "webRG",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "planId1",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "resourceGroup",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "WebAppName",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "AppServicePlan",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "WebAppRG",
                                          "formatter": 14,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 1
                                        }
                                      ],
                                      "rowLimit": 1000,
                                      "filter": true,
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "name"
                                        ],
                                        "expandTopLevel": true
                                      },
                                      "labelSettings": [
                                        {
                                          "columnId": "SubscriptionName",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "planId",
                                          "label": "Plan ID"
                                        },
                                        {
                                          "columnId": "id",
                                          "label": "ID"
                                        },
                                        {
                                          "columnId": "name",
                                          "label": "Name"
                                        },
                                        {
                                          "columnId": "skuname",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "skutier",
                                          "label": "SKU Tier"
                                        },
                                        {
                                          "columnId": "PredictiveAutoscale",
                                          "label": "Autoscale Enabled?"
                                        },
                                        {
                                          "columnId": "AutoScaleProfiles",
                                          "label": "Autoscale Profile"
                                        },
                                        {
                                          "columnId": "workers",
                                          "label": "Workers"
                                        },
                                        {
                                          "columnId": "maxworkers",
                                          "label": "Max. Workers"
                                        },
                                        {
                                          "columnId": "webRG",
                                          "label": "Application Resource Group"
                                        },
                                        {
                                          "columnId": "WebAppName",
                                          "label": "Application Name"
                                        },
                                        {
                                          "columnId": "WebAppLocation",
                                          "label": "Application Location"
                                        },
                                        {
                                          "columnId": "AppServicePlan",
                                          "label": "App Service Plan"
                                        },
                                        {
                                          "columnId": "WebAppRG",
                                          "label": "Application Resource Group"
                                        }
                                      ]
                                    }
                                  },
                                  "name": "Get-Idle-WebApp"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "webapp"
                            },
                            "name": "WebAppGroup"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "advisorresources\r\n| where type =~ 'microsoft.advisor/recommendations'\r\n| where resourceGroup in ({ResourceGroup})\r\n| where properties.category == 'Cost' and properties.lastUpdated >= ago(1d)\r\n| extend AffectedResource=tostring(properties.resourceMetadata.resourceId), Category=tostring(properties.category), SubCategory=tostring(properties.impactedField), Impact=tostring(properties.impact),subscriptionId,Recommendation=tostring(properties.shortDescription.problem), id, stableId = name, recommendationTypeId = tostring(properties.recommendationTypeId), maxCpuP95 = properties.extendedProperties.MaxCpuP95,resourceGroup=strcat('/subscriptions/',subscriptionId,'/resourceGroups/',resourceGroup)\r\n| join kind = leftouter\r\n(advisorresources | where type=~'microsoft.advisor/suppressions'\r\n| extend tokens = split(id, '/')\r\n| extend stableId = iff(array_length(tokens) > 3, tokens[(array_length(tokens)-3)], '')\r\n| extend expirationTimeStamp = todatetime(iff(strcmp(tostring(properties.ttl), '-1') == 0, '9999-12-31', properties.expirationTimeStamp))\r\n| where expirationTimeStamp > now()\r\n| project stableId, expirationTimeStamp)\r\non stableId\r\n| where isempty(expirationTimeStamp)\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId), Category=tostring(properties.category), SubCategory=tostring(properties.impactedField), Recommendation=tostring(properties.shortDescription.problem), Impact=tostring(properties.impact),resourceGroup,subscriptionId, id, stableId = name, recommendationTypeId = tostring(properties.recommendationTypeId), maxCpuP95 = properties.extendedProperties.MaxCpuP95\r\n| join kind = leftouter\r\n(advisorresources | where type =~ 'microsoft.advisor/configurations' | where isempty(resourceGroup) == true\r\n| project subscriptionId, excludeRecomm = properties.exclude, lowCpuThreshold = properties.lowCpuThreshold, AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=tostring(properties.impact),resourceGroup,AdditionaInfo=properties.extendedProperties,Recommendation=tostring(properties.shortDescription.problem))\r\non subscriptionId\r\n| extend isActive1 = iff(isnull(excludeRecomm), true, tobool(excludeRecomm) == false)\r\n| extend isActive2 = iff(recommendationTypeId == 'e10b1381-5f0a-47ff-8c7b-37bd13d7c974', iff((isnotempty(lowCpuThreshold) and isnotempty(maxCpuP95)), toint(maxCpuP95) < toint(lowCpuThreshold), iff((isempty(maxCpuP95) or toint(maxCpuP95) < 5), true, false)), true)\r\n| where isActive1 == true and isActive2 == true\r\n| join kind = leftouter\r\n(advisorresources | where type =~ 'microsoft.advisor/configurations' | where isnotempty(resourceGroup) == true\r\n| project subscriptionId, resourceGroup, excludeProperty = properties.exclude)\r\non subscriptionId, resourceGroup\r\n| extend isActive3 = iff(isnull(excludeProperty), true, tobool(excludeProperty) == false)\r\n| where isActive3 == true\r\n| where Category == 'Cost' \r\n| where SubCategory has \"Microsoft.Compute\" or SubCategory has \"Container\" or SubCategory has \"Web\"\r\n| where SubCategory !has \"Microsoft.Compute/disks\"\r\n| project-away subscriptionId1, subscriptionId2, AffectedResource1, isActive2, isActive3, Impact1, Recommendation1, resourceGroup1, resourceGroup2",
                                    "size": 0,
                                    "title": "Azure Advisor Cost recommendations",
                                    "noDataMessage": "You are following all of our cost recommendations for Compute",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "id",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "stableId",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "recommendationTypeId",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "maxCpuP95",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "excludeRecomm",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "lowCpuThreshold",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "AdditionaInfo",
                                          "formatter": 5,
                                          "formatOptions": {
                                            "customColumnWidthSetting": "19ch"
                                          }
                                        },
                                        {
                                          "columnMatch": "isActive1",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "excludeProperty",
                                          "formatter": 5
                                        }
                                      ],
                                      "rowLimit": 1000,
                                      "filter": true,
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "Recommendation"
                                        ],
                                        "expandTopLevel": true
                                      },
                                      "labelSettings": [
                                        {
                                          "columnId": "AffectedResource",
                                          "label": "Affected Resource"
                                        },
                                        {
                                          "columnId": "Category",
                                          "label": "Recommendation Category"
                                        },
                                        {
                                          "columnId": "SubCategory",
                                          "label": "Affected Resource Type"
                                        },
                                        {
                                          "columnId": "Recommendation",
                                          "label": "Recommendation"
                                        },
                                        {
                                          "columnId": "Impact",
                                          "label": "Impact"
                                        },
                                        {
                                          "columnId": "resourceGroup",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription ID"
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "IsVisible",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "Get-AdvisorRecommendations-Compute"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": " resources\r\n    | where resourceGroup in ({ResourceGroup})\r\n    | where (type has \"Microsoft.Compute\" or type has \"Microsoft.ContainerService\" or type has \"serverfarms\") and type !has \"Disks\"\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend AffectedResource=id,ResourceRG=resourceGroup\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}'])\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct id\r\n    | project id",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "isVisible",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "query - tags - list all compute resources"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d446799d-b1af-4bca-9d72-84ba2d870039\",\"mergeType\":\"innerunique\",\"leftTable\":\"Get-AdvisorRecommendations-Compute\",\"rightTable\":\"query - tags - list all compute resources\",\"leftColumn\":\"AffectedResource\",\"rightColumn\":\"id\"}],\"projectRename\":[{\"originalName\":\"[Get-AdvisorRecommendations-Compute].AffectedResource\",\"mergedName\":\"Affected Resource\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].Category\",\"mergedName\":\"Recommendation Category\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].SubCategory\",\"mergedName\":\"Affected Resource Type\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].Recommendation\",\"mergedName\":\"Recommendation\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].Impact\",\"mergedName\":\"Impact\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].resourceGroup\",\"mergedName\":\"Resource Group\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].subscriptionId\",\"mergedName\":\"Subscription ID\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].id\",\"mergedName\":\"id\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].stableId\",\"mergedName\":\"stableId\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].recommendationTypeId\",\"mergedName\":\"recommendationTypeId\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].maxCpuP95\",\"mergedName\":\"maxCpuP95\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].excludeRecomm\",\"mergedName\":\"excludeRecomm\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].lowCpuThreshold\",\"mergedName\":\"lowCpuThreshold\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].AdditionaInfo\",\"mergedName\":\"AdditionaInfo\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].isActive1\",\"mergedName\":\"isActive1\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].excludeProperty\",\"mergedName\":\"excludeProperty\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[query - tags - list all compute resources].id\",\"mergedName\":\"id1\",\"fromId\":\"d446799d-b1af-4bca-9d72-84ba2d870039\"},{\"originalName\":\"[Get-AdvisorRecommendations-Compute].location\",\"mergedName\":\"location\",\"fromId\":\"unknown\"}]}",
                                    "size": 0,
                                    "title": "Azure Advisor Cost recommendations",
                                    "noDataMessage": "You are following all of our cost recommendations for Compute",
                                    "noDataMessageStyle": 3,
                                    "queryType": 7,
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 1
                                        },
                                        {
                                          "columnMatch": "Affected Resource Type",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "Resource Group",
                                          "formatter": 14,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Subscription ID",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "id",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "stableId",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "recommendationTypeId",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "maxCpuP95",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "excludeRecomm",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "lowCpuThreshold",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "AdditionaInfo",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "isActive1",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "excludeProperty",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "id1",
                                          "formatter": 5
                                        }
                                      ],
                                      "rowLimit": 1000,
                                      "filter": true,
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "Recommendation"
                                        ]
                                      }
                                    }
                                  },
                                  "showPin": false,
                                  "name": "query - Merge - Compute Advisor recommendations"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "advisorCompute"
                            },
                            "name": "AdvisorGroup"
                          }
                        ]
                      },
                      "name": "Compute - Subscription"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "SelectedTab",
                    "comparison": "isEqualTo",
                    "value": "UsageOptimization"
                  },
                  {
                    "parameterName": "SelectedRateOptimizationTab",
                    "comparison": "isEqualTo",
                    "value": "Compute"
                  }
                ],
                "name": "ComputeGroup",
                "styleSettings": {
                  "showBorder": true
                }
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedTab",
            "comparison": "isEqualTo",
            "value": "UsageOptimization"
          },
          "name": "group - usage optimization"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 11,
                "content": {
                  "version": "LinkItem/1.0",
                  "style": "tabs",
                  "links": [
                    {
                      "id": "792df0b2-35da-403d-999d-ff81ea8d4f56",
                      "cellValue": "selectedRateOptimizationTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Azure Hybrid Benefit",
                      "subTarget": "AHB",
                      "style": "link"
                    },
                    {
                      "id": "56eb4166-cb7c-4384-94a9-c5f201e1316d",
                      "cellValue": "selectedRateOptimizationTab",
                      "linkTarget": "parameter",
                      "linkLabel": "Azure Reservations",
                      "subTarget": "Reservations",
                      "style": "link"
                    }
                  ]
                },
                "conditionalVisibility": {
                  "parameterName": "SelectedTab",
                  "comparison": "isEqualTo",
                  "value": "RateOptimization"
                },
                "name": "links - rate optimization tabs"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "template",
                  "loadFromTemplateId": "",
                  "items": [
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "parameters": [
                          {
                            "id": "a1960768-9da4-455d-b6f6-6d43098cff76",
                            "version": "KqlParameterItem/1.0",
                            "name": "Subscription",
                            "type": 6,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "includeAll": true,
                              "showDefault": false
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::all",
                            "label": " Subscription",
                            "value": [
                              "value::all"
                            ]
                          },
                          {
                            "id": "95a2af0b-44ca-4039-bcdf-801a504b79ff",
                            "version": "KqlParameterItem/1.0",
                            "name": "ResourceGroup",
                            "label": "Resource Group",
                            "type": 2,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "query": "resources\r\n| distinct resourceGroup",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "showDefault": false
                            },
                            "defaultValue": "value::all",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources"
                          },
                          {
                            "id": "04213739-ee76-42fe-b21b-191badd75fad",
                            "version": "KqlParameterItem/1.0",
                            "name": "SingleSubHidden",
                            "type": 1,
                            "isRequired": true,
                            "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Hidden Subscription"
                          },
                          {
                            "id": "99946c81-7db9-4895-9a6b-8430e0158189",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagName",
                            "type": 2,
                            "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Name"
                          },
                          {
                            "id": "941869eb-ac2d-4b9a-9d04-94921334668b",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagValue",
                            "type": 2,
                            "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Value"
                          }
                        ],
                        "style": "pills",
                        "queryType": 0,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "75",
                      "name": "parameters - Filters"
                    },
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "2b8ca845-75ba-4f4b-acad-54ee50d66d54",
                            "version": "KqlParameterItem/1.0",
                            "name": "LookBackPeriod",
                            "label": "Look back period",
                            "type": 2,
                            "isRequired": true,
                            "typeSettings": {
                              "additionalResourceOptions": [],
                              "showDefault": false
                            },
                            "jsonData": "[[\r\n    {\"value\": \"Last 7 days\"},\r\n    {\"value\": \"Last 30 days\"},\r\n    {\"value\": \"Last 60 days\"}\r\n]",
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "value": "Last 30 days"
                          },
                          {
                            "id": "953c9e4c-af03-4fb7-bf30-3f1bfdf09199",
                            "version": "KqlParameterItem/1.0",
                            "name": "term",
                            "label": "Term",
                            "type": 2,
                            "isRequired": true,
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "jsonData": "[[\r\n    {\r\n        \"value\": \"P1Y\",\r\n        \"Selected\": \"true\"\r\n    },\r\n    {\r\n        \"value\": \"P3Y\"\r\n    }\r\n]",
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "value": "P3Y"
                          },
                          {
                            "id": "c46193fe-f1b2-49d1-a9bc-c9f5149f0194",
                            "version": "KqlParameterItem/1.0",
                            "name": "resourceType",
                            "label": "Resource type",
                            "type": 2,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "query": "AdvisorResources \r\n| where type == 'microsoft.advisor/recommendations' \r\n| where properties.category == 'Cost' and properties.shortDescription.solution contains \"Reserved Instance\"\r\n| extend reservedResourceType=tostring(properties.extendedProperties.reservedResourceType)\r\n| distinct reservedResourceType",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "showDefault": false
                            },
                            "defaultValue": "value::all",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": [
                              "value::all"
                            ]
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "name": "parameters - reservationsParams"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AdvisorResources \r\n| where type == 'microsoft.advisor/recommendations' \r\n| where properties.category == 'Cost' and properties.shortDescription.solution contains \"Reserved Instance\"\r\n| extend reservedResourceType=tostring(properties.extendedProperties.reservedResourceType),\r\nlookbackPeriod=tostring(strcat(\"Last \",properties.extendedProperties.lookbackPeriod,\" days\")),\r\nscope=tostring(properties.extendedProperties.scope),\r\nterm=tostring(properties.extendedProperties.term),\r\nresources=tostring(properties.resourceMetadata.resourceId),  \r\nsavings=todouble(properties.extendedProperties.annualSavingsAmount),  \r\nRecommendation=tostring(properties.shortDescription.solution),  \r\ncurrency = tostring(properties.extendedProperties.savingsCurrency)\r\n| where term == \"{term}\" and lookbackPeriod == \"{LookBackPeriod}\" and reservedResourceType in ({resourceType})\r\n| summarize Subscriptions=dcount(resources),  \r\n  bin (sum(savings), 0.01) by Recommendation ,reservedResourceType ,lookbackPeriod,scope,term ,currency\r\n| order by sum_savings desc\r\n",
                        "size": 0,
                        "title": "Reservations Summary",
                        "noDataMessage": "No reservations recommendations found!",
                        "noDataMessageStyle": 3,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "visualization": "categoricalbar",
                        "gridSettings": {
                          "filter": true,
                          "labelSettings": [
                            {
                              "columnId": "reservedResourceType",
                              "label": "Resource type"
                            },
                            {
                              "columnId": "lookbackPeriod",
                              "label": "Look back period"
                            },
                            {
                              "columnId": "scope",
                              "label": "Scope"
                            },
                            {
                              "columnId": "term",
                              "label": "Term"
                            },
                            {
                              "columnId": "currency",
                              "label": "Currency"
                            },
                            {
                              "columnId": "sum_savings",
                              "label": "Total annual savings"
                            }
                          ]
                        },
                        "chartSettings": {
                          "xAxis": "reservedResourceType",
                          "yAxis": [
                            "sum_savings"
                          ],
                          "group": "reservedResourceType",
                          "createOtherGroup": 0,
                          "showLegend": true,
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 0,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "name": "query - Reservations Summary"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "AdvisorResources \r\n| where type == 'microsoft.advisor/recommendations' \r\n| where properties.category == 'Cost' and properties.shortDescription.solution contains \"Reserved Instance\"\r\n| extend reservedResourceType=tostring(properties.extendedProperties.reservedResourceType),\r\nlookbackPeriod=tostring(strcat(\"Last \",properties.extendedProperties.lookbackPeriod,\" days\")),\r\nscope=tostring(properties.extendedProperties.scope),\r\nterm=tostring(properties.extendedProperties.term),\r\nsavings=todouble(properties.extendedProperties.annualSavingsAmount),\r\nsavingsAmount = todouble(properties.extendedProperties.savingsAmount),\r\nRecommendation=tostring(properties.shortDescription.solution),  \r\ncurrency = tostring(properties.extendedProperties.savingsCurrency),\r\ndisplayQty = tostring(properties.extendedProperties.displayQty),\r\ndisplaySKU = tostring(properties.extendedProperties.displaySKU),\r\nregion = tostring(properties.extendedProperties.region),\r\nsubscription = tostring(properties.extendedProperties.subId)\r\n| where term == \"{term}\" and lookbackPeriod == \"{LookBackPeriod}\" and reservedResourceType in ({resourceType})\r\n| project Recommendation,reservedResourceType,displaySKU,displayQty,savings,currency,lookbackPeriod,term,region,subscription\r\n| order by savings desc\r\n",
                        "size": 0,
                        "title": "Reservations details",
                        "noDataMessage": "No reservations recommendations found!",
                        "noDataMessageStyle": 3,
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "gridSettings": {
                          "formatters": [
                            {
                              "columnMatch": "$gen_group",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            },
                            {
                              "columnMatch": "Recommendation",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "reservedResourceType",
                              "formatter": 5
                            },
                            {
                              "columnMatch": "subscription",
                              "formatter": 15,
                              "formatOptions": {
                                "linkTarget": null,
                                "showIcon": true
                              }
                            }
                          ],
                          "filter": true,
                          "hierarchySettings": {
                            "treeType": 1,
                            "groupBy": [
                              "subscription",
                              "reservedResourceType"
                            ],
                            "expandTopLevel": false
                          },
                          "labelSettings": [
                            {
                              "columnId": "displaySKU",
                              "label": "SKU"
                            },
                            {
                              "columnId": "displayQty",
                              "label": "Quantity"
                            },
                            {
                              "columnId": "savings",
                              "label": "Total annual savings"
                            },
                            {
                              "columnId": "currency",
                              "label": "Currency"
                            },
                            {
                              "columnId": "lookbackPeriod",
                              "label": "Look back period"
                            },
                            {
                              "columnId": "term",
                              "label": "Term"
                            },
                            {
                              "columnId": "region",
                              "label": "Region"
                            },
                            {
                              "columnId": "subscription",
                              "label": "Subscription"
                            }
                          ]
                        },
                        "chartSettings": {
                          "xAxis": "reservedResourceType",
                          "yAxis": [
                            "sum_savings"
                          ],
                          "group": "reservedResourceType",
                          "createOtherGroup": 0,
                          "showLegend": true,
                          "ySettings": {
                            "numberFormatSettings": {
                              "unit": 0,
                              "options": {
                                "style": "decimal",
                                "useGrouping": true
                              }
                            }
                          }
                        }
                      },
                      "name": "query - Reservations details"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "SelectedTab",
                    "comparison": "isEqualTo",
                    "value": "RateOptimization"
                  },
                  {
                    "parameterName": "selectedRateOptimizationTab",
                    "comparison": "isEqualTo",
                    "value": "Reservations"
                  }
                ],
                "name": "group - Reservations"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "parameters": [
                    {
                      "id": "2b43eb64-bca3-444a-8003-003554236fe7",
                      "version": "KqlParameterItem/1.0",
                      "name": "Subscription",
                      "type": 6,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "includeAll": true,
                        "showDefault": false
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "defaultValue": "value::all",
                      "label": " Subscription",
                      "value": [
                        "value::all"
                      ]
                    },
                    {
                      "id": "03fbf28a-892d-4b68-929c-3ba5056f4b94",
                      "version": "KqlParameterItem/1.0",
                      "name": "ResourceGroup",
                      "label": "Resource Group",
                      "type": 2,
                      "isRequired": true,
                      "multiSelect": true,
                      "quote": "'",
                      "delimiter": ",",
                      "query": "resources\r\n| distinct resourceGroup",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::all"
                        ],
                        "showDefault": false
                      },
                      "defaultValue": "value::all",
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources"
                    },
                    {
                      "id": "566c43ae-f300-43be-aa0d-61d92ba8da87",
                      "version": "KqlParameterItem/1.0",
                      "name": "SingleSubHidden",
                      "type": 1,
                      "isRequired": true,
                      "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "isHiddenWhenLocked": true,
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "label": "Hidden Subscription"
                    },
                    {
                      "id": "a9df02ed-7100-4130-952f-a3d9d5d364af",
                      "version": "KqlParameterItem/1.0",
                      "name": "TagName",
                      "type": 2,
                      "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": []
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": null,
                      "label": "Tag Name"
                    },
                    {
                      "id": "66406915-1f07-448f-8170-2f3b0dc6dc00",
                      "version": "KqlParameterItem/1.0",
                      "name": "TagValue",
                      "type": 2,
                      "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": []
                      },
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "value": null,
                      "label": "Tag Value"
                    }
                  ],
                  "style": "pills",
                  "queryType": 0,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "customWidth": "75",
                "conditionalVisibility": {
                  "parameterName": "selectedRateOptimizationTab",
                  "comparison": "isEqualTo",
                  "value": "AHB"
                },
                "name": "parameters - Filters"
              },
              {
                "type": 9,
                "content": {
                  "version": "KqlParameterItem/1.0",
                  "crossComponentResources": [
                    "{Subscription}"
                  ],
                  "parameters": [
                    {
                      "id": "f74bc7f5-2b16-4440-8053-106e040b73b6",
                      "version": "KqlParameterItem/1.0",
                      "name": "Location",
                      "type": 2,
                      "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| project name, location\r\n| summarize count () by location\r\n| project location",
                      "crossComponentResources": [
                        "{Subscription}"
                      ],
                      "typeSettings": {
                        "additionalResourceOptions": [
                          "value::1"
                        ]
                      },
                      "timeContext": {
                        "durationMs": 86400000
                      },
                      "defaultValue": "value::1",
                      "queryType": 1,
                      "resourceType": "microsoft.resourcegraph/resources",
                      "label": "Resource Location",
                      "value": "eastus"
                    }
                  ],
                  "style": "pills",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources"
                },
                "customWidth": "25",
                "conditionalVisibility": {
                  "parameterName": "selectedRateOptimizationTab",
                  "comparison": "isEqualTo",
                  "value": "AHB"
                },
                "name": "parameters - location"
              },
              {
                "type": 12,
                "content": {
                  "version": "NotebookGroup/1.0",
                  "groupType": "template",
                  "loadType": "always",
                  "loadFromTemplateId": "",
                  "items": [
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "6e6af20c-1707-4d9d-ab5f-96b927573b84",
                            "version": "KqlParameterItem/1.0",
                            "name": "Subscription",
                            "type": 6,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "includeAll": true,
                              "showDefault": false
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::all",
                            "label": " Subscription"
                          },
                          {
                            "id": "1867f91d-213c-440d-b0bb-1a699355cccf",
                            "version": "KqlParameterItem/1.0",
                            "name": "ResourceGroup",
                            "label": "Resource Group",
                            "type": 2,
                            "isRequired": true,
                            "multiSelect": true,
                            "quote": "'",
                            "delimiter": ",",
                            "query": "resources\r\n| distinct resourceGroup",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::all"
                              ],
                              "showDefault": false
                            },
                            "defaultValue": "value::all",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources"
                          },
                          {
                            "id": "e18f436b-7b39-4e6d-80e7-ba71261e3527",
                            "version": "KqlParameterItem/1.0",
                            "name": "SingleSubHidden",
                            "type": 1,
                            "isRequired": true,
                            "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Hidden Subscription"
                          },
                          {
                            "id": "87cd37f1-acc4-4fee-b8cb-e9cdc6d3533d",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagName",
                            "type": 2,
                            "query": "Resources\r\n| where tags != '' and tags != '[]'\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| distinct tagName\r\n| sort by tagName asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Name"
                          },
                          {
                            "id": "ebf9cda9-0563-4b17-a62f-cfef6efddeb6",
                            "version": "KqlParameterItem/1.0",
                            "name": "TagValue",
                            "type": 2,
                            "query": "Resources\r\n| mvexpand tags\r\n| extend tagName = tostring(bag_keys(tags)[0])\r\n| extend tagValue = tostring(tags[tagName])\r\n| where tags != '' and tags != '[]' and tostring(bag_keys(tags)[0]) == '{TagName}'\r\n| distinct tagValue\r\n| sort by tagValue asc",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": []
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "value": null,
                            "label": "Tag Value"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "75",
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "CostInformation"
                        },
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isNotEqualTo",
                          "value": "Welcome"
                        }
                      ],
                      "name": "parameters - Filters"
                    },
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "a4729a20-16ab-44e8-b038-c4b42e94148e",
                            "version": "KqlParameterItem/1.0",
                            "name": "Location",
                            "type": 2,
                            "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| project name, location\r\n| summarize count () by location\r\n| project location",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "typeSettings": {
                              "additionalResourceOptions": [
                                "value::1"
                              ]
                            },
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "defaultValue": "value::1",
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Resource Location"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "customWidth": "25",
                      "conditionalVisibility": {
                        "parameterName": "SelectedTab",
                        "comparison": "isEqualTo",
                        "value": "AHB"
                      },
                      "name": "parameters - location"
                    },
                    {
                      "type": 1,
                      "content": {
                        "json": "# Azure Hybrid Benefit\r\nFor customers with Software Assurance, Azure Hybrid Benefit for Windows Server allows you to use your on-premises Windows Server licenses to run Windows virtual machines on Azure at a reduced cost. This article discusses how to deploy new VMs with Azure Hybrid Benefit for Windows Server enabled, and how you can update any existing running VMs. For more information about Azure Hybrid Benefit for Windows Server licensing and cost savings, see the [Azure Hybrid Benefit for Windows Server licensing page](https://azure.microsoft.com/pricing/hybrid-use-benefit/)\r\n\r\n",
                        "style": "upsell"
                      },
                      "name": "Azure Hybrid Benefit"
                    },
                    {
                      "type": 9,
                      "content": {
                        "version": "KqlParameterItem/1.0",
                        "crossComponentResources": [
                          "{Subscription}"
                        ],
                        "parameters": [
                          {
                            "id": "0c58188b-5c09-45aa-b738-f7122d0e0a19",
                            "version": "KqlParameterItem/1.0",
                            "name": "Location",
                            "label": "SKU Location",
                            "type": 1,
                            "description": "Select the region where the VMs are located. Different Regions might have different SKUs",
                            "isRequired": true,
                            "query": "Resources\r\n| where type =~ 'Microsoft.Compute/virtualMachines'\r\n| project location\r\n| take 1\r\n\r\n",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources"
                          },
                          {
                            "id": "3ee18b0f-2f7b-4a6a-9d1c-526505c7eea2",
                            "version": "KqlParameterItem/1.0",
                            "name": "SingleSubHidden",
                            "type": 1,
                            "isRequired": true,
                            "query": "resourcecontainers\r\n| where type==\"microsoft.resources/subscriptions\"\r\n| take 1\r\n| project subscriptionId",
                            "crossComponentResources": [
                              "{Subscription}"
                            ],
                            "isHiddenWhenLocked": true,
                            "timeContext": {
                              "durationMs": 86400000
                            },
                            "queryType": 1,
                            "resourceType": "microsoft.resourcegraph/resources",
                            "label": "Hidden Subscription"
                          }
                        ],
                        "style": "pills",
                        "queryType": 1,
                        "resourceType": "microsoft.resourcegraph/resources"
                      },
                      "name": "SubscriptionPicker"
                    },
                    {
                      "type": 3,
                      "content": {
                        "version": "KqlItem/1.0",
                        "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{SingleSubHidden}/providers/Microsoft.Compute/skus?$filter=location eq '{Location}'\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-07-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.*[?(@.resourceType=='virtualMachines')]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"capabilities[?(@.name=='vCPUs')].value\",\"columnid\":\"vCPUs\"},{\"path\":\"capabilities[?(@.name=='MemoryGB')].value\",\"columnid\":\"MemoryGB\"},{\"path\":\"capabilities[?(@.name=='MaxNetworkInterfaces')].value\",\"columnid\":\"MaxNetworkInterfaces\"},{\"path\":\"capabilities[?(@.name=='HyperVGenerations')].value\",\"columnid\":\"HyperVGenerations\"},{\"path\":\"capabilities[?(@.name=='vCPUsPerCore')].value\",\"columnid\":\"vCPUsPerCore\"}]}}]}",
                        "size": 0,
                        "title": "Get VM vCPU",
                        "exportParameterName": "ResourceSKU",
                        "showExportToExcel": true,
                        "queryType": 12,
                        "gridSettings": {
                          "rowLimit": 5000
                        }
                      },
                      "conditionalVisibility": {
                        "parameterName": "AlwaysHidden",
                        "comparison": "isEqualTo",
                        "value": "true"
                      },
                      "name": "API-Get_VM_SKU"
                    },
                    {
                      "type": 11,
                      "content": {
                        "version": "LinkItem/1.0",
                        "style": "tabs",
                        "links": [
                          {
                            "id": "3f12a4b6-b18d-4191-8c1c-6045a7edcb6b",
                            "cellValue": "SelectedTab",
                            "linkTarget": "parameter",
                            "linkLabel": "VM/VMSS",
                            "subTarget": "VM",
                            "style": "link"
                          },
                          {
                            "id": "78ac1878-4b69-4f32-af1f-a8f095afbed5",
                            "cellValue": "SelectedTab",
                            "linkTarget": "parameter",
                            "linkLabel": "SQL",
                            "subTarget": "SQL",
                            "style": "link"
                          }
                        ]
                      },
                      "name": "links - 1"
                    },
                    {
                      "type": 11,
                      "content": {
                        "version": "LinkItem/1.0",
                        "style": "tabs",
                        "links": [
                          {
                            "id": "0211f413-9f36-4750-9ef2-d382ba30ba6c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Windows Virtual Machines",
                            "subTarget": "VM",
                            "preText": "VM",
                            "style": "link"
                          },
                          {
                            "id": "dbe9a7fb-6ab1-4de1-a98b-4ec8a9af906c",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "Linux Virtual Machines",
                            "subTarget": "LinuxVM",
                            "style": "link"
                          },
                          {
                            "id": "79e7a97a-1413-41e8-b4c6-ebd1d0a45e2e",
                            "cellValue": "SelectedSubTab",
                            "linkTarget": "parameter",
                            "linkLabel": "VM Scale Set",
                            "subTarget": "VMSS",
                            "style": "link"
                          }
                        ]
                      },
                      "conditionalVisibility": {
                        "parameterName": "SelectedTab",
                        "comparison": "isEqualTo",
                        "value": "VM"
                      },
                      "name": "links - 4"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "title": "Virtual Machines",
                        "loadType": "always",
                        "items": [
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "loadType": "always",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"  | extend SubscriptionName=name \r\n| join (\r\nresources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMIDFull=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']), VMSSize=tostring(sku.name), QuickFix=id\r\n    ) on subscriptionId \r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMSSize, VMLocation,OSType, OsVersion,LicenseType, subscriptionId, QuickFix, VMIDFull\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId",
                                    "size": 0,
                                    "title": "AHB Disabled",
                                    "noDataMessage": "All of your VMs have AHB enabled.",
                                    "noDataMessageStyle": 3,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "AHB Disabled"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"  | extend SubscriptionName=name \r\n| join (\r\nresources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) has \"Windows\"\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.offer), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']), VMSSize=tostring(sku.name)\r\n) on subscriptionId \r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMSSize, VMLocation,OSType, OsVersion,LicenseType, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId",
                                    "size": 0,
                                    "title": "AHB Enabled",
                                    "noDataMessage": "None of your VMs have AHB enabled.",
                                    "noDataMessageStyle": 4,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "VMRG",
                                          "formatter": 0,
                                          "tooltipFormat": {
                                            "tooltip": "test"
                                          }
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "WindowsAHBEnabled"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "resourcechanges\r\n| where properties.changeType == \"Update\" and properties.targetResourceType == \"microsoft.compute/virtualmachines\"\r\n| mv-expand changes = properties.changes\r\n| mv-expand LicenseChanges=changes.['properties.licenseType']\r\n| extend WindowsId=id\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId\r\n| where isnotnull(LicenseChanges)\r\n| where  tostring(LicenseChanges.newValue) has \"Windows\"\r\n| project VMID=properties.targetResourceId, NewLicense=tostring(LicenseChanges.newValue), DateofChange=todatetime(properties.changeAttributes.timestamp)\r\n",
                                    "size": 0,
                                    "title": "VM Latest Change Last 7 days",
                                    "noDataMessage": "AHB was not enabled in the last 7 days.",
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "VM Latest Change Last 7 days"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{SingleSubHidden}/providers/Microsoft.Compute/skus?$filter=location eq '{Location}'\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-07-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.*[?(@.resourceType=='virtualMachines')]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"capabilities[?(@.name=='vCPUs')].value\",\"columnid\":\"vCPUs\"},{\"path\":\"capabilities[?(@.name=='MemoryGB')].value\",\"columnid\":\"MemoryGB\"},{\"path\":\"capabilities[?(@.name=='MaxNetworkInterfaces')].value\",\"columnid\":\"MaxNetworkInterfaces\"},{\"path\":\"capabilities[?(@.name=='HyperVGenerations')].value\",\"columnid\":\"HyperVGenerations\"},{\"path\":\"capabilities[?(@.name=='vCPUsPerCore')].value\",\"columnid\":\"vCPUsPerCore\"}]}}]}",
                                    "size": 0,
                                    "title": "Get VM vCPU",
                                    "exportParameterName": "ResourceSKU",
                                    "showExportToExcel": true,
                                    "queryType": 12,
                                    "gridSettings": {
                                      "rowLimit": 5000
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "query - Get VM vCPU"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "## Windows Azure Hybrid Benefit (AHB) Overview"
                                  },
                                  "name": "AHB Overview"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "Each two-processor license or each set of 16-core licenses, either Datacenter or Standard editions, are entitled to two instances of up to 8 cores, or one instance of up to 16 cores.\r\n\r\nThe virtual machines (VMs) with less than 8 cores are categorized as **Low Priority**, while those with 8 or more cores are classified as **High Priority**. In situations where there are insufficient Azure Hybrid benefit licenses to cover all the VMs in the environment, it is recommended to prioritize the High Priority VMs.",
                                    "style": "info"
                                  },
                                  "name": "NUmber of Processors",
                                  "styleSettings": {
                                    "margin": "10px",
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\nresources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows'\r\n| extend WindowsId=id\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId\r\n| extend LicenseType = tostring(properties.['licenseType'])\r\n| extend CheckAHBWindows = case(\r\n     type == 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets', iif((properties.['licenseType'])\r\n     !has 'Windows' and (properties.virtualMachineProfile.['licenseType']) !has 'Windows' , \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not Windows\"\r\n     )\r\n) on subscriptionId \r\n| summarize count() by SubscriptionName, CheckAHBWindows\r\n",
                                    "size": 0,
                                    "title": "Summary of Windows VMs with or without AHB per Subscription",
                                    "showRefreshButton": true,
                                    "showExportToExcel": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "visualization": "table",
                                    "gridSettings": {
                                      "sortBy": [
                                        {
                                          "itemKey": "SubscriptionName",
                                          "sortOrder": 1
                                        }
                                      ],
                                      "labelSettings": [
                                        {
                                          "columnId": "SubscriptionName",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "CheckAHBWindows",
                                          "label": "Is AHB enabled?"
                                        },
                                        {
                                          "columnId": "count_",
                                          "label": "Number of resources"
                                        }
                                      ]
                                    },
                                    "sortBy": [
                                      {
                                        "itemKey": "SubscriptionName",
                                        "sortOrder": 1
                                      }
                                    ],
                                    "tileSettings": {
                                      "titleContent": {
                                        "columnMatch": "CheckAHBWindows",
                                        "formatter": 1
                                      },
                                      "subtitleContent": {
                                        "columnMatch": "SubscriptionName",
                                        "formatter": 1
                                      },
                                      "leftContent": {
                                        "columnMatch": "count_",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "auto"
                                        }
                                      },
                                      "showBorder": false,
                                      "size": "auto"
                                    },
                                    "chartSettings": {
                                      "xAxis": "SubscriptionName"
                                    }
                                  },
                                  "customWidth": "50",
                                  "name": "Summary of Windows VMs with or without AHB per Subscription"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\nresources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows'\r\n| extend WindowsId=id\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId\r\n| extend LicenseType = tostring(properties.['licenseType'])\r\n| extend CheckAHBWindows = case(\r\n     type == 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets', iif((properties.['licenseType'])\r\n     !has 'Windows' and (properties.virtualMachineProfile.['licenseType']) !has 'Windows' , \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not Windows\"\r\n     )\r\n) on subscriptionId \r\n| summarize count() by CheckAHBWindows",
                                    "size": 0,
                                    "title": "Summary of Windows VMs with or without AHB",
                                    "showRefreshButton": true,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ],
                                    "visualization": "piechart"
                                  },
                                  "customWidth": "50",
                                  "name": "Summary of Windows VMs with or without AHB"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "### Consumed Licenses\r\nTotal number of Windows licenses cores consumed by all Windows virtual machines.\r\n",
                                    "style": "info"
                                  },
                                  "customWidth": "50",
                                  "name": "Consumed Licenses"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "### Number of required Cores to enable Windows Azure Hybrid Benefit\r\nNumber of cores required to enable AHB across the entire environment.",
                                    "style": "info"
                                  },
                                  "customWidth": "50",
                                  "name": "Number of required Cores"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"WindowsAHBEnabled\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[WindowsAHBEnabled].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[WindowsAHBEnabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"vCPUs\\\"]\"}}]},{\"originalName\":\"[WindowsAHBEnabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId\"},{\"originalName\":\"[WindowsAHBEnabled].VMRG\"},{\"originalName\":\"[WindowsAHBEnabled].VMLocation\"},{\"originalName\":\"[WindowsAHBEnabled].OSType\"},{\"originalName\":\"[WindowsAHBEnabled].OsVersion\"},{\"originalName\":\"[WindowsAHBEnabled].LicenseType\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\"}]}",
                                    "size": 0,
                                    "title": "Consumed Cores per AHB Priority",
                                    "noDataMessage": "None of your VMs have AHB enabled",
                                    "noDataMessageStyle": 4,
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "piechart",
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "Sev4",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        }
                                      ]
                                    },
                                    "chartSettings": {
                                      "yAxis": [
                                        "Consumed Cores per VM"
                                      ],
                                      "group": "Prioritize AHB?",
                                      "createOtherGroup": null
                                    }
                                  },
                                  "customWidth": "33",
                                  "name": "Consumed Cores per AHB Priority"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d8deb22b-a596-43ee-acc4-180849d26130\",\"mergeType\":\"inner\",\"leftTable\":\"WindowsAHBEnabled\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"ConsumedCores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"vCPUs\\\"]\"}}]},{\"originalName\":\"[WindowsAHBEnabled].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[WindowsAHBEnabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"}]}",
                                    "size": 0,
                                    "title": "Consumed Cores per VM",
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "piechart",
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "ConsumedCores",
                                          "formatter": 0,
                                          "formatOptions": {
                                            "aggregation": "Sum"
                                          }
                                        }
                                      ]
                                    },
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "ConsumedCores",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "blue"
                                        }
                                      },
                                      "showBorder": false
                                    },
                                    "graphSettings": {
                                      "type": 0
                                    },
                                    "chartSettings": {
                                      "yAxis": [
                                        "ConsumedCores"
                                      ],
                                      "group": "VMName",
                                      "createOtherGroup": null
                                    }
                                  },
                                  "customWidth": "33",
                                  "name": "Consumed Cores per VM"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"AHB Disabled\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"[\\\"vCPUs\\\"]\"}}]},{\"originalName\":\"[query - 0].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[AHB Disabled].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].QuickFix\",\"mergedName\":\"QuickFix\",\"fromId\":\"unknown\"},{\"originalName\":\"[AHB Disabled].VMIDFull\",\"mergedName\":\"VMIDFull\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId\"},{\"originalName\":\"[WindowsAHBEnabled].VMRG\"},{\"originalName\":\"[WindowsAHBEnabled].VMLocation\"},{\"originalName\":\"[WindowsAHBEnabled].OSType\"},{\"originalName\":\"[WindowsAHBEnabled].OsVersion\"},{\"originalName\":\"[WindowsAHBEnabled].LicenseType\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\"}]}",
                                    "size": 0,
                                    "title": "Cores not enabled per AHB Priority",
                                    "noDataMessage": "All of your VMs have AHB enabled",
                                    "noDataMessageStyle": 4,
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "piechart",
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "Sev4",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        }
                                      ]
                                    },
                                    "chartSettings": {
                                      "yAxis": [
                                        "Consumed Cores per VM"
                                      ],
                                      "group": "Prioritize AHB?",
                                      "createOtherGroup": null
                                    }
                                  },
                                  "customWidth": "33",
                                  "name": "Cores NOT enabled per AHB Priority"
                                },
                                {
                                  "type": 9,
                                  "content": {
                                    "version": "KqlParameterItem/1.0",
                                    "parameters": [
                                      {
                                        "id": "ae5e8765-47ef-46a6-803b-6b7124c098d2",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "AHBEnabled",
                                        "label": "See VMs with AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "timeContext": {
                                          "durationMs": 86400000
                                        }
                                      },
                                      {
                                        "id": "f1ac5e53-253c-4afb-8bc5-b1ba2efea3eb",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "AHBDisabled",
                                        "label": "See VMs without AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "value": "Yes"
                                      },
                                      {
                                        "id": "20a00706-a89b-42aa-8dea-9c44c93e8014",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "LastAHB",
                                        "label": "See VMs AHB enabled in the last 7 days",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n"
                                      }
                                    ],
                                    "style": "pills",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  "name": "VM AHB Enabled"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "List of Windows VMs without Hybrid Benefit groupped by Subscription.",
                                    "style": "info"
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AHBDisabled",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "List of Windows VMs without AHB"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"AHB Disabled\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[query - 0].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[AHB Disabled].VMName\",\"mergedName\":\"VM Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"static\",\"resultVal\":\"High Priority\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Low Priority\"}}]},{\"originalName\":\"[AHB Disabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].QuickFix\",\"mergedName\":\"QuickFix\",\"fromId\":\"unknown\"},{\"originalName\":\"[AHB Disabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].Name\",\"mergedName\":\"Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[AHB Disabled].VMIDFull\",\"mergedName\":\"VMIDFull\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0].VMName\"},{\"originalName\":\"[query - 0].VMSSize\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[AHB Disabled].WindowsId\"},{\"originalName\":\"[AHB Disabled].VMSSize\"}]}",
                                    "size": 0,
                                    "title": "VMs without AHB",
                                    "noDataMessage": "All of your VMs have AHB enabled",
                                    "noDataMessageStyle": 3,
                                    "exportedParameters": [
                                      {
                                        "fieldName": "VMIDFull",
                                        "parameterName": "WindowsID"
                                      },
                                      {
                                        "fieldName": "VMRG",
                                        "parameterName": "ResourceGroup",
                                        "parameterType": 1
                                      },
                                      {
                                        "fieldName": "VM Name",
                                        "parameterName": "VMName",
                                        "parameterType": 1
                                      },
                                      {
                                        "fieldName": "Prioritize AHB?",
                                        "parameterName": "AHBPriority",
                                        "parameterType": 1
                                      }
                                    ],
                                    "showExportToExcel": true,
                                    "queryType": 7,
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "$gen_group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "QuickFix",
                                          "formatter": 7,
                                          "formatOptions": {
                                            "linkTarget": "ArmAction",
                                            "linkLabel": "Apply Hybrid Benefit",
                                            "linkIsContextBlade": true,
                                            "armActionContext": {
                                              "path": "/{WindowsID}?api-version=2023-03-01",
                                              "headers": [],
                                              "params": [],
                                              "body": "{\r\n  \"properties\": {\r\n    \"licenseType\": \"Windows_Server\"\r\n  }\r\n}\r\n\r\n",
                                              "httpMethod": "PATCH",
                                              "title": "Apply Hybrid Benefit to VM {VMName}",
                                              "description": "# Windows Hybrid Benefit Application Information: VM \"{VMName}\"\n\n\n{WindowsID}\n\n**Attention!**\n\nThis action will apply the Windows Hybrid Benefit to the virtual machine with the name **{VMName}**. Please ensure that you are applying the benefit to the correct VM.\n\n**Resource Details:**\n\n- VM Name: {VMName}\n- Resource Group: {ResourceGroup}\n- Prioritize AHB: {AHBPriority}\n\n### Required RBAC Permissions\n\nTo perform this action, you need to have **Contributor** permissions on the Resource Group where the VM is located.\n\nPlease review the information carefully before proceeding with applying the Windows Hybrid Benefit.\n",
                                              "actionName": "Applying Hybrid benefit to VM {VMName}",
                                              "runLabel": "Apply Hybrid Benefit to VM: \"{VMName}\""
                                            }
                                          }
                                        },
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "Sev4",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          },
                                          "tooltipFormat": {
                                            "tooltip": "The virtual machines (VMs) with less than 8 cores are categorized as Low Priority, while those with 8 or more cores are classified as High Priority. "
                                          }
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "WindowsId1",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "Name",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "HyperVGenerations",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "vCPUsPerCore",
                                          "formatter": 5
                                        },
                                        {
                                          "columnMatch": "VMIDFull",
                                          "formatter": 5
                                        }
                                      ],
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "subscriptionId"
                                        ],
                                        "expandTopLevel": true
                                      },
                                      "labelSettings": [
                                        {
                                          "columnId": "VM Name",
                                          "label": "VM Name"
                                        },
                                        {
                                          "columnId": "VMRG",
                                          "label": "Resource Group"
                                        },
                                        {
                                          "columnId": "VMLocation",
                                          "label": "Location"
                                        },
                                        {
                                          "columnId": "QuickFix",
                                          "label": "Enable AHB"
                                        },
                                        {
                                          "columnId": "Prioritize AHB?",
                                          "label": "AHB Priority"
                                        },
                                        {
                                          "columnId": "VMSize",
                                          "label": "SKU"
                                        },
                                        {
                                          "columnId": "OSType",
                                          "label": "OS Type"
                                        },
                                        {
                                          "columnId": "OsVersion",
                                          "label": "OS Version"
                                        },
                                        {
                                          "columnId": "LicenseType",
                                          "label": "License Type"
                                        },
                                        {
                                          "columnId": "subscriptionId",
                                          "label": "Subscription Name"
                                        },
                                        {
                                          "columnId": "vCPUs",
                                          "label": "Number of vCPU"
                                        },
                                        {
                                          "columnId": "MemoryGB",
                                          "label": "Memory"
                                        },
                                        {
                                          "columnId": "MaxNetworkInterfaces",
                                          "label": "Max. NICs"
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AHBDisabled",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "VM+SKU+vCores"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "List of Windows VMs with Hybrid Benefit groupped by Subscription.",
                                    "style": "info"
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AHBEnabled",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "AHB By SUbscription"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"WindowsAHBEnabled\",\"rightTable\":\"query - Get VM vCPU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[WindowsAHBEnabled].WindowsId\",\"mergedName\":\"VM Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[WindowsAHBEnabled].VMRG\",\"mergedName\":\"Resource Group\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[WindowsAHBEnabled].VMSize\",\"mergedName\":\"VM SKU\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - Get VM vCPU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"static\",\"resultVal\":\"High Priority\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Low Priority\"}}]},{\"originalName\":\"[WindowsAHBEnabled].LicenseType\",\"mergedName\":\"License Type\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"vCPUs\\\"] + 7) & ~7\"}}]},{\"originalName\":\"[WindowsAHBEnabled].VMLocation\",\"mergedName\":\"Location\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[WindowsAHBEnabled].OSType\",\"mergedName\":\"OS Type\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[WindowsAHBEnabled].OsVersion\",\"mergedName\":\"OS Version\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[WindowsAHBEnabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0].VMName\"},{\"originalName\":\"[query - 0].VMSSize\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\"},{\"originalName\":\"[WindowsAHBEnabled].VMName\"}]}",
                                    "size": 0,
                                    "title": "VMs with AHB",
                                    "noDataMessage": "None of your VMs have AHB enabled",
                                    "noDataMessageStyle": 4,
                                    "showExportToExcel": true,
                                    "queryType": 7,
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "$gen_group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "2",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Subscription Name",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        }
                                      ],
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "subscriptionId"
                                        ],
                                        "expandTopLevel": true
                                      },
                                      "labelSettings": [
                                        {
                                          "columnId": "WindowsId1",
                                          "label": "VM ID"
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AHBEnabled",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "VM+SKU+vCores-AHB"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d8deb22b-a596-43ee-acc4-180849d26168\",\"mergeType\":\"inner\",\"leftTable\":\"VM Latest Change Last 7 days\",\"rightTable\":\"VM+SKU+vCores-AHB\",\"leftColumn\":\"VMID\",\"rightColumn\":\"VM Name\"}],\"projectRename\":[{\"originalName\":\"[VM Latest Change Last 7 days].VMID\",\"mergedName\":\"VMID\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM Latest Change Last 7 days].NewLicense\",\"mergedName\":\"NewLicense\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM Latest Change Last 7 days].DateofChange\",\"mergedName\":\"DateofChange\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].VM Name\",\"mergedName\":\"VM Name\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Resource Group\",\"mergedName\":\"Resource Group\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].VM SKU\",\"mergedName\":\"VM SKU\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Prioritize AHB?\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].License Type\",\"mergedName\":\"License Type\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Consumed Cores per VM\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Location\",\"mergedName\":\"Location\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].OS Type\",\"mergedName\":\"OS Type\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].OS Version\",\"mergedName\":\"OS Version\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[VM+SKU+vCores-AHB].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"}]}",
                                    "size": 0,
                                    "title": "Total Cores Enabled last 7 Days",
                                    "noDataMessage": "Windows AHB hasn't been enabled in the last 7 days",
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "barchart",
                                    "tileSettings": {
                                      "showBorder": false,
                                      "titleContent": {
                                        "columnMatch": "NewLicense",
                                        "formatter": 1
                                      },
                                      "leftContent": {
                                        "columnMatch": "vCPUs",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "auto"
                                        },
                                        "numberFormat": {
                                          "unit": 17,
                                          "options": {
                                            "maximumSignificantDigits": 3,
                                            "maximumFractionDigits": 2
                                          }
                                        }
                                      }
                                    },
                                    "chartSettings": {
                                      "xAxis": "VM Name",
                                      "yAxis": [
                                        "Consumed Cores per VM"
                                      ],
                                      "group": null,
                                      "createOtherGroup": 0,
                                      "seriesLabelSettings": [
                                        {
                                          "seriesName": "Consumed Cores per VM",
                                          "color": "grayBlue"
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "LastAHB",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "Total Cores Enabled last 7 Days"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d8deb22b-a596-43ee-acc4-180849d26168\",\"mergeType\":\"inner\",\"leftTable\":\"VM Latest Change Last 7 days\",\"rightTable\":\"VM+SKU+vCores-AHB\",\"leftColumn\":\"VMID\",\"rightColumn\":\"VM Name\"}],\"projectRename\":[{\"originalName\":\"[VM+SKU+vCores-AHB].VM Name\",\"mergedName\":\"VM Name\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Resource Group\",\"mergedName\":\"Resource Group\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM Latest Change Last 7 days].NewLicense\",\"mergedName\":\"NewLicense\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM Latest Change Last 7 days].DateofChange\",\"mergedName\":\"DateofChange\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].VM SKU\",\"mergedName\":\"VM SKU\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Consumed Cores per VM\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Prioritize AHB?\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].Location\",\"mergedName\":\"Location\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[VM+SKU+vCores-AHB].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[VM+SKU+vCores-AHB].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[VM Latest Change Last 7 days].VMID\"},{\"originalName\":\"[VM+SKU+vCores-AHB].OS Type\"},{\"originalName\":\"[VM+SKU+vCores-AHB].OS Version\"},{\"originalName\":\"[VM+SKU+vCores-AHB].License Type\"}]}",
                                    "size": 0,
                                    "title": "Total Cores Enabled last 7 Days - Detailed view",
                                    "noDataMessage": "No AHB has been enabled in the last 7 days",
                                    "showExportToExcel": true,
                                    "queryType": 7,
                                    "visualization": "table",
                                    "tileSettings": {
                                      "showBorder": false,
                                      "titleContent": {
                                        "columnMatch": "NewLicense",
                                        "formatter": 1
                                      },
                                      "leftContent": {
                                        "columnMatch": "vCPUs",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "auto"
                                        },
                                        "numberFormat": {
                                          "unit": 17,
                                          "options": {
                                            "maximumSignificantDigits": 3,
                                            "maximumFractionDigits": 2
                                          }
                                        }
                                      }
                                    },
                                    "chartSettings": {
                                      "xAxis": "VM Name",
                                      "yAxis": [
                                        "Consumed Cores per VM"
                                      ],
                                      "group": null,
                                      "createOtherGroup": 0,
                                      "seriesLabelSettings": [
                                        {
                                          "seriesName": "Consumed Cores per VM",
                                          "color": "grayBlue"
                                        }
                                      ]
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "LastAHB",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "showPin": false,
                                  "name": "Total Cores Enabled last 7 Days - Details"
                                }
                              ]
                            },
                            "name": "VM"
                          }
                        ]
                      },
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isEqualTo",
                          "value": "VM"
                        },
                        {
                          "parameterName": "SelectedSubTab",
                          "comparison": "isEqualTo",
                          "value": "VM"
                        }
                      ],
                      "name": "VM/VMSS-RGFilter"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "items": [
                          {
                            "type": 11,
                            "content": {
                              "version": "LinkItem/1.0",
                              "style": "tabs",
                              "links": [
                                {
                                  "id": "0211f413-9f36-4750-9ef2-d382ba30ba6c",
                                  "cellValue": "SelectedSubTab",
                                  "linkTarget": "parameter",
                                  "linkLabel": "SQL Server VMs",
                                  "subTarget": "SQLVM",
                                  "preText": "VM",
                                  "style": "link"
                                },
                                {
                                  "id": "79e7a97a-1413-41e8-b4c6-ebd1d0a45e2e",
                                  "cellValue": "SelectedSubTab",
                                  "linkTarget": "parameter",
                                  "linkLabel": "SQL DB",
                                  "subTarget": "SQLDB",
                                  "style": "link"
                                },
                                {
                                  "id": "1f381e5b-7071-41ce-a354-c2df93445cae",
                                  "cellValue": "SelectedSubTab",
                                  "linkTarget": "parameter",
                                  "linkLabel": "SQL Managed Instances",
                                  "subTarget": "SQLMI",
                                  "style": "link"
                                }
                              ]
                            },
                            "name": "links - 4"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\n     resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and tostring(properties.['sqlServerLicenseType']) != 'AHB' and resourceGroup in ({ResourceGroup})\r\n    | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])\r\n    ) on subscriptionId \r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Compute/virtualmachines'\r\n    | project VMName = tolower(name), VMSize = tostring(properties.hardwareProfile.vmSize)\r\n    ) on VMName\r\n| order by id asc    \r\n| project SQLID,VMName,VMRG, VMLocation, VMSize, SQLVersion, SQLSKU, SQLAgentType, LicenseType, SubscriptionName\r\n| where SQLSKU != \"Developer\" and SQLSKU != \"Express\"\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLID\r\n    )\r\n    on SQLID",
                                    "size": 0,
                                    "title": "SQL VM AHB Disabled",
                                    "noDataMessage": "All of your VMs have AHB enabled.",
                                    "noDataMessageStyle": 3,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "Get-SQL-AHB-Disabled"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\n     resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and tostring(properties.['sqlServerLicenseType']) == 'AHB' and resourceGroup in ({ResourceGroup})\r\n    | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])\r\n    ) on subscriptionId \r\n| join (\r\n    resources\r\n    | where type =~ 'Microsoft.Compute/virtualmachines'\r\n    | project VMName = tolower(name), VMSize = tostring(properties.hardwareProfile.vmSize)\r\n    ) on VMName\r\n| order by id asc    \r\n| project SQLID,VMName,VMRG, VMLocation, VMSize, SQLVersion, SQLSKU, SQLAgentType, LicenseType, SubscriptionName\r\n| where SQLSKU != \"Developer\" and SQLSKU != \"Express\"\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLID\r\n    )\r\n    on SQLID",
                                    "size": 0,
                                    "title": "SQL VM AHB Enabled",
                                    "noDataMessage": "None of your VMs have AHB enabled.",
                                    "noDataMessageStyle": 5,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "Get-SQL-AHB-Enabled"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "## SQL Virtual Machines Azure Hybrid Benefit (AHB) Overview"
                                  },
                                  "name": "SQL Text"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "Apply to SQL Server 1 to 4 vCPUs exchange: For every 1 core of SQL Server Enterprise Edition, you get 4 vCPUs of SQL Managed Instance or Azure SQL Database general purpose and Hyperscale tiers, or 4 vCPUs of SQL Server Standard edition on Azure VMs.\r\n\r\nThe SQL virtual machines (VMs) with less than 4 cores are categorized as **Low Priority**, while those with 8 or more cores are classified as **High Priority**. In situations where there are insufficient Azure Hybrid benefit licenses to cover all the VMs in the environment, it is recommended to prioritize the High Priority VMs.",
                                    "style": "info"
                                  },
                                  "name": "SQL License Info",
                                  "styleSettings": {
                                    "margin": "10px",
                                    "showBorder": true
                                  }
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "### AHB Overview\r\nSummary of all SQL on VMs with and without SQL AHB.",
                                    "style": "info"
                                  },
                                  "name": "AHB Overview21"
                                },
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "loadType": "explicit",
                                    "loadButtonText": "Load SQL Info",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\n    resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and resourceGroup in ({ResourceGroup})\r\n    | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])\r\n    | where SQLSKU != \"Developer\" and SQLSKU != \"Express\"\r\n    | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLID\r\n    )\r\n    on SQLID\r\n    | extend CheckSQLVMAHB = case(\r\n     type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines', iif((properties.['sqlServerLicenseType'])\r\n     !has 'AHB', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not SQL\"\r\n     )\r\n    ) on subscriptionId \r\n| summarize count() by SubscriptionName, CheckSQLVMAHB",
                                          "size": 0,
                                          "title": "Summary of SQL on VMs with or without AHB per Subscription",
                                          "showRefreshButton": true,
                                          "queryType": 1,
                                          "resourceType": "microsoft.resourcegraph/resources",
                                          "crossComponentResources": [
                                            "{Subscription}"
                                          ],
                                          "visualization": "table",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ],
                                            "labelSettings": [
                                              {
                                                "columnId": "SubscriptionName",
                                                "label": "Subscription Name"
                                              },
                                              {
                                                "columnId": "CheckSQLVMAHB",
                                                "label": "Is AHB enabled?"
                                              },
                                              {
                                                "columnId": "count_",
                                                "label": "Number of Resources"
                                              }
                                            ]
                                          },
                                          "tileSettings": {
                                            "titleContent": {
                                              "columnMatch": "CheckSQLVMAHB",
                                              "formatter": 1
                                            },
                                            "subtitleContent": {
                                              "columnMatch": "SubscriptionName",
                                              "formatter": 1
                                            },
                                            "leftContent": {
                                              "columnMatch": "count_",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "auto"
                                              }
                                            },
                                            "showBorder": false,
                                            "size": "auto"
                                          },
                                          "chartSettings": {
                                            "xAxis": "SubscriptionName"
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "Summary of SQL on VMs with or without AHB"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"  | extend SubscriptionName=name \r\n| join (\r\n    resources | where type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines' and resourceGroup in ({ResourceGroup})\r\n    | extend SQLID=id, VMName = name, VMRG = resourceGroup, VMLocation = location, LicenseType = tostring(properties.['sqlServerLicenseType']), OSType=tostring(properties.storageProfile.imageReference.offer), SQLAgentType = tostring(properties.['sqlManagement']), SQLVersion = tostring(properties.['sqlImageOffer']), SQLSKU=tostring(properties.['sqlImageSku'])\r\n    | where SQLSKU != \"Developer\" and SQLSKU != \"Express\"\r\n    | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLID\r\n    )\r\n    on SQLID\r\n    | extend CheckSQLVMAHB = case(\r\n     type =~ 'Microsoft.SqlVirtualMachine/SqlVirtualMachines', iif((properties.['sqlServerLicenseType'])\r\n     !has 'AHB', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not SQL\"\r\n     )\r\n    ) on subscriptionId \r\n| summarize count() by CheckSQLVMAHB",
                                          "size": 0,
                                          "title": "Summary SQL Enabled and Disabled",
                                          "noDataMessage": "You don't have any SQL VM",
                                          "showRefreshButton": true,
                                          "queryType": 1,
                                          "resourceType": "microsoft.resourcegraph/resources",
                                          "crossComponentResources": [
                                            "{Subscription}"
                                          ],
                                          "visualization": "piechart"
                                        },
                                        "customWidth": "50",
                                        "name": "Summary SQL Enabled and Disabled"
                                      },
                                      {
                                        "type": 1,
                                        "content": {
                                          "json": "### Consumed Licenses\r\nTotal number of SQL licenses cores consumed by all SQL running on Virtual Machines.\r\n",
                                          "style": "info"
                                        },
                                        "customWidth": "50",
                                        "name": "Consumed Licenses123"
                                      },
                                      {
                                        "type": 1,
                                        "content": {
                                          "json": "### Number of required Cores to enable SQL Azure Hybrid Benefit\r\nNumber of cores required to enable SQL AHB across the entire environment.\r\n\r\n\r\n",
                                          "style": "info"
                                        },
                                        "customWidth": "50",
                                        "name": "Number of required Cores to enable SQL AHB"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"cd7477ac-acd6-4894-b929-53348c7640e8\",\"mergeType\":\"inner\",\"leftTable\":\"API-Get_VM_SKU\",\"rightTable\":\"Get-SQL-AHB-Enabled\",\"leftColumn\":\"Name\",\"rightColumn\":\"VMSize\"}],\"projectRename\":[{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLID\",\"mergedName\":\"SQLID\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLVersion\",\"mergedName\":\"SQLVersion\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLSKU\",\"mergedName\":\"SQLSKU\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLAgentType\",\"mergedName\":\"SQLAgentType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLID1\",\"mergedName\":\"SQLID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL VM AHB Consumed Cores per VM",
                                          "noDataMessage": "None of your VMs have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "VMName",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQL+SKU AHB Enabled - per VM"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"cd7477ac-acd6-4894-b929-53348c7640e8\",\"mergeType\":\"inner\",\"leftTable\":\"API-Get_VM_SKU\",\"rightTable\":\"Get-SQL-AHB-Enabled\",\"leftColumn\":\"Name\",\"rightColumn\":\"VMSize\"}],\"projectRename\":[{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLID\",\"mergedName\":\"SQLID\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLVersion\",\"mergedName\":\"SQLVersion\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLSKU\",\"mergedName\":\"SQLSKU\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLAgentType\",\"mergedName\":\"SQLAgentType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLID1\",\"mergedName\":\"SQLID1\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].Name\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMName\"}]}",
                                          "size": 0,
                                          "title": "SQL VM AHB Consumed Cores per Priority",
                                          "noDataMessage": "None of your VMs have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "group": "Prioritize AHB?",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "showPin": false,
                                        "name": "Summary SQL+SKU AHB Enabled -"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"cd7477ac-acd6-4894-b929-53348c7640b5\",\"mergeType\":\"inner\",\"leftTable\":\"API-Get_VM_SKU\",\"rightTable\":\"Get-SQL-AHB-Disabled\",\"leftColumn\":\"Name\",\"rightColumn\":\"VMSize\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"vCPUs\\\"] +3) & ~3\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLID\",\"mergedName\":\"SQLID\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLVersion\",\"mergedName\":\"SQLVersion\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLSKU\",\"mergedName\":\"SQLSKU\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLAgentType\",\"mergedName\":\"SQLAgentType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLID1\",\"mergedName\":\"SQLID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "Cores not enabled per AHB Priority",
                                          "noDataMessage": "All of your VMs have AHB enabled.",
                                          "noDataMessageStyle": 3,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "warning",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "success",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "sortBy": [],
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "showMetrics": false,
                                            "showLegend": true
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": " Summary - SQL Cores AHB Disabled "
                                      }
                                    ]
                                  },
                                  "name": "SQL Overview RG"
                                },
                                {
                                  "type": 9,
                                  "content": {
                                    "version": "KqlParameterItem/1.0",
                                    "parameters": [
                                      {
                                        "id": "ae5e8765-47ef-46a6-803b-6b7124c098d2",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "SQLAVMHUBEnabled",
                                        "label": "See SQL  VMs with AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "timeContext": {
                                          "durationMs": 86400000
                                        }
                                      },
                                      {
                                        "id": "f1ac5e53-253c-4afb-8bc5-b1ba2efea3eb",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "SQLVMAHBDisabled",
                                        "label": "See SQL VMs without AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "value": "Yes"
                                      }
                                    ],
                                    "style": "pills",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  "name": "SQL AHB Disabled"
                                },
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"cd7477ac-acd6-4894-b929-53348c7640b5\",\"mergeType\":\"inner\",\"leftTable\":\"API-Get_VM_SKU\",\"rightTable\":\"Get-SQL-AHB-Disabled\",\"leftColumn\":\"Name\",\"rightColumn\":\"VMSize\"}],\"projectRename\":[{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLID\",\"mergedName\":\"VM Name\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLVersion\",\"mergedName\":\"SQLVersion\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLSKU\",\"mergedName\":\"SQLSKU\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLAgentType\",\"mergedName\":\"SQLAgentType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640b5\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLID1\",\"mergedName\":\"SQLID1\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].Name\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLID\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMName\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMRG\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMLocation\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLVersion\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLSKU\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SQLAgentType\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].LicenseType\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].SubscriptionName\"},{\"originalName\":\"[Get-SQL-AHB-Disabled].VMSize\"}]}",
                                          "size": 0,
                                          "title": "SQL VM AHB Disabled",
                                          "noDataMessage": "All of your VMs have AHB enabled.",
                                          "noDataMessageStyle": 3,
                                          "showExportToExcel": true,
                                          "queryType": 7,
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "$gen_group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "Group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "warning",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "success",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ],
                                            "hierarchySettings": {
                                              "treeType": 1,
                                              "groupBy": [
                                                "SubscriptionName"
                                              ],
                                              "expandTopLevel": true
                                            },
                                            "labelSettings": [
                                              {
                                                "columnId": "VM Name",
                                                "label": "Name"
                                              },
                                              {
                                                "columnId": "VMRG",
                                                "label": "Resource Group"
                                              },
                                              {
                                                "columnId": "VMLocation",
                                                "label": "Location"
                                              },
                                              {
                                                "columnId": "VMSize",
                                                "label": "SKU"
                                              },
                                              {
                                                "columnId": "vCPUs",
                                                "label": "Number of vCPU"
                                              },
                                              {
                                                "columnId": "Consumed Cores",
                                                "label": "Consumed Cores"
                                              },
                                              {
                                                "columnId": "SQLVersion",
                                                "label": "SQL Version"
                                              },
                                              {
                                                "columnId": "SQLSKU",
                                                "label": "SQL SKU"
                                              },
                                              {
                                                "columnId": "SQLAgentType",
                                                "label": "SQL Agent"
                                              },
                                              {
                                                "columnId": "LicenseType",
                                                "label": "License Type"
                                              },
                                              {
                                                "columnId": "SubscriptionName",
                                                "label": "Subscription Name"
                                              },
                                              {
                                                "columnId": "SQLID1",
                                                "label": "Resource ID"
                                              }
                                            ]
                                          },
                                          "sortBy": []
                                        },
                                        "conditionalVisibility": {
                                          "parameterName": "SQLVMAHBDisabled",
                                          "comparison": "isEqualTo",
                                          "value": "Yes"
                                        },
                                        "name": "SQL+SKU AHB Disabled"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"cd7477ac-acd6-4894-b929-53348c7640e8\",\"mergeType\":\"inner\",\"leftTable\":\"API-Get_VM_SKU\",\"rightTable\":\"Get-SQL-AHB-Enabled\",\"leftColumn\":\"Name\",\"rightColumn\":\"VMSize\"}],\"projectRename\":[{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLID\",\"mergedName\":\"SQLID\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLVersion\",\"mergedName\":\"SQLVersion\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLSKU\",\"mergedName\":\"SQLSKU\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLAgentType\",\"mergedName\":\"SQLAgentType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"cd7477ac-acd6-4894-b929-53348c7640e8\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].SQLID1\",\"mergedName\":\"SQLID1\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].Name\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\"},{\"originalName\":\"[Get-SQL-AHB-Enabled].VMName\"}]}",
                                          "size": 0,
                                          "title": "SQL VM AHB Enabled",
                                          "noDataMessage": "None of your VMs have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showExportToExcel": true,
                                          "queryType": 7,
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "$gen_group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "Group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              },
                                              {
                                                "columnMatch": "Subscription",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              }
                                            ],
                                            "hierarchySettings": {
                                              "treeType": 1,
                                              "groupBy": [
                                                "SubscriptionName"
                                              ],
                                              "expandTopLevel": true
                                            },
                                            "labelSettings": [
                                              {
                                                "columnId": "SQLID",
                                                "label": "Name"
                                              },
                                              {
                                                "columnId": "VMRG",
                                                "label": "Resource Group"
                                              },
                                              {
                                                "columnId": "VMLocation",
                                                "label": "Location"
                                              },
                                              {
                                                "columnId": "VMSize",
                                                "label": "SKU"
                                              },
                                              {
                                                "columnId": "vCPUs",
                                                "label": "Number of vCPU"
                                              },
                                              {
                                                "columnId": "Consumed Cores",
                                                "label": "Consumed Cores"
                                              },
                                              {
                                                "columnId": "SQLVersion",
                                                "label": "SQL Version"
                                              },
                                              {
                                                "columnId": "SQLSKU",
                                                "label": "SQL SKU"
                                              },
                                              {
                                                "columnId": "SQLAgentType",
                                                "label": "SQL Agent"
                                              },
                                              {
                                                "columnId": "LicenseType",
                                                "label": "License Type"
                                              },
                                              {
                                                "columnId": "SubscriptionName",
                                                "label": "Subscription Name"
                                              },
                                              {
                                                "columnId": "SQLID1",
                                                "label": "Resource ID"
                                              }
                                            ]
                                          }
                                        },
                                        "conditionalVisibility": {
                                          "parameterName": "SQLAVMHUBEnabled",
                                          "comparison": "isEqualTo",
                                          "value": "Yes"
                                        },
                                        "name": "SQL+SKU AHB Enabled"
                                      }
                                    ]
                                  },
                                  "name": "SQL Detailed Info"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "SQLVM"
                            },
                            "name": "SQL VM"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "title": "SQL Database",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"\r\n| extend SubscriptionName=name | join (resources |  where type =~ 'Microsoft.Sql/servers/databases' and name != 'master' and tostring(properties.['licenseType']) == 'LicenseIncluded' and kind contains 'vcore' and kind !contains \"serverless\"\r\n| extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=tostring(sku.name), SKUTier=tostring(sku.tier), vCores=tostring(sku.capacity), SQLLocation = location, LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType'])\r\n| extend CheckSQLDBAHB = case(\r\n type =~ 'Microsoft.Sql/servers/databases', iif((properties.['licenseType'])\r\n has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n\"Not SQL DB\"\r\n    )\r\n) on subscriptionId \r\n| project SQLDBID,SQLName,SQLRG, SKUName, SKUTier, vCores, CheckSQLDBAHB,SQLLocation, LicenseType, StorageAccountType, SubscriptionName\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLDBID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLDBID\r\n    )\r\n    on SQLDBID\r\n",
                                    "size": 0,
                                    "title": "AHB Disabled",
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "SQLDB AHB Disabled"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"\r\n| extend SubscriptionName=name | join (resources |  where type =~ 'Microsoft.Sql/servers/databases' and name != 'master' and tostring(properties.['licenseType']) != 'LicenseIncluded' and kind contains 'vcore' and kind !contains \"serverless\"\r\n| extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=sku.name, SKUTier=sku.tier, SQLLocation = location, vCores=tostring(sku.capacity), LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType'])) on subscriptionId \r\n| project SQLDBID,SQLName,SQLRG, SKUName, SKUTier, vCores, SQLLocation, LicenseType, StorageAccountType, SubscriptionName\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLDBID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLDBID\r\n    )\r\n    on SQLDBID\r\n\r\n",
                                    "size": 0,
                                    "title": "AHB Enabled",
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "SQLDB AHB Enabled"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "## SQL Databases Azure Hybrid Benefit (AHB) Overview"
                                  },
                                  "name": "SQL Databases AHB"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "Apply to SQL Server 1 to 4 vCPUs exchange: For every 1 core of SQL Server Enterprise Edition, you get 4 vCPUs of SQL Managed Instance or Azure SQL Database general purpose and Hyperscale tiers, or 4 vCPUs of SQL Server Standard edition on Azure VMs.\r\n\r\nThe SQL virtual machines (VMs) with less than 4 cores are categorized as **Low Priority**, while those with 8 or more cores are classified as **High Priority**. In situations where there are insufficient Azure Hybrid benefit licenses to cover all the VMs in the environment, it is recommended to prioritize the High Priority VMs.\r\n\r\nFor Azure SQL Database, Azure Hybrid Benefit is only available when using the provisioned compute tier of the vCore-based purchasing model. Azure Hybrid Benefit doesn't apply to DTU-based purchasing models or the serverless compute tier.",
                                    "style": "info"
                                  },
                                  "name": "Apply to SQL Server 1 to 4 vCPUs "
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "### AHB Overview\r\nSummary of all SQL Databases with and without SQL AHB.",
                                    "style": "info"
                                  },
                                  "name": " AHB Overview SQL DB"
                                },
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "loadType": "explicit",
                                    "loadButtonText": "Load SQL DB Info",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\n    resources | where type =~ 'Microsoft.Sql/servers/databases' and name != 'master' and kind contains 'vcore' and kind !contains \"serverless\"\r\n     | extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=sku.name, SKUTier=sku.tier, SQLLocation = location, LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType'])\r\n     | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLDBID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLDBID\r\n    )\r\n    on SQLDBID\r\n     | extend CheckSQLDBAHB = case(\r\n     type =~ 'Microsoft.Sql/servers/databases', iif((properties.['licenseType'])\r\n     has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not SQL DB\"\r\n     )\r\n    ) on subscriptionId \r\n| summarize count() by SubscriptionName, CheckSQLDBAHB",
                                          "size": 0,
                                          "title": "Summary of SQL Databases with or without AHB per Subscription",
                                          "showRefreshButton": true,
                                          "queryType": 1,
                                          "resourceType": "microsoft.resourcegraph/resources",
                                          "crossComponentResources": [
                                            "{Subscription}"
                                          ],
                                          "visualization": "table",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ],
                                            "labelSettings": [
                                              {
                                                "columnId": "SubscriptionName",
                                                "label": "Subscription Name"
                                              },
                                              {
                                                "columnId": "CheckSQLDBAHB",
                                                "label": "Is AHB enabled?"
                                              },
                                              {
                                                "columnId": "count_",
                                                "label": "Number of resources"
                                              }
                                            ]
                                          },
                                          "tileSettings": {
                                            "titleContent": {
                                              "columnMatch": "CheckSQLDBAHB",
                                              "formatter": 1
                                            },
                                            "subtitleContent": {
                                              "columnMatch": "SubscriptionName",
                                              "formatter": 1
                                            },
                                            "leftContent": {
                                              "columnMatch": "count_",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "auto"
                                              }
                                            },
                                            "showBorder": false,
                                            "size": "auto"
                                          },
                                          "chartSettings": {
                                            "xAxis": "SubscriptionName"
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "Summary of SQL DBs with or without AHB per subs"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" | extend SubscriptionName=name \r\n| join (\r\n    resources | where type =~ 'Microsoft.Sql/servers/databases' and name != 'master' and kind contains 'vcore' and kind !contains \"serverless\"\r\n     | extend   SQLDBID=id,SQLName = name, SQLRG = resourceGroup, SKUName=sku.name, SKUTier=sku.tier, SQLLocation = location, LicenseType = tostring(properties.['licenseType']), StorageAccountType=tostring(properties.['storageAccountType'])\r\n     | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), SQLDBID=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct SQLDBID\r\n    )\r\n    on SQLDBID\r\n     | extend CheckSQLDBAHB = case(\r\n     type =~ 'Microsoft.Sql/servers/databases', iif((properties.['licenseType'])\r\n     has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not SQL DB\"\r\n     )\r\n    ) on subscriptionId \r\n| summarize count() by CheckSQLDBAHB",
                                          "size": 0,
                                          "title": "Summary of SQL Databases with or without AHB",
                                          "showRefreshButton": true,
                                          "queryType": 1,
                                          "resourceType": "microsoft.resourcegraph/resources",
                                          "crossComponentResources": [
                                            "{Subscription}"
                                          ],
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "tileSettings": {
                                            "titleContent": {
                                              "columnMatch": "CheckSQLDBAHB",
                                              "formatter": 1
                                            },
                                            "subtitleContent": {
                                              "columnMatch": "SubscriptionName",
                                              "formatter": 1
                                            },
                                            "leftContent": {
                                              "columnMatch": "count_",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "auto"
                                              }
                                            },
                                            "showBorder": false,
                                            "size": "auto"
                                          },
                                          "chartSettings": {
                                            "xAxis": "SubscriptionName"
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "Summary of SQL DBs with or without AHB "
                                      },
                                      {
                                        "type": 1,
                                        "content": {
                                          "json": "### Consumed Licenses\r\nTotal number of SQL licenses cores consumed by all SQL Databases\r\n",
                                          "style": "info"
                                        },
                                        "customWidth": "50",
                                        "name": "Total number of SQL licenses cores consumed"
                                      },
                                      {
                                        "type": 1,
                                        "content": {
                                          "json": "### Number of required Cores to enable SQL Azure Hybrid Benefit\r\nNumber of cores required to enable SQL AHB across the entire environment.\r\n\r\n\r\n",
                                          "style": "info"
                                        },
                                        "customWidth": "50",
                                        "name": "Text SQL DB"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071c2\",\"mergeType\":\"table\",\"leftTable\":\"SQLDB AHB Enabled\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[SQLDB AHB Enabled].SQLDBID\",\"mergedName\":\"SQLDBID\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLName\",\"mergedName\":\"SQLName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].StorageAccountType\",\"mergedName\":\"StorageAccountType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLDBID1\",\"mergedName\":\"SQLDBID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL DB AHB Consumed Cores per VM",
                                          "noDataMessage": "None of your SQL DB have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "SQLName",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQLDB+SKU AHB Enabled - per VM"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071c2\",\"mergeType\":\"table\",\"leftTable\":\"SQLDB AHB Enabled\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[SQLDB AHB Enabled].SQLDBID\",\"mergedName\":\"SQLDBID\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLName\",\"mergedName\":\"SQLName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].StorageAccountType\",\"mergedName\":\"StorageAccountType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Enabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLDBID1\",\"mergedName\":\"SQLDBID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL DB AHB Consumed Cores per Priority",
                                          "noDataMessage": "None of your SQL DB have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "Prioritize AHB?",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQLDB+SKU AHB Enabled - per Priority"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071c2\",\"mergeType\":\"table\",\"leftTable\":\"SQLDB AHB Disabled\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[SQLDB AHB Disabled].SQLDBID\",\"mergedName\":\"SQLDBID\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLName\",\"mergedName\":\"SQLName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].CheckSQLDBAHB\",\"mergedName\":\"CheckSQLDBAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].StorageAccountType\",\"mergedName\":\"StorageAccountType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLDBID1\",\"mergedName\":\"SQLDBID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL DB AHB Cores not enabled per AHB Priority",
                                          "noDataMessage": "All of your SQL DB have AHB enabled.",
                                          "noDataMessageStyle": 3,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "Prioritize AHB?",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQLDB+SKU AHB Disabled - per Priority"
                                      }
                                    ]
                                  },
                                  "name": "SQL DB Info"
                                },
                                {
                                  "type": 9,
                                  "content": {
                                    "version": "KqlParameterItem/1.0",
                                    "parameters": [
                                      {
                                        "id": "ae5e8765-47ef-46a6-803b-6b7124c098d2",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "SQLDBHUBEnabled",
                                        "label": "See SQL  DBs with AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "timeContext": {
                                          "durationMs": 86400000
                                        },
                                        "value": "Yes"
                                      },
                                      {
                                        "id": "f1ac5e53-253c-4afb-8bc5-b1ba2efea3eb",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "SQLDBAHBDisabled",
                                        "label": "See SQL DBs without AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "value": "Yes"
                                      }
                                    ],
                                    "style": "pills",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  "name": "SQL DB Without AHB"
                                },
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071ed\",\"mergeType\":\"table\",\"leftTable\":\"SQLDB AHB Disabled\"}],\"projectRename\":[{\"originalName\":\"[SQLDB AHB Disabled].SQLDBID\",\"mergedName\":\"SQLDBID\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLName\",\"mergedName\":\"SQLName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].CheckSQLDBAHB\",\"mergedName\":\"CheckSQLDBAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].StorageAccountType\",\"mergedName\":\"StorageAccountType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLDB AHB Disabled].SQLDBID1\",\"mergedName\":\"SQLDBID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL DB AHB Disabled",
                                          "noDataMessage": "All of your SQL DBs have AHB enabled.",
                                          "showExportToExcel": true,
                                          "queryType": 7,
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "$gen_group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "Group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "SubscriptionName",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              }
                                            ],
                                            "hierarchySettings": {
                                              "treeType": 1,
                                              "groupBy": [
                                                "SubscriptionName"
                                              ],
                                              "expandTopLevel": true
                                            },
                                            "labelSettings": [
                                              {
                                                "columnId": "SQLDBID",
                                                "label": "Database Name"
                                              },
                                              {
                                                "columnId": "SQLName",
                                                "label": "Server Name"
                                              },
                                              {
                                                "columnId": "SQLRG",
                                                "label": "Resource Group"
                                              },
                                              {
                                                "columnId": "SKUName",
                                                "label": "SKU"
                                              },
                                              {
                                                "columnId": "SKUTier",
                                                "label": "SKU Tier"
                                              },
                                              {
                                                "columnId": "vCores",
                                                "label": "Number of vCore"
                                              },
                                              {
                                                "columnId": "CheckSQLDBAHB",
                                                "label": "Is AHB enabled?"
                                              },
                                              {
                                                "columnId": "SQLLocation",
                                                "label": "Location"
                                              },
                                              {
                                                "columnId": "LicenseType",
                                                "label": "License Type"
                                              },
                                              {
                                                "columnId": "StorageAccountType",
                                                "label": "Storage Account Type"
                                              },
                                              {
                                                "columnId": "SubscriptionName",
                                                "label": "Subscription Name"
                                              },
                                              {
                                                "columnId": "SQLDBID1",
                                                "label": "Resource ID"
                                              }
                                            ]
                                          }
                                        },
                                        "conditionalVisibility": {
                                          "parameterName": "SQLDBAHBDisabled",
                                          "comparison": "isEqualTo",
                                          "value": "Yes"
                                        },
                                        "name": "SQL DB Disabled"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071f9\",\"mergeType\":\"table\",\"leftTable\":\"SQLDB AHB Enabled\"}],\"projectRename\":[{\"originalName\":\"[SQLDB AHB Enabled].SQLDBID\",\"mergedName\":\"SQLDBID\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLName\",\"mergedName\":\"SQLName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].SKUName\",\"mergedName\":\"SKUName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].SKUTier\",\"mergedName\":\"SKUTier\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].StorageAccountType\",\"mergedName\":\"StorageAccountType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLDB AHB Enabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[SQLDB AHB Enabled].SQLDBID1\",\"mergedName\":\"SQLDBID1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL DB AHB Enabled",
                                          "noDataMessage": "None of you SQL DBs have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showExportToExcel": true,
                                          "queryType": 7,
                                          "gridSettings": {
                                            "labelSettings": [
                                              {
                                                "columnId": "SQLDBID",
                                                "label": "Name"
                                              },
                                              {
                                                "columnId": "SQLName",
                                                "label": "Database Name"
                                              },
                                              {
                                                "columnId": "SQLRG",
                                                "label": "Resource Group"
                                              },
                                              {
                                                "columnId": "SKUName",
                                                "label": "SKU"
                                              },
                                              {
                                                "columnId": "SKUTier",
                                                "label": "SKU Tier"
                                              },
                                              {
                                                "columnId": "SQLLocation",
                                                "label": "Location"
                                              },
                                              {
                                                "columnId": "LicenseType",
                                                "label": "License Type"
                                              },
                                              {
                                                "columnId": "StorageAccountType",
                                                "label": "Storage Account Type"
                                              },
                                              {
                                                "columnId": "SubscriptionName",
                                                "label": "Subscription Name"
                                              },
                                              {
                                                "columnId": "vCores",
                                                "label": "Number of vCore"
                                              },
                                              {
                                                "columnId": "SQLDBID1",
                                                "label": "Resource ID"
                                              }
                                            ]
                                          }
                                        },
                                        "conditionalVisibility": {
                                          "parameterName": "SQLDBHUBEnabled",
                                          "comparison": "isEqualTo",
                                          "value": "Yes"
                                        },
                                        "name": "SQL DB AHB Enabled"
                                      }
                                    ]
                                  },
                                  "name": "Load SQL DB Detailed Info"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "SQLDB"
                            },
                            "name": "SQLDBGroup"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "title": "SQL Managed Instance",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"\r\n | extend SubscriptionName=name \r\n | join (resources |  where type =~ 'Microsoft.Sql/managedInstances' and tostring(properties.['licenseType']) == 'LicenseIncluded'\r\n | extend ManagedInstance=id, SQLRG=resourceGroup, SQLLocation=location, vCores=tostring(sku.capacity),LicenseType = tostring(properties.['licenseType'])\r\n | extend CheckSQLMIAHB = case(\r\n type =~ 'Microsoft.Sql/managedInstances', iif((properties.['licenseType'])\r\n has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n\"Not SQL DB\"\r\n    ) \r\n ) on subscriptionId \r\n | project ManagedInstance,SQLRG, SQLLocation, CheckSQLMIAHB, vCores, LicenseType, SubscriptionName\r\n | where SQLRG in ({ResourceGroup})\r\n | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), ManagedInstance=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct ManagedInstance\r\n    )\r\n    on ManagedInstance",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "SQLMIAHBDisabled"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"\r\n | extend SubscriptionName=name \r\n | join (resources |  where type =~ 'Microsoft.Sql/managedInstances' and tostring(properties.['licenseType']) != 'LicenseIncluded'\r\n | extend ManagedInstance=id, SQLRG=resourceGroup, SQLLocation=location, vCores=tostring(sku.capacity),LicenseType = tostring(properties.['licenseType'])\r\n | extend CheckSQLMIAHB = case(\r\n type =~ 'Microsoft.Sql/managedInstances', iif((properties.['licenseType'])\r\n has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n\"Not SQL DB\"\r\n    ) \r\n ) on subscriptionId \r\n | project ManagedInstance,SQLRG, SQLLocation, CheckSQLMIAHB, vCores, LicenseType, SubscriptionName\r\n | where SQLRG in ({ResourceGroup})\r\n  | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), ManagedInstance=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct ManagedInstance\r\n    )\r\n    on ManagedInstance\r\n ",
                                    "size": 0,
                                    "queryType": 1,
                                    "resourceType": "microsoft.resourcegraph/resources",
                                    "crossComponentResources": [
                                      "{Subscription}"
                                    ]
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "AlwaysHidden",
                                    "comparison": "isEqualTo",
                                    "value": "true"
                                  },
                                  "name": "SQLMIAHBEnabled"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "# SQL Managed Instances Azure Hybrid Benefit (AHB) Overview\r\n"
                                  },
                                  "name": "SQL Managed Instances AHB"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "Apply to SQL Server 1 to 4 vCPUs exchange: For every 1 core of SQL Server Enterprise Edition, you get 4 vCPUs of SQL Managed Instance or Azure SQL Database general purpose and Hyperscale tiers, or 4 vCPUs of SQL Server Standard edition on Azure VMs.\r\n\r\nThe SQL virtual machines (VMs) with less than 4 cores are categorized as **Low Priority**, while those with 8 or more cores are classified as **High Priority**. In situations where there are insufficient Azure Hybrid benefit licenses to cover all the VMs in the environment, it is recommended to prioritize the High Priority VMs.",
                                    "style": "info"
                                  },
                                  "name": "Apply to SQL Server 1 to 4 vCPUs exchange"
                                },
                                {
                                  "type": 1,
                                  "content": {
                                    "json": "### AHB Overview\r\nSummary of all SQL Databases with and without SQL AHB.",
                                    "style": "info"
                                  },
                                  "name": "SQL Databases with and without SQL AHB."
                                },
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "loadType": "explicit",
                                    "loadButtonText": "Load SQL MI Info",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\"\r\n | extend SubscriptionName=name \r\n | join (resources |  where type =~ 'Microsoft.Sql/managedInstances' and tostring(properties.['licenseType']) == 'LicenseIncluded'\r\n | extend ManagedInstance=id, SQLRG=resourceGroup, SQLLocation=location, vCores=tostring(sku.capacity),LicenseType = tostring(properties.['licenseType'])\r\n  | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), ManagedInstance=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct ManagedInstance\r\n    )\r\n    on ManagedInstance\r\n | extend CheckSQLMIAHB = case(\r\n type =~ 'Microsoft.Sql/managedInstances', iif((properties.['licenseType'])\r\n has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n\"Not SQL DB\"\r\n    ) \r\n ) on subscriptionId \r\n| project ManagedInstance,SQLRG, SQLLocation, CheckSQLMIAHB, vCores, LicenseType, SubscriptionName\r\n| summarize count() by SubscriptionName, CheckSQLMIAHB",
                                          "size": 0,
                                          "title": "Summary of SQL MI with or without AHB per Subscription",
                                          "showRefreshButton": true,
                                          "queryType": 1,
                                          "resourceType": "microsoft.resourcegraph/resources",
                                          "crossComponentResources": [
                                            "{Subscription}"
                                          ],
                                          "visualization": "table",
                                          "tileSettings": {
                                            "titleContent": {
                                              "columnMatch": "CheckSQLMIAHB",
                                              "formatter": 1
                                            },
                                            "subtitleContent": {
                                              "columnMatch": "SubscriptionName"
                                            },
                                            "leftContent": {
                                              "columnMatch": "count_",
                                              "formatter": 12,
                                              "formatOptions": {
                                                "palette": "auto"
                                              },
                                              "numberFormat": {
                                                "unit": 17,
                                                "options": {
                                                  "maximumSignificantDigits": 3,
                                                  "maximumFractionDigits": 2
                                                }
                                              }
                                            },
                                            "showBorder": false
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "count_"
                                            ],
                                            "group": "CheckSQLMIAHB",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "Summary of SQL MI with or without AHB per subs"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | where tostring (properties.subscriptionPolicies.quotaId) !has \"MSDNDevTest_2014-09-01\" \r\n | extend SubscriptionName=name \r\n | join (resources |  where type =~ 'Microsoft.Sql/managedInstances' and tostring(properties.['licenseType']) == 'LicenseIncluded'\r\n | extend ManagedInstance=id, SQLRG=resourceGroup, SQLLocation=location, vCores=tostring(sku.capacity),LicenseType = tostring(properties.['licenseType'])\r\n  | join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), ManagedInstance=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct ManagedInstance\r\n    )\r\n    on ManagedInstance\r\n | extend CheckSQLMIAHB = case(\r\n type =~ 'Microsoft.Sql/managedInstances', iif((properties.['licenseType'])\r\n has 'LicenseIncluded', \"AHB Not Enabled\", \"AHB Enabled\"),\r\n\"Not SQL DB\"\r\n    ) \r\n ) on subscriptionId \r\n| project ManagedInstance,SQLRG, SQLLocation, CheckSQLMIAHB, vCores, LicenseType, SubscriptionName\r\n| summarize count() by SubscriptionName, CheckSQLMIAHB",
                                          "size": 0,
                                          "title": "Summary of SQL Managed Instance with or without AHB",
                                          "showRefreshButton": true,
                                          "queryType": 1,
                                          "resourceType": "microsoft.resourcegraph/resources",
                                          "crossComponentResources": [
                                            "{Subscription}"
                                          ],
                                          "visualization": "piechart",
                                          "chartSettings": {
                                            "yAxis": [
                                              "count_"
                                            ],
                                            "group": "CheckSQLMIAHB",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "50",
                                        "name": "Summary of SQL MI with or without AHB "
                                      },
                                      {
                                        "type": 1,
                                        "content": {
                                          "json": "### Consumed Licenses\r\nTotal number of SQL licenses cores consumed by all SQL Managed Instances.\r\n",
                                          "style": "info"
                                        },
                                        "customWidth": "50",
                                        "name": "Consumed Licenses"
                                      },
                                      {
                                        "type": 1,
                                        "content": {
                                          "json": "### Number of required Cores to enable SQL Azure Hybrid Benefit\r\nNumber of cores required to enable SQL AHB across the entire environment.\r\n\r\n\r\n",
                                          "style": "info"
                                        },
                                        "customWidth": "50",
                                        "name": "Number of required Cores to enable SQL "
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071c2\",\"mergeType\":\"table\",\"leftTable\":\"SQLMIAHBEnabled\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[SQLDB AHB Enabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[SQLMIAHBEnabled].ManagedInstance\",\"mergedName\":\"ManagedInstance\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].CheckSQLMIAHB\",\"mergedName\":\"CheckSQLMIAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].ManagedInstance1\",\"mergedName\":\"ManagedInstance1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL Managed Instance AHB Consumed Cores per VM",
                                          "noDataMessage": "None of your SQL MI have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "SQLName",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQLMI+SKU AHB Enabled - per VM"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071c2\",\"mergeType\":\"table\",\"leftTable\":\"SQLMIAHBEnabled\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[SQLDB AHB Enabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[SQLMIAHBEnabled].ManagedInstance\",\"mergedName\":\"ManagedInstance\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].CheckSQLMIAHB\",\"mergedName\":\"CheckSQLMIAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBEnabled].ManagedInstance1\",\"mergedName\":\"ManagedInstance1\",\"fromId\":\"unknown\"}]}",
                                          "size": 0,
                                          "title": "SQL Managed Instance AHB Consumed Cores per Priority",
                                          "noDataMessage": "None of your SQL MI have AHB enabled.",
                                          "noDataMessageStyle": 4,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "Prioritize AHB?",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQLMI+SKU AHB Enabled - per Priority"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071c2\",\"mergeType\":\"table\",\"leftTable\":\"SQLMIAHBDisabled\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"4\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"round([\\\"vCPUs\\\"] / 4) * 4\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCores\",\"operator\":\"<\",\"rightValType\":\"static\",\"rightVal\":\"4\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}}]},{\"originalName\":\"[SQLMIAHBDisabled].ManagedInstance\",\"mergedName\":\"ManagedInstance\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBDisabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBDisabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBDisabled].CheckSQLMIAHB\",\"mergedName\":\"CheckSQLMIAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBDisabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBDisabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"},{\"originalName\":\"[SQLMIAHBDisabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071c2\"}]}",
                                          "size": 0,
                                          "title": "SQL Managed Instances AHB Cores not enabled per AHB Priority",
                                          "noDataMessage": "All of your SQL MI have AHB enabled.",
                                          "noDataMessageStyle": 3,
                                          "showRefreshButton": true,
                                          "queryType": 7,
                                          "visualization": "piechart",
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "Prioritize AHB?",
                                                "formatter": 18,
                                                "formatOptions": {
                                                  "thresholdsOptions": "icons",
                                                  "thresholdsGrid": [
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "High Priority",
                                                      "representation": "Sev0",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "==",
                                                      "thresholdValue": "Low Priority",
                                                      "representation": "2",
                                                      "text": "{0}{1}"
                                                    },
                                                    {
                                                      "operator": "Default",
                                                      "thresholdValue": null,
                                                      "representation": "unknown",
                                                      "text": "{0}{1}"
                                                    }
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "chartSettings": {
                                            "yAxis": [
                                              "Consumed Cores"
                                            ],
                                            "group": "Prioritize AHB?",
                                            "createOtherGroup": null
                                          }
                                        },
                                        "customWidth": "33",
                                        "name": "Summary SQLMI+SKU AHB Disabled - per Priority"
                                      }
                                    ]
                                  },
                                  "name": "SQL MI Info"
                                },
                                {
                                  "type": 9,
                                  "content": {
                                    "version": "KqlParameterItem/1.0",
                                    "parameters": [
                                      {
                                        "id": "ae5e8765-47ef-46a6-803b-6b7124c098d2",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "SQLMIAHBEnabled",
                                        "label": "See SQL  MIs with AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "timeContext": {
                                          "durationMs": 86400000
                                        }
                                      },
                                      {
                                        "id": "f1ac5e53-253c-4afb-8bc5-b1ba2efea3eb",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "SQLMIAHBDisabled",
                                        "label": "See SQL MIs without AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n"
                                      }
                                    ],
                                    "style": "pills",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  "name": "SQL MI AHB Disabled"
                                },
                                {
                                  "type": 12,
                                  "content": {
                                    "version": "NotebookGroup/1.0",
                                    "groupType": "editable",
                                    "items": [
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071ed\",\"mergeType\":\"table\",\"leftTable\":\"SQLMIAHBDisabled\"}],\"projectRename\":[{\"originalName\":\"[SQLMIAHBDisabled].ManagedInstance\",\"mergedName\":\"ManagedInstance\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLMIAHBDisabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLMIAHBDisabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLMIAHBDisabled].CheckSQLMIAHB\",\"mergedName\":\"CheckSQLMIAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLMIAHBDisabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLMIAHBDisabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"},{\"originalName\":\"[SQLMIAHBDisabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071ed\"}]}",
                                          "size": 0,
                                          "title": "SQL Managed Instance AHB Disabled",
                                          "noDataMessage": "All of your SQL MIs have AHB enabled.",
                                          "showExportToExcel": true,
                                          "queryType": 7,
                                          "gridSettings": {
                                            "formatters": [
                                              {
                                                "columnMatch": "$gen_group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "Group",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              },
                                              {
                                                "columnMatch": "SubscriptionName",
                                                "formatter": 15,
                                                "formatOptions": {
                                                  "linkTarget": null,
                                                  "showIcon": true
                                                }
                                              }
                                            ],
                                            "hierarchySettings": {
                                              "treeType": 1,
                                              "groupBy": [
                                                "SubscriptionName"
                                              ],
                                              "expandTopLevel": true
                                            }
                                          }
                                        },
                                        "conditionalVisibility": {
                                          "parameterName": "SQLMIAHBDisabled",
                                          "comparison": "isEqualTo",
                                          "value": "Yes"
                                        },
                                        "name": "SQL MI Disabled"
                                      },
                                      {
                                        "type": 3,
                                        "content": {
                                          "version": "KqlItem/1.0",
                                          "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"f65bea23-bb49-4498-b331-c20c618071f9\",\"mergeType\":\"table\",\"leftTable\":\"SQLMIAHBEnabled\"}],\"projectRename\":[{\"originalName\":\"[SQLDB AHB Enabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"unknown\"},{\"originalName\":\"[SQLMIAHBEnabled].ManagedInstance\",\"mergedName\":\"ManagedInstance\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLMIAHBEnabled].SQLRG\",\"mergedName\":\"SQLRG\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLMIAHBEnabled].SQLLocation\",\"mergedName\":\"SQLLocation\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLMIAHBEnabled].CheckSQLMIAHB\",\"mergedName\":\"CheckSQLMIAHB\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLMIAHBEnabled].vCores\",\"mergedName\":\"vCores\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLMIAHBEnabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"},{\"originalName\":\"[SQLMIAHBEnabled].SubscriptionName\",\"mergedName\":\"SubscriptionName\",\"fromId\":\"f65bea23-bb49-4498-b331-c20c618071f9\"}]}",
                                          "size": 0,
                                          "title": "SQL Managed Instance AHB Enabled",
                                          "noDataMessage": "None of you SQL MIs have AHB enabled.",
                                          "showExportToExcel": true,
                                          "queryType": 7
                                        },
                                        "conditionalVisibility": {
                                          "parameterName": "SQLMIAHBEnabled",
                                          "comparison": "isEqualTo",
                                          "value": "Yes"
                                        },
                                        "name": "SQL MI AHB Enabled"
                                      }
                                    ]
                                  },
                                  "name": "SQL MI Detailed"
                                }
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "SelectedSubTab",
                              "comparison": "isEqualTo",
                              "value": "SQLMI"
                            },
                            "name": "SQL MI"
                          }
                        ]
                      },
                      "conditionalVisibility": {
                        "parameterName": "SelectedTab",
                        "comparison": "isEqualTo",
                        "value": "SQL"
                      },
                      "name": "SQLAHB"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "title": "Linux Hybrid Benefit",
                        "loadType": "explicit",
                        "loadButtonText": "Load Linux Recommendations",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "## Linux Azure Hybrid Benefit (AHB) Overview"
                            },
                            "name": "Linux Text"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "{\"version\":\"ARMEndpoint/1.0\",\"data\":null,\"headers\":[],\"method\":\"GET\",\"path\":\"/subscriptions/{SingleSubHidden}/providers/Microsoft.Compute/skus?$filter=location eq '{Location}'\",\"urlParams\":[{\"key\":\"api-version\",\"value\":\"2021-07-01\"}],\"batchDisabled\":false,\"transformers\":[{\"type\":\"jsonpath\",\"settings\":{\"tablePath\":\"$.*[?(@.resourceType=='virtualMachines')]\",\"columns\":[{\"path\":\"name\",\"columnid\":\"Name\"},{\"path\":\"capabilities[?(@.name=='vCPUs')].value\",\"columnid\":\"vCPUs\"},{\"path\":\"capabilities[?(@.name=='MemoryGB')].value\",\"columnid\":\"MemoryGB\"},{\"path\":\"capabilities[?(@.name=='MaxNetworkInterfaces')].value\",\"columnid\":\"MaxNetworkInterfaces\"},{\"path\":\"capabilities[?(@.name=='HyperVGenerations')].value\",\"columnid\":\"HyperVGenerations\"},{\"path\":\"capabilities[?(@.name=='vCPUsPerCore')].value\",\"columnid\":\"vCPUsPerCore\"}]}}]}",
                              "size": 0,
                              "title": "Get VM vCPU",
                              "exportParameterName": "ResourceSKU",
                              "showExportToExcel": true,
                              "queryType": 12,
                              "gridSettings": {
                                "rowLimit": 5000
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "AlwaysHidden",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "API-Get_VMLinux_SKU"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| where isnull ((properties.['licenseType']))\r\n| extend LinuxId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.publisher), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']), VMSSize=tostring(sku.name)\r\n| order by type asc \r\n| project LinuxId,VMName,VMRG,VMSize, VMSSize, VMLocation,OSType, OsVersion,LicenseType\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), LinuxId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct LinuxId\r\n    )\r\n    on LinuxId",
                              "size": 0,
                              "title": "AHB Disabled",
                              "noDataMessage": "None of your Linux VMs have AHB enabled.",
                              "noDataMessageStyle": 4,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "AlwaysHidden",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "LinuxAHBDisabled"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| where isnotnull ((properties.['licenseType']))\r\n| extend LinuxId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.storageProfile.imageReference.publisher), OsVersion = tostring(properties.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.['licenseType']), VMSSize=tostring(sku.name)\r\n| order by type asc \r\n| project LinuxId,VMName,VMRG,VMSize, VMSSize, VMLocation,OSType, OsVersion,LicenseType\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), LinuxId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct LinuxId\r\n    )\r\n    on LinuxId",
                              "size": 0,
                              "title": "AHB Enabled",
                              "noDataMessage": "All of your Linux VMs have AHB enabled.",
                              "noDataMessageStyle": 3,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "AlwaysHidden",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "LinuxAHBRGEnabled"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualmachines' and (properties.storageProfile.imageReference.publisher == 'suse' or properties.storageProfile.imageReference.publisher=='RedHat')\r\n| extend LicenseType = tostring(properties.['licenseType'])\r\n| extend LinuxId=id\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), LinuxId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct LinuxId\r\n    )\r\n    on LinuxId\r\n| extend CheckAHBLinux = case(\r\n     type == 'microsoft.compute/virtualmachines' or type =~ 'microsoft.compute/virtualMachineScaleSets',\r\n     iff(isnull((properties.['licenseType'])),\r\n      \"AHB Not Enabled\", \"AHB Enabled\"),\r\n     \"Not Linux\"\r\n     )\r\n| summarize count() by CheckAHBLinux",
                              "size": 0,
                              "title": "Summary of Linux VMs with or without AHB",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ],
                              "visualization": "piechart"
                            },
                            "customWidth": "50",
                            "name": "Summary of Linux VMs with or without AHB"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "resourcechanges\r\n| where properties.changeType == \"Update\" and properties.targetResourceType == \"microsoft.compute/virtualmachines\"\r\n| mv-expand changes = properties.changes\r\n| mv-expand LicenseChanges=changes.['properties.licenseType']\r\n| where isnotnull(LicenseChanges)\r\n| where  tostring(LicenseChanges.newValue) has \"SLES_BYOS\" or tostring(LicenseChanges.newValue) has \"RHEL_BYOS\"\r\n| project VMID=properties.targetResourceId, NewLicense=tostring(LicenseChanges.newValue), DateofChange=tostring(properties.changeAttributes.timestamp)\r\n",
                              "size": 0,
                              "title": "Linux VM Latest Change Last 7 days",
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ]
                            },
                            "conditionalVisibility": {
                              "parameterName": "AlwaysHidden",
                              "comparison": "isEqualTo",
                              "value": "true"
                            },
                            "name": "Linux VM Latest Change Last 7 days"
                          },
                          {
                            "type": 9,
                            "content": {
                              "version": "KqlParameterItem/1.0",
                              "parameters": [
                                {
                                  "id": "ae5e8765-47ef-46a6-803b-6b7124c098d2",
                                  "version": "KqlParameterItem/1.0",
                                  "name": "LinuxAHBEnabled",
                                  "label": "See Linux VMs with AHB",
                                  "type": 2,
                                  "isRequired": true,
                                  "typeSettings": {
                                    "additionalResourceOptions": [],
                                    "showDefault": false
                                  },
                                  "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                  "timeContext": {
                                    "durationMs": 86400000
                                  }
                                },
                                {
                                  "id": "439c7c8d-4119-4328-b4ca-2b1e676ede28",
                                  "version": "KqlParameterItem/1.0",
                                  "name": "LinuxEnabledPast7D",
                                  "label": "See Linux VMs enabled last 7 days",
                                  "type": 2,
                                  "isRequired": true,
                                  "typeSettings": {
                                    "additionalResourceOptions": [],
                                    "showDefault": false
                                  },
                                  "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                  "timeContext": {
                                    "durationMs": 86400000
                                  }
                                },
                                {
                                  "id": "4c3ff9fa-d9c8-4d35-94d4-48ba3a1547fd",
                                  "version": "KqlParameterItem/1.0",
                                  "name": "LinuxAHBDisabled",
                                  "label": "See Linux VMs without AHB",
                                  "type": 2,
                                  "isRequired": true,
                                  "typeSettings": {
                                    "additionalResourceOptions": []
                                  },
                                  "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                  "timeContext": {
                                    "durationMs": 86400000
                                  }
                                }
                              ],
                              "style": "pills",
                              "queryType": 0,
                              "resourceType": "microsoft.operationalinsights/workspaces"
                            },
                            "name": "Linux VMs without AHB"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "List of Linux VMs with Hybrid Benefit groupped by Subscription."
                            },
                            "conditionalVisibility": {
                              "parameterName": "LinuxAHBEnabled",
                              "comparison": "isEqualTo",
                              "value": "Yes"
                            },
                            "name": "Linux VMs with Hybrid Benefit"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\",\"mergeType\":\"inner\",\"leftTable\":\"LinuxAHBRGEnabled\",\"rightTable\":\"API-Get_VMLinux_SKU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[LinuxAHBRGEnabled].LinuxId\",\"mergedName\":\"VM ID\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBRGEnabled].LinuxId1\",\"mergedName\":\"LinuxId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[LinuxAHBEnabled].VMName\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\"},{\"originalName\":\"[API-Get_VM_SKU].Name\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\"},{\"originalName\":\"[LinuxAHBEnabled].VMSSize\"},{\"originalName\":\"[LinuxAHBRGEnabled].VMName\"},{\"originalName\":\"[LinuxAHBRGEnabled].VMSSize\"}]}",
                              "size": 0,
                              "title": "Linux VMs with AHB",
                              "noDataMessage": "None of your Linux VMs have AHB enabled",
                              "noDataMessageStyle": 4,
                              "showExportToExcel": true,
                              "queryType": 7,
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Prioritize AHB?",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "High Priority",
                                          "representation": "Sev0",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Sev4",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  }
                                ]
                              },
                              "tileSettings": {
                                "showBorder": false,
                                "titleContent": {
                                  "columnMatch": "NewLicense",
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "vCPUs",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "auto"
                                  },
                                  "numberFormat": {
                                    "unit": 17,
                                    "options": {
                                      "maximumSignificantDigits": 3,
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                }
                              },
                              "chartSettings": {
                                "xAxis": "VM Name",
                                "yAxis": [
                                  "Consumed Cores per VM"
                                ],
                                "group": null,
                                "createOtherGroup": 0,
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Consumed Cores per VM",
                                    "color": "grayBlue"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "LinuxAHBEnabled",
                              "comparison": "isEqualTo",
                              "value": "Yes"
                            },
                            "name": "Linux-VM+SKU+vCores-AHB"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "List of Linux VMs without Hybrid Benefit groupped by Subscription."
                            },
                            "conditionalVisibility": {
                              "parameterName": "LinuxAHBDisabled",
                              "comparison": "isEqualTo",
                              "value": "Yes"
                            },
                            "name": "LinuxAHBDisabled"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\",\"mergeType\":\"inner\",\"leftTable\":\"LinuxAHBDisabled\",\"rightTable\":\"API-Get_VMLinux_SKU\",\"leftColumn\":\"VMSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[LinuxAHBDisabled].LinuxId\",\"mergedName\":\"LinuxId\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[API-Get_VMLinux_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"8a27a7d8-5ea8-4408-ac20-2fc4e65ca095\"},{\"originalName\":\"[LinuxAHBDisabled].LinuxId1\",\"mergedName\":\"LinuxId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[LinuxAHBEnabled].VMName\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\"},{\"originalName\":\"[API-Get_VM_SKU].Name\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\"},{\"originalName\":\"[LinuxAHBEnabled].VMSSize\"}]}",
                              "size": 0,
                              "title": "Linux VMs without AHB",
                              "noDataMessage": "None of your Linux VMs have AHB enabled",
                              "noDataMessageStyle": 4,
                              "showExportToExcel": true,
                              "queryType": 7,
                              "gridSettings": {
                                "formatters": [
                                  {
                                    "columnMatch": "Prioritize AHB?",
                                    "formatter": 18,
                                    "formatOptions": {
                                      "thresholdsOptions": "icons",
                                      "thresholdsGrid": [
                                        {
                                          "operator": "==",
                                          "thresholdValue": "High Priority",
                                          "representation": "Sev0",
                                          "text": "{0}{1}"
                                        },
                                        {
                                          "operator": "Default",
                                          "thresholdValue": null,
                                          "representation": "Sev4",
                                          "text": "{0}{1}"
                                        }
                                      ]
                                    },
                                    "numberFormat": {
                                      "unit": 17,
                                      "options": {
                                        "style": "decimal"
                                      }
                                    }
                                  }
                                ]
                              },
                              "tileSettings": {
                                "showBorder": false,
                                "titleContent": {
                                  "columnMatch": "NewLicense",
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "vCPUs",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "auto"
                                  },
                                  "numberFormat": {
                                    "unit": 17,
                                    "options": {
                                      "maximumSignificantDigits": 3,
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                }
                              },
                              "chartSettings": {
                                "xAxis": "VM Name",
                                "yAxis": [
                                  "Consumed Cores per VM"
                                ],
                                "group": null,
                                "createOtherGroup": 0,
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Consumed Cores per VM",
                                    "color": "grayBlue"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "LinuxAHBDisabled",
                              "comparison": "isEqualTo",
                              "value": "Yes"
                            },
                            "name": "Linux-VM+SKU+vCores-AHBDisabled"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d8deb22b-a596-43ee-acc4-180849d26168\",\"mergeType\":\"inner\",\"leftTable\":\"Linux VM Latest Change Last 7 days\",\"rightTable\":\"Linux-VM+SKU+vCores-AHB\",\"leftColumn\":\"VMID\",\"rightColumn\":\"VM ID\"}],\"projectRename\":[{\"originalName\":\"[Linux VM Latest Change Last 7 days].VMID\",\"mergedName\":\"VMID\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux VM Latest Change Last 7 days].NewLicense\",\"mergedName\":\"NewLicense\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux VM Latest Change Last 7 days].DateofChange\",\"mergedName\":\"DateofChange\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].VM ID\",\"mergedName\":\"VM ID\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].Name\",\"mergedName\":\"Name\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26168\"},{\"originalName\":\"[Linux VM Latest Change Last 7 days].VMID\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].vCPUs\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].OSType\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].OsVersion\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].LicenseType\"},{\"originalName\":\"[Linux-VM+SKU+vCores-AHB].vCPUsPerCore\"}]}",
                              "size": 0,
                              "title": "Linux Total Cores Enabled last 7 Days",
                              "noDataMessage": "There wasn't any Linux AHB was enabled in the last 7 days.",
                              "showExportToExcel": true,
                              "queryType": 7,
                              "visualization": "table",
                              "tileSettings": {
                                "showBorder": false,
                                "titleContent": {
                                  "columnMatch": "NewLicense",
                                  "formatter": 1
                                },
                                "leftContent": {
                                  "columnMatch": "vCPUs",
                                  "formatter": 12,
                                  "formatOptions": {
                                    "palette": "auto"
                                  },
                                  "numberFormat": {
                                    "unit": 17,
                                    "options": {
                                      "maximumSignificantDigits": 3,
                                      "maximumFractionDigits": 2
                                    }
                                  }
                                }
                              },
                              "chartSettings": {
                                "group": null,
                                "createOtherGroup": 0,
                                "seriesLabelSettings": [
                                  {
                                    "seriesName": "Consumed Cores per VM",
                                    "color": "grayBlue"
                                  }
                                ]
                              }
                            },
                            "conditionalVisibility": {
                              "parameterName": "LinuxEnabledPast7D",
                              "comparison": "isEqualTo",
                              "value": "Yes"
                            },
                            "name": "Linux Total Cores Enabled last 7 Days"
                          }
                        ]
                      },
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedSubTab",
                          "comparison": "isEqualTo",
                          "value": "LinuxVM"
                        },
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isEqualTo",
                          "value": "VM"
                        }
                      ],
                      "name": "Linux"
                    },
                    {
                      "type": 12,
                      "content": {
                        "version": "NotebookGroup/1.0",
                        "groupType": "editable",
                        "title": "VMSS",
                        "items": [
                          {
                            "type": 1,
                            "content": {
                              "json": "## Windows Azure Hybrid Benefit (AHB) Overview - VM Scale Set"
                            },
                            "name": "AHB Overview - VM Scale Set"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "Each two-processor license or each set of 16-core licenses, either Datacenter or Standard editions, are entitled to two instances of up to 8 cores, or one instance of up to 16 cores.\r\n\r\nThe virtual machines (VMs) with less than 8 cores are categorized as **Low Priority**, while those with 8 or more cores are classified as **High Priority**. In situations where there are insufficient Azure Hybrid benefit licenses to cover all the VMs in the environment, it is recommended to prioritize the High Priority VMs.",
                              "style": "info"
                            },
                            "name": "Each two-processor license or each set of 16-core licenses"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name \r\n| join (\r\nresources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows' and tostring(properties.virtualMachineProfile.licenseType) == \"Windows_Server\"\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType), OSVersion = tostring(properties.virtualMachineProfile.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.virtualMachineProfile.licenseType), VMSSize=tostring(sku.name)\r\n    ) on subscriptionId \r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMSSize, VMLocation,OSType, OSVersion,LicenseType, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId",
                              "size": 0,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ]
                            },
                            "conditionalVisibilities": [
                              {
                                "parameterName": "LoadVMSSTab",
                                "comparison": "isEqualTo",
                                "value": "Yes"
                              },
                              {
                                "parameterName": "AlwaysHidden",
                                "comparison": "isEqualTo",
                                "value": "True"
                              }
                            ],
                            "name": "VMSSAHBEnabled-RG"
                          },
                          {
                            "type": 3,
                            "content": {
                              "version": "KqlItem/1.0",
                              "query": "ResourceContainers | where type =~ 'Microsoft.Resources/subscriptions' | extend SubscriptionName=name \r\n| join (\r\nresources \r\n| where resourceGroup in ({ResourceGroup})\r\n| where type =~ 'microsoft.compute/virtualMachineScaleSets'\r\n| where tostring(properties.storageProfile.osDisk.osType) == 'Windows' or tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType) == 'Windows'\r\n| where tostring(properties.['licenseType']) !has 'Windows' and tostring(properties.virtualMachineProfile.['licenseType']) !has 'Windows'\r\n| extend WindowsId=id, VMName=name, VMLocation=location, VMRG=resourceGroup, OSType=tostring(properties.virtualMachineProfile.storageProfile.osDisk.osType), OsVersion = tostring(properties.virtualMachineProfile.storageProfile.imageReference.sku), VMSize=tostring (properties.hardwareProfile.vmSize), LicenseType = tostring(properties.virtualMachineProfile.licenseType), VMSSize=tostring(sku.name)\r\n    ) on subscriptionId \r\n| order by type asc \r\n| project WindowsId,VMName,VMRG,VMSize, VMSSize, VMLocation,OSType, OsVersion,LicenseType, subscriptionId\r\n| join kind = innerunique(\r\n    resources\r\n    | extend replaced_tags = replace('{}', 'null', tostring(tags))\r\n    | extend replaced_tags = parse_json(replaced_tags)\r\n    | mv-expand replaced_tags\r\n    | extend tagName = tostring(bag_keys(replaced_tags)[0])\r\n    | extend tagValue = tostring(replaced_tags['{TagName}']), WindowsId=id\r\n    | where tagName has '{TagName}' and tagValue has '{TagValue}'\r\n    | distinct WindowsId\r\n    )\r\n    on WindowsId\r\n",
                              "size": 0,
                              "queryType": 1,
                              "resourceType": "microsoft.resourcegraph/resources",
                              "crossComponentResources": [
                                "{Subscription}"
                              ]
                            },
                            "conditionalVisibilities": [
                              {
                                "parameterName": "LoadVMSSTab",
                                "comparison": "isEqualTo",
                                "value": "Yes"
                              },
                              {
                                "parameterName": "AlwaysHidden",
                                "comparison": "isEqualTo",
                                "value": "True"
                              }
                            ],
                            "name": "VMSSAHBDisabled-RG"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "### Consumed Licenses\r\nTotal number of Windows licenses cores consumed by all Windows virtual machines.\r\n",
                              "style": "info"
                            },
                            "customWidth": "50",
                            "name": "Windows virtual machine"
                          },
                          {
                            "type": 1,
                            "content": {
                              "json": "### Number of required Cores to enable Windows Azure Hybrid Benefit\r\nNumber of cores required to enable AHB across the entire environment.",
                              "style": "info"
                            },
                            "customWidth": "50",
                            "name": "Number of required Cores to AHB"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "loadType": "explicit",
                              "loadButtonText": "Load VMSS Info",
                              "items": [
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"VMSSAHBEnabled-RG\",\"rightTable\":\"API-Get_VM_SKU\",\"leftColumn\":\"VMSSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\" ([\\\"vCPUs\\\"] + 7) & ~7\"}}]},{\"originalName\":\"[query - 0].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSVersion\",\"mergedName\":\"OSVersion\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"unknown\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId\"},{\"originalName\":\"[WindowsAHBEnabled].VMRG\"},{\"originalName\":\"[WindowsAHBEnabled].VMLocation\"},{\"originalName\":\"[WindowsAHBEnabled].OSType\"},{\"originalName\":\"[WindowsAHBEnabled].OsVersion\"},{\"originalName\":\"[WindowsAHBEnabled].LicenseType\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\"}]}",
                                    "size": 0,
                                    "title": "Cores not enabled per AHB Priority",
                                    "noDataMessage": "All of your VMs have AHB enabled",
                                    "noDataMessageStyle": 4,
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "piechart",
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "Sev4",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        }
                                      ]
                                    },
                                    "chartSettings": {
                                      "yAxis": [
                                        "Consumed Cores per VM"
                                      ],
                                      "group": "Prioritize AHB?",
                                      "createOtherGroup": null
                                    }
                                  },
                                  "customWidth": "33",
                                  "name": "Cores NOT enabled per AHB Priority"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"VMSSAHBEnabled-RG\",\"rightTable\":\"API-Get_VM_SKU\",\"leftColumn\":\"VMSSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"High Priority\\\"\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"\\\"Low Priority\\\"\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\" ([\\\"vCPUs\\\"] + 7) & ~7\"}}]},{\"originalName\":\"[WindowsAHBEnabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSVersion\",\"mergedName\":\"OSVersion\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"},{\"originalName\":\"[WindowsAHBEnabled].WindowsId\"},{\"originalName\":\"[WindowsAHBEnabled].VMRG\"},{\"originalName\":\"[WindowsAHBEnabled].VMLocation\"},{\"originalName\":\"[WindowsAHBEnabled].OSType\"},{\"originalName\":\"[WindowsAHBEnabled].OsVersion\"},{\"originalName\":\"[WindowsAHBEnabled].LicenseType\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\"}]}",
                                    "size": 0,
                                    "title": "Consumed Cores per AHB Priority",
                                    "noDataMessage": "None of your VMs have AHB enabled",
                                    "noDataMessageStyle": 4,
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "piechart",
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "Sev4",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        }
                                      ]
                                    }
                                  },
                                  "customWidth": "33",
                                  "name": "Consumed Cores per AHB Priority"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"d8deb22b-a596-43ee-acc4-180849d26130\",\"mergeType\":\"inner\",\"leftTable\":\"VMSSAHBEnabled-RG\",\"rightTable\":\"API-Get_VM_SKU\",\"leftColumn\":\"VMSSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[Added column]\",\"mergedName\":\"ConsumedCores\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"vCPUs\\\"] + 7) & ~7\"}}]},{\"originalName\":\"[WindowsAHBEnabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSVersion\",\"mergedName\":\"OSVersion\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"d8deb22b-a596-43ee-acc4-180849d26130\"},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId1\",\"mergedName\":\"WindowsId1\",\"fromId\":\"unknown\"}]}",
                                    "size": 0,
                                    "title": "Consumed Cores per VMSS",
                                    "showRefreshButton": true,
                                    "queryType": 7,
                                    "visualization": "piechart",
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "ConsumedCores",
                                          "formatter": 0,
                                          "formatOptions": {
                                            "aggregation": "Sum"
                                          }
                                        }
                                      ]
                                    },
                                    "tileSettings": {
                                      "titleContent": {},
                                      "leftContent": {
                                        "columnMatch": "ConsumedCores",
                                        "formatter": 12,
                                        "formatOptions": {
                                          "palette": "blue"
                                        }
                                      },
                                      "showBorder": false
                                    },
                                    "graphSettings": {
                                      "type": 0
                                    },
                                    "chartSettings": {
                                      "yAxis": [
                                        "ConsumedCores"
                                      ],
                                      "group": "VMName",
                                      "createOtherGroup": null
                                    }
                                  },
                                  "customWidth": "33",
                                  "name": "Consumed Cores per VMSS"
                                }
                              ]
                            },
                            "name": "VMSS RG Overview"
                          },
                          {
                            "type": 12,
                            "content": {
                              "version": "NotebookGroup/1.0",
                              "groupType": "editable",
                              "items": [
                                {
                                  "type": 9,
                                  "content": {
                                    "version": "KqlParameterItem/1.0",
                                    "parameters": [
                                      {
                                        "id": "ae5e8765-47ef-46a6-803b-6b7124c098d2",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "VMSSAHBEnabled",
                                        "label": "See VMSS with AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n",
                                        "timeContext": {
                                          "durationMs": 86400000
                                        }
                                      },
                                      {
                                        "id": "f1ac5e53-253c-4afb-8bc5-b1ba2efea3eb",
                                        "version": "KqlParameterItem/1.0",
                                        "name": "VMSSAHBDisabled",
                                        "label": "See VMSS without AHB",
                                        "type": 2,
                                        "isRequired": true,
                                        "typeSettings": {
                                          "additionalResourceOptions": [],
                                          "showDefault": false
                                        },
                                        "jsonData": "[\r\n    {\"value\":\"Yes\"},\r\n    {\"value\":\"No\", \"selected\":true}\r\n]\r\n\r\n"
                                      }
                                    ],
                                    "style": "pills",
                                    "queryType": 0,
                                    "resourceType": "microsoft.operationalinsights/workspaces"
                                  },
                                  "name": "VMSS Without AHB"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"VMSSAHBEnabled-RG\",\"rightTable\":\"API-Get_VM_SKU\",\"leftColumn\":\"VMSSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[WindowsAHBEnabled].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"static\",\"resultVal\":\"High Priority\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Low Priority\"}}]},{\"originalName\":\"[Added column]\",\"mergedName\":\"Consumed Cores per VM\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\"<=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"expression\",\"resultVal\":\"8\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"expression\",\"resultVal\":\"([\\\"vCPUs\\\"] + 7) & ~7\"}}]},{\"originalName\":\"[VMSSAHBEnabled-RG].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].OSVersion\",\"mergedName\":\"OSVersion\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBEnabled-RG].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - 0].VMName\"},{\"originalName\":\"[query - 0].VMSSize\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[WindowsAHBEnabled].VMSSize\"},{\"originalName\":\"[WindowsAHBEnabled].VMName\"},{\"originalName\":\"[VMSSAHBEnabled].VMSize\"},{\"originalName\":\"[VMSSAHBEnabled].VMName\"},{\"originalName\":\"[VMSSAHBEnabled-Tag].VMName\"},{\"originalName\":\"[VMSSAHBEnabled-Tag].VMSize\"}]}",
                                    "size": 0,
                                    "title": "VMSS with AHB",
                                    "noDataMessage": "None of your VMSS have AHB enabled",
                                    "noDataMessageStyle": 4,
                                    "showExportToExcel": true,
                                    "queryType": 7,
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "$gen_group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "2",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        },
                                        {
                                          "columnMatch": "subscriptionId",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Subscription Name",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        }
                                      ],
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "subscriptionId"
                                        ],
                                        "expandTopLevel": true
                                      }
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "VMSSAHBEnabled",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "VMSS+SKU+vCores-AHB"
                                },
                                {
                                  "type": 3,
                                  "content": {
                                    "version": "KqlItem/1.0",
                                    "query": "{\"version\":\"Merge/1.0\",\"merges\":[{\"id\":\"50d79765-aad4-437e-a90b-8cc7865e7081\",\"mergeType\":\"inner\",\"leftTable\":\"VMSSAHBDisabled-RG\",\"rightTable\":\"API-Get_VM_SKU\",\"leftColumn\":\"VMSSize\",\"rightColumn\":\"Name\"}],\"projectRename\":[{\"originalName\":\"[query - 0].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[query - 0].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"unknown\"},{\"originalName\":\"[Added column]\",\"mergedName\":\"Prioritize AHB?\",\"fromId\":null,\"isNewItem\":true,\"newItemData\":[{\"criteriaContext\":{\"leftOperand\":\"vCPUs\",\"operator\":\">=\",\"rightValType\":\"static\",\"rightVal\":\"8\",\"resultValType\":\"static\",\"resultVal\":\"High Priority\"}},{\"criteriaContext\":{\"operator\":\"Default\",\"rightValType\":\"column\",\"resultValType\":\"static\",\"resultVal\":\"Low Priority\"}}]},{\"originalName\":\"[VMSSAHBDisabled-RG].WindowsId\",\"mergedName\":\"WindowsId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].VMName\",\"mergedName\":\"VMName\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].VMRG\",\"mergedName\":\"VMRG\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].VMSize\",\"mergedName\":\"VMSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].VMSSize\",\"mergedName\":\"VMSSize\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].VMLocation\",\"mergedName\":\"VMLocation\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].OSType\",\"mergedName\":\"OSType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].OsVersion\",\"mergedName\":\"OsVersion\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].LicenseType\",\"mergedName\":\"LicenseType\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[VMSSAHBDisabled-RG].subscriptionId\",\"mergedName\":\"subscriptionId\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].Name\",\"mergedName\":\"Name\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUs\",\"mergedName\":\"vCPUs\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].MemoryGB\",\"mergedName\":\"MemoryGB\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].MaxNetworkInterfaces\",\"mergedName\":\"MaxNetworkInterfaces\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].HyperVGenerations\",\"mergedName\":\"HyperVGenerations\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[API-Get_VM_SKU].vCPUsPerCore\",\"mergedName\":\"vCPUsPerCore\",\"fromId\":\"50d79765-aad4-437e-a90b-8cc7865e7081\"},{\"originalName\":\"[query - 0].VMName\"},{\"originalName\":\"[query - 0].VMSSize\"},{\"originalName\":\"[query - Get VM vCPU].Name\"},{\"originalName\":\"[query - Get VM vCPU].MemoryGB\"},{\"originalName\":\"[query - Get VM vCPU].MaxNetworkInterfaces\"},{\"originalName\":\"[query - Get VM vCPU].HyperVGenerations\"},{\"originalName\":\"[query - Get VM vCPU].vCPUsPerCore\"},{\"originalName\":\"[VMSS-AHB-Disabled].VMName\"},{\"originalName\":\"[VMSS-AHB-Disabled-Tag].VMSize\"},{\"originalName\":\"[VMSS-AHB-Disabled-Tag].VMName\"}]}",
                                    "size": 0,
                                    "title": "VMSS without AHB",
                                    "noDataMessage": "All of your VMSS have AHB enabled",
                                    "noDataMessageStyle": 3,
                                    "showExportToExcel": true,
                                    "queryType": 7,
                                    "gridSettings": {
                                      "formatters": [
                                        {
                                          "columnMatch": "$gen_group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Group",
                                          "formatter": 15,
                                          "formatOptions": {
                                            "linkTarget": null,
                                            "showIcon": true
                                          }
                                        },
                                        {
                                          "columnMatch": "Prioritize AHB?",
                                          "formatter": 18,
                                          "formatOptions": {
                                            "thresholdsOptions": "icons",
                                            "thresholdsGrid": [
                                              {
                                                "operator": "==",
                                                "thresholdValue": "High Priority",
                                                "representation": "Sev0",
                                                "text": "{0}{1}"
                                              },
                                              {
                                                "operator": "Default",
                                                "thresholdValue": null,
                                                "representation": "Sev4",
                                                "text": "{0}{1}"
                                              }
                                            ]
                                          },
                                          "numberFormat": {
                                            "unit": 17,
                                            "options": {
                                              "style": "decimal"
                                            }
                                          }
                                        }
                                      ],
                                      "hierarchySettings": {
                                        "treeType": 1,
                                        "groupBy": [
                                          "subscriptionId"
                                        ],
                                        "expandTopLevel": true
                                      }
                                    }
                                  },
                                  "conditionalVisibility": {
                                    "parameterName": "VMSSAHBDisabled",
                                    "comparison": "isEqualTo",
                                    "value": "Yes"
                                  },
                                  "name": "VMSS+SKU+vCores"
                                }
                              ]
                            },
                            "name": "VMSS RG Details"
                          }
                        ]
                      },
                      "conditionalVisibilities": [
                        {
                          "parameterName": "SelectedSubTab",
                          "comparison": "isEqualTo",
                          "value": "VMSS"
                        },
                        {
                          "parameterName": "SelectedTab",
                          "comparison": "isEqualTo",
                          "value": "VM"
                        }
                      ],
                      "name": "VMSS-RG"
                    }
                  ]
                },
                "conditionalVisibilities": [
                  {
                    "parameterName": "selectedRateOptimizationTab",
                    "comparison": "isEqualTo",
                    "value": "AHB"
                  },
                  {
                    "parameterName": "SelectedTab",
                    "comparison": "isEqualTo",
                    "value": "RateOptimization"
                  }
                ],
                "name": "AHB Overview"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedTab",
            "comparison": "isEqualTo",
            "value": "RateOptimization"
          },
          "name": "group - RateOptimization group"
        },
        {
          "type": 11,
          "content": {
            "version": "LinkItem/1.0",
            "style": "tabs",
            "links": [
              {
                "id": "6b8c0a46-6867-498b-9a3e-799a2475a11a",
                "cellValue": "selectedOverviewTab",
                "linkTarget": "parameter",
                "linkLabel": "Welcome",
                "subTarget": "instructions",
                "style": "link"
              },
              {
                "id": "da748ed1-f329-42d4-962d-9b2339baf7c4",
                "cellValue": "selectedOverviewTab",
                "linkTarget": "parameter",
                "linkLabel": "Resources overview",
                "subTarget": "resourcesMap",
                "style": "link"
              },
              {
                "id": "a4b4de18-b90e-4212-86a2-ea5fabc4f40c",
                "cellValue": "selectedOverviewTab",
                "linkTarget": "parameter",
                "linkLabel": "Security recommendations",
                "subTarget": "securityRecommendations",
                "style": "link"
              },
              {
                "id": "a18f24d2-3320-4c53-a86d-db32c920c8f7",
                "cellValue": "selectedOverviewTab",
                "linkTarget": "parameter",
                "linkLabel": "Reliability recommendations",
                "subTarget": "reliabilityRecommendations",
                "style": "link"
              }
            ]
          },
          "conditionalVisibility": {
            "parameterName": "SelectedTab",
            "comparison": "isEqualTo",
            "value": "Welcome"
          },
          "name": "tabs - overview tabs"
        },
        {
          "type": 9,
          "content": {
            "version": "KqlParameterItem/1.0",
            "parameters": [
              {
                "id": "6a9ccf8c-9f3e-4ee0-b45b-f511401f8656",
                "version": "KqlParameterItem/1.0",
                "name": "mapSubscriptions",
                "label": "Subscriptions",
                "type": 6,
                "multiSelect": true,
                "quote": "'",
                "delimiter": ",",
                "typeSettings": {
                  "additionalResourceOptions": [
                    "value::all"
                  ],
                  "includeAll": true
                },
                "timeContext": {
                  "durationMs": 86400000
                },
                "defaultValue": "value::all",
                "value": [
                  "value::all"
                ]
              }
            ],
            "style": "pills",
            "queryType": 0,
            "resourceType": "microsoft.operationalinsights/workspaces"
          },
          "conditionalVisibilities": [
            {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Welcome"
            },
            {
              "parameterName": "selectedOverviewTab",
              "comparison": "isNotEqualTo",
              "value": "instructions"
            }
          ],
          "name": "parameters - OverviewSubscriptions"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"Security\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=tostring(properties.impact),Recommendation=tostring(properties.shortDescription.problem),subscriptionId",
                  "size": 0,
                  "title": "Azure Advisor security recommendations",
                  "noDataMessage": "You are following all of our security recommendations for the selected subscriptions.",
                  "noDataMessageStyle": 3,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{mapSubscriptions}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Impact",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "High",
                              "representation": "red",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Medium",
                              "representation": "orange",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Low",
                              "representation": "blue",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "subscriptionId",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": null,
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "resourceGroup",
                        "formatter": 14,
                        "formatOptions": {
                          "linkTarget": null,
                          "showIcon": true
                        }
                      }
                    ],
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "Impact"
                      ]
                    }
                  }
                },
                "name": "query - advisorSecurityRecommendations"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Welcome"
            },
            {
              "parameterName": "selectedOverviewTab",
              "comparison": "isEqualTo",
              "value": "securityRecommendations"
            }
          ],
          "name": "group - securityRecommendations"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 1,
                "content": {
                  "json": "# Welcome to the cost optimization workbook"
                },
                "name": "Welcome"
              },
              {
                "type": 1,
                "content": {
                  "json": "### Reference: [Microsoft Azure Well-Architected Framework - cost optimization pillar](https://learn.microsoft.com/en-us/azure/architecture/framework/cost/overview)",
                  "style": "upsell"
                },
                "name": "Reference"
              },
              {
                "type": 1,
                "content": {
                  "json": "The objective of this workbook is to provide a comprehensive overview of the resources usage of your Azure environment. The workbook offers cost-relevant insights aligned with the WAF Cost Optimization pillar and has the capability to identify and implement recommendations to optimize the usage and efficiency . It's important to note that the workbook serves as guidance to highlight the optimization opportunities. The cost reduction is dependent on implementation of the identified optimization opportunities.\r\n\r\n## Overview of the cost optimization pillar\r\n\r\n* The cost optimization pillar provides principles for balancing business goals with technology needs to create a cost-effective workload while avoiding capital-intensive solutions.The workbook emphasizes the importance of reducing waste and improving operational efficiencies.\r\n\r\n* To assess your workload based on the principles outlined in the [Microsoft Azure Well-Architected Framework](https://learn.microsoft.com/en-us/azure/architecture/framework/), reference the [Microsoft Azure Well-Architected Review](https://learn.microsoft.com/en-us/assessments/?id=azure-architecture-review&mode=pre-assessment&session=20dc50e4-5b71-4f38-bc49-51cc1d9f205c) tool.\r\n\r\n\r\n\r\n\r\n"
                },
                "name": "objective"
              },
              {
                "type": 1,
                "content": {
                  "json": "Indicates an implemented feature that can result in a environment that is following the Cost Optimization & Cost Governance principles.",
                  "style": "success"
                },
                "customWidth": "50",
                "name": "Greenlight",
                "styleSettings": {
                  "margin": "10px",
                  "showBorder": true
                }
              },
              {
                "type": 1,
                "content": {
                  "json": "## Prerequisites\r\n\r\nThis workbook will present various cost-related details in the categories of governance, networking, storage, VMs, Webapps and SQL to educate the business about cost related to the resources.\r\n\r\nThis workbook requires the following least-privileged (minimum) roles on your Subscriptions:\r\n\r\n  * **Reader** : allows you to import the workbook without saving it and view all of the workbook tabs.\r\n  * **Workbook Contributor** : allows you to import and save the workbook\r\n\r\nThis workbook includes \"Quick Fix\" actions within certain queries. The permissions necessary to execute these actions may vary and are documented for each specific action.\r\n\r\n\r\n"
                },
                "name": "Prerequisites"
              },
              {
                "type": 1,
                "content": {
                  "json": "## Feedback\r\n\r\n<svg viewBox=\"0 0 19 19\" width=\"20\" class=\"fxt-escapeShadow\" role=\"presentation\" focusable=\"false\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\"><g><path fill=\"#1b93eb\" d=\"M16.82 8.886c0 4.81-5.752 8.574-7.006 9.411a.477.477 0 01-.523 0C8.036 17.565 2.18 13.7 2.18 8.886V3.135a.451.451 0 01.42-.419C7.2 2.612 6.154.625 9.5.625s2.3 1.987 6.8 2.091a.479.479 0 01.523.419z\"></path><path fill=\"url(#0024423711759027356)\" d=\"M16.192 8.99c0 4.392-5.333 7.947-6.483 8.575a.319.319 0 01-.418 0c-1.15-.732-6.483-4.183-6.483-8.575V3.762a.575.575 0 01.313-.523C7.2 3.135 6.258 1.357 9.4 1.357s2.2 1.882 6.274 1.882a.45.45 0 01.419.418z\"></path><path d=\"M9.219 5.378a.313.313 0 01.562 0l.875 1.772a.314.314 0 00.236.172l1.957.284a.314.314 0 01.174.535l-1.416 1.38a.312.312 0 00-.09.278l.334 1.949a.313.313 0 01-.455.33l-1.75-.92a.314.314 0 00-.292 0l-1.75.92a.313.313 0 01-.455-.33L7.483 9.8a.312.312 0 00-.09-.278L5.977 8.141a.314.314 0 01.174-.535l1.957-.284a.314.314 0 00.236-.172z\" class=\"msportalfx-svg-c01\"></path></g></svg>&nbsp;[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> Submit feedback here </span>](https://aka.ms/advisor_cost_wb_feedback)<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> on your experience with workbooks at any time.\r\n</span>\r\n\r\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"19px\" height=\"19px\" viewBox=\"0 0 19 18\" version=\"1.1\"><g id=\"surface1\"><path style=\" stroke:none;fill-rule:evenodd;fill:rgb(14.117647%,16.078431%,18.431373%);fill-opacity:1;\" d=\"M 9.472656 0 C 4.234375 0 0 4.125 0 9.226562 C 0 13.308594 2.714844 16.761719 6.476562 17.984375 C 6.945312 18.074219 7.121094 17.785156 7.121094 17.539062 C 7.121094 17.324219 7.105469 16.59375 7.105469 15.828125 C 4.46875 16.378906 3.921875 14.726562 3.921875 14.726562 C 3.496094 13.660156 2.871094 13.382812 2.871094 13.382812 C 2.007812 12.820312 2.933594 12.820312 2.933594 12.820312 C 3.890625 12.878906 4.390625 13.765625 4.390625 13.765625 C 5.238281 15.171875 6.601562 14.773438 7.152344 14.53125 C 7.230469 13.933594 7.480469 13.519531 7.746094 13.292969 C 5.644531 13.078125 3.433594 12.285156 3.433594 8.738281 C 3.433594 7.730469 3.808594 6.90625 4.40625 6.265625 C 4.3125 6.035156 3.984375 5.085938 4.5 3.820312 C 4.5 3.820312 5.300781 3.574219 7.105469 4.765625 C 7.875 4.566406 8.671875 4.460938 9.472656 4.460938 C 10.269531 4.460938 11.085938 4.566406 11.839844 4.765625 C 13.644531 3.574219 14.441406 3.820312 14.441406 3.820312 C 14.960938 5.085938 14.628906 6.035156 14.535156 6.265625 C 15.148438 6.90625 15.507812 7.730469 15.507812 8.738281 C 15.507812 12.285156 13.296875 13.0625 11.179688 13.292969 C 11.527344 13.582031 11.824219 14.132812 11.824219 15.003906 C 11.824219 16.242188 11.808594 17.234375 11.808594 17.539062 C 11.808594 17.785156 11.980469 18.074219 12.453125 17.984375 C 16.214844 16.761719 18.925781 13.308594 18.925781 9.226562 C 18.941406 4.125 14.695312 0 9.472656 0 Z M 9.472656 0 \"/></g></svg>\r\n&nbsp;[<span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\">Submit any issues </span>](https://aka.ms/costworkbookfeedback) <span style=\"font-family: Open Sans; font-weight: 620; font-size: 14px;font-style: bold;margin:-10px 0px 0px 0px;position: relative;top:-3px;left:-4px;\"> with the workbook template to GitHub.</span>"
                },
                "name": "text - 5"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Welcome"
            },
            {
              "parameterName": "selectedOverviewTab",
              "comparison": "isEqualTo",
              "value": "instructions"
            }
          ],
          "name": "Welcome"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "summarize count() by location",
                  "size": 2,
                  "title": "Resource distribution per region",
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{mapSubscriptions}"
                  ],
                  "visualization": "map",
                  "mapSettings": {
                    "locInfo": "AzureLoc",
                    "locInfoColumn": "location",
                    "sizeSettings": "count_",
                    "sizeAggregation": "Sum",
                    "labelSettings": "location",
                    "legendMetric": "count_",
                    "legendAggregation": "Sum",
                    "itemColorSettings": {
                      "nodeColorField": "count_",
                      "colorAggregation": "Sum",
                      "type": "heatmap",
                      "heatmapPalette": "greenRed"
                    }
                  }
                },
                "name": "query - resourcesMap"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "selectedOverviewTab",
              "comparison": "isEqualTo",
              "value": "resourcesMap"
            },
            {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Welcome"
            }
          ],
          "name": "group - resourceOverview"
        },
        {
          "type": 12,
          "content": {
            "version": "NotebookGroup/1.0",
            "groupType": "editable",
            "items": [
              {
                "type": 3,
                "content": {
                  "version": "KqlItem/1.0",
                  "query": "advisorresources\r\n| where type == \"microsoft.advisor/recommendations\"\r\n| where tostring (properties.category) has \"HighAvailability\"\r\n| project AffectedResource=tostring(properties.resourceMetadata.resourceId),Impact=tostring(properties.impact),Recommendation=tostring(properties.shortDescription.problem),subscriptionId",
                  "size": 0,
                  "title": "Azure Advisor reliability recommendations",
                  "noDataMessage": "You are following all of our reliability recommendations for the selected subscriptions.",
                  "noDataMessageStyle": 3,
                  "queryType": 1,
                  "resourceType": "microsoft.resourcegraph/resources",
                  "crossComponentResources": [
                    "{mapSubscriptions}"
                  ],
                  "gridSettings": {
                    "formatters": [
                      {
                        "columnMatch": "Impact",
                        "formatter": 18,
                        "formatOptions": {
                          "thresholdsOptions": "colors",
                          "thresholdsGrid": [
                            {
                              "operator": "==",
                              "thresholdValue": "High",
                              "representation": "red",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Medium",
                              "representation": "orange",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "==",
                              "thresholdValue": "Low",
                              "representation": "blue",
                              "text": "{0}{1}"
                            },
                            {
                              "operator": "Default",
                              "thresholdValue": null,
                              "representation": "gray",
                              "text": "{0}{1}"
                            }
                          ]
                        }
                      },
                      {
                        "columnMatch": "subscriptionId",
                        "formatter": 15,
                        "formatOptions": {
                          "linkTarget": null,
                          "showIcon": true
                        }
                      },
                      {
                        "columnMatch": "resourceGroup",
                        "formatter": 14,
                        "formatOptions": {
                          "linkTarget": null,
                          "showIcon": true
                        }
                      }
                    ],
                    "filter": true,
                    "hierarchySettings": {
                      "treeType": 1,
                      "groupBy": [
                        "Impact"
                      ]
                    }
                  }
                },
                "name": "query - advisorReliabilityRecommendations"
              }
            ]
          },
          "conditionalVisibilities": [
            {
              "parameterName": "SelectedTab",
              "comparison": "isEqualTo",
              "value": "Welcome"
            },
            {
              "parameterName": "selectedOverviewTab",
              "comparison": "isEqualTo",
              "value": "reliabilityRecommendations"
            }
          ],
          "name": "group - reliabilityRecommendations"
        }
      ],
      "fallbackResourceIds": [
        "Azure Monitor"
      ],
      "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
    },
    "version": "",
    "workbookJson": "[string(variables('$fxv#0'))]",
    "workbookId": "0b2",
    "telemetryId": "[format('00f120b5-2007-6120-0000-{0}30126b006', variables('workbookId'))]",
    "finOpsToolkitVersion": "\u001b[0m0.1\u001b[96m"
  },
  "resources": [
    {
      "condition": "[parameters('enableDefaultTelemetry')]",
      "type": "Microsoft.Resources/deployments",
      "apiVersion": "2022-09-01",
      "name": "[format('pid-{0}-{1}', variables('telemetryId'), uniqueString(deployment().name, parameters('location')))]",
      "properties": {
        "mode": "Incremental",
        "template": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "1.0.0.0",
          "metadata": {
            "_generator": {
              "name": "FinOps toolkit",
              "version": "[variables('finOpsToolkitVersion')]"
            }
          },
          "resources": []
        }
      }
    },
    {
      "type": "Microsoft.Insights/workbooks",
      "apiVersion": "2022-04-01",
      "name": "[guid(resourceGroup().id, 'Microsoft.Insights/workbooks', parameters('displayName'))]",
      "location": "[parameters('location')]",
      "tags": "[parameters('tags')]",
      "kind": "shared",
      "properties": {
        "category": "workbook",
        "description": "[parameters('description')]",
        "displayName": "[parameters('displayName')]",
        "serializedData": "[variables('workbookJson')]",
        "sourceId": "Azure Monitor",
        "version": "[variables('version')]"
      }
    }
  ],
  "outputs": {
    "workbookId": {
      "type": "string",
      "metadata": {
        "description": "The resource ID of the workbook."
      },
      "value": "[resourceId('Microsoft.Insights/workbooks', guid(resourceGroup().id, 'Microsoft.Insights/workbooks', parameters('displayName')))]"
    },
    "workbookUrl": {
      "type": "string",
      "metadata": {
        "description": "Link to the workbook in the Azure portal."
      },
      "value": "[format('{0}/#view/AppInsightsExtension/UsageNotebookBlade/ComponentId/Azure%20Monitor/ConfigurationId/{1}/Type/{2}/WorkbookTemplateName/{3}', environment().portal, uriComponent(resourceId('Microsoft.Insights/workbooks', guid(resourceGroup().id, 'Microsoft.Insights/workbooks', parameters('displayName')))), reference(resourceId('Microsoft.Insights/workbooks', guid(resourceGroup().id, 'Microsoft.Insights/workbooks', parameters('displayName'))), '2022-04-01').category, uriComponent(reference(resourceId('Microsoft.Insights/workbooks', guid(resourceGroup().id, 'Microsoft.Insights/workbooks', parameters('displayName'))), '2022-04-01').displayName))]"
    }
  }
}