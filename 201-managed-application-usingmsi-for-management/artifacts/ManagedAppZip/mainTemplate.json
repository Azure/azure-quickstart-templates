{
    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]"
        },
        "logicAppName": {
            "type": "string",
            "defaultValue": "logicappwf"
        },
        "rolenameguid": {
            "type": "string"
        },
        "storageAccountName": {
            "type": "string",
            "defaultValue": "suhas"
        }
    },
    "variables": {
        "appdeploymentName": "LogicapplinkedTemplate",
        "customResourceProviderName": "public",
        "storageAccountType": "Standard_LRS",
        "_deploymentLink": "[deployment().properties.templateLink.uri]",
        "ownerRoleId": "[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/', '8e3af657-a8ff-443c-a75c-2fe8c4bcb635')]"
    },
    "resources": [
        {
            "apiVersion": "2017-05-10",
            "name": "[variables('appdeploymentName')]",
            "type": "Microsoft.Resources/deployments",
            "properties": {
                "mode": "Incremental",
                "templateLink": {                    
                    "uri" : "[uri(variables('_deploymentLink'), 'linkedtemplates/deploylogicApp.json')]",
                    "contentVersion":"1.0.0.0"
                },
                "parameters": {
                    "location":{"value": "[parameters('location')]"},
                    "logicAppName":{"value": "[parameters('logicAppName')]"},
                    "storageAccountName":{"value": "[parameters('storageAccountName')]"}
                  }
            }
        },
        {
            "type": "Microsoft.Storage/storageAccounts",
            "name": "[parameters('storageAccountName')]",
            "apiVersion": "2018-02-01",
            "location": "[parameters('location')]",
            "sku": {
                "name": "[variables('storageAccountType')]"
            },
            "kind": "Storage"
        },
        {
            "type": "Microsoft.CustomProviders/resourceProviders",
            "apiVersion": "2018-09-01-preview",
            "name": "[variables('customResourceProviderName')]",
            "location": "[parameters('location')]",
            "properties": {
                "actions": [
                    {
                        "name": "createContainer",
                        "mode": "Secure",
                        "routingType": "Proxy",
                        "endpoint": "[listCallbackURL(concat(resourceId('Microsoft.Logic/workflows', parameters('logicAppName')), '/triggers/CustomProviderWebhook'), '2017-07-01').value]"
                    }
                ]
            },
            "dependsOn": [
                "[resourceId('Microsoft.Logic/workflows', parameters('logicAppName'))]"
            ]
        },
        {
            "apiVersion": "2017-09-01",
            "type": "Microsoft.Authorization/roleAssignments",
            "name": "[parameters('rolenameguid')]",
            "properties": {
                "roleDefinitionId": "[variables('ownerRoleId')]",
                "principalId": "[reference(variables('appdeploymentName')).outputs.appprincipalid.value]",
                "scope": "[resourceGroup().id]"
            },
             "dependsOn": [
                "[variables('appdeploymentName')]"
            ]
        }
    ],
    "outputs": {
        "storageEndpoint": {
            "type": "string",
            "value": "[reference(variables('appdeploymentName')).outputs.appprincipalid.value]"
        }
    }
}